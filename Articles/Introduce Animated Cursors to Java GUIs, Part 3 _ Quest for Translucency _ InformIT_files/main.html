
<!-- saved from url=(0050)https://td.yieldify.com/0.0.1/tag/1.51.0/main.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"></head><body><script>!function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return o(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./messages"),i=e("../../lib/Logger"),s=e("../../sandbox/modules/BaseModule"),a="api",u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.start=function(e){this.store=e,i.logger.debug(null,"Started API Client")},t.prototype.getRoutingLabel=function(){return a},t.prototype["interface"]=function(){var e=this;return{sendToSandbox:function(t){return e.receiveFromHost(t)}}},t.prototype.receiveFromHost=function(e){return void 0===this.store?void i.logger.error(null,"Received API Message in Sandbox before client started"):(i.logger.debug({message:e},"Received API Message in Sandbox"),void("PING"===e.type?o.handlePingMessage(e,this.store):"EXTERNAL_VALUE_UPDATED"===e.type&&o.handleExternalValueUpdate(e,this.store)))},t}(s.BaseModule);n.APIClient=u},{"../../lib/Logger":136,"../../sandbox/modules/BaseModule":164,"./messages":2}],2:[function(e,t,n){"use strict";function r(e){return"object"==typeof e&&"PING"===e.type&&"string"==typeof e.message}function o(e,t){c.logger.debug({pingMessage:e.message},"API PING!")}function i(e){return"object"==typeof e&&"EXTERNAL_VALUE_UPDATED"===e.type&&"string"==typeof e.name&&"string"==typeof e.pageType&&("string"==typeof e.value||"number"==typeof e.value)}function s(e,t){var n=a.externalValue(e.name,e.pageType)(t.getState());return void 0===n?void c.logger.error({externalValueUpdate:e},"Invalid external value update"):"String"===n.dataType&&"string"!=typeof e.value||"Integer"===n.dataType&&"number"!=typeof e.value||"Float"===n.dataType&&"number"!=typeof e.value?void c.logger.error({externalValueUpdate:e},"Invalid external value update"):void t.dispatch(u.pageElementValueUpdated(n.id,e.value))}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../redux/reducers/page-elements"),u=e("../redux/actions/page-elements"),c=e("../../lib/Logger");n.messageValidators=[r,i],n.validatePingMessage=r,n.handlePingMessage=o,n.validateExternalValueUpdatedMessage=i,n.handleExternalValueUpdate=s},{"../../lib/Logger":136,"../redux/actions/page-elements":82,"../redux/reducers/page-elements":97}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ValueSourceDataType={STRING:"String",INTEGER:"Integer",FLOAT:"Float"}},{}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../lib/Logger"),o=e("../redux/reducers/user"),i=function(){function e(e,t){this.store=e,this.splitSelector=t}return e.prototype.selectCollection=function(e){var t=this.validateSplitsAndCollections(e);if(t)throw t;var n=o.user(this.store.getState()),i=e.experiment;if(null===i||void 0===i)return r.logger.debug({campaignId:e.id},"No experiment present, selecting its only collection"),e.collections[0];var s=this.splitSelector.selectSplit(i,n.id);r.logger.debug({campaignId:e.id,experimentId:i.id,splitId:s.id},"Selected Split for Experiment");var a=this.getCollectionDefinitionById(e.collections,s.collectionId);if(a)return r.logger.info({campaignId:e.id,collection:a.id},"Selected Collection for Campaign"),a;throw r.logger.error({campaignId:e.id,experiment:i,selectedSplitId:s.id},"Unable to find Collection associated with selected split"),new Error("No collection found for split")},e.prototype.getCollectionDefinitionById=function(e,t){for(var n=0,r=e;n<r.length;n++){var o=r[n];if(o.id===t)return o}},e.prototype.validateSplitsAndCollections=function(e){if(0===e.collections.length)return new Error("Campaign "+e.id+" has no execution collections");if(e.experiment){if(e.collections.length!==e.experiment.splits.length)return new Error("Campaign "+e.id+" has a different number of splits / collections");for(var t=[],n=function(n){if(t.indexOf(n.id)!==-1)return{value:new Error("Campaign "+e.id+" has duplicate collection ids")};t.push(n.id);var r=e.experiment.splits.filter(function(e){return e.collectionId===n.id});return 1!==r.length?{value:new Error("Campaign "+e.id+" has mismatched split and collection ids")}:void 0},r=0,o=e.collections;r<o.length;r++){var i=o[r],s=n(i);if("object"==typeof s)return s.value}}else if(e.collections.length>1)return new Error("Campaign "+e.id+" has no experiment and more than one collection");return null},e}();n.CollectionSelector=i},{"../../lib/Logger":136,"../redux/reducers/user":104}],5:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ExecutionComponent"),i=e("./events/ImpressionEvent"),s=function(e){function t(t,n,r,o,i){var s=e.call(this,t,n,r,o)||this;return s.timeProvider=i,s}return r(t,e),t.prototype._begin=function(){var e=this;this.publishEvent(new i.ImpressionEvent(this,this.timeProvider,(!0))),setTimeout(function(){e.done()},0)},t}(o.ExecutionComponent);n.ControlOverlay=s},{"./ExecutionComponent":10,"./events/ImpressionEvent":17}],6:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=function(e){function t(t,n,r,o){void 0===o&&(o=!1);var i=e.call(this)||this;return i.eventType=t,i.selector=n,i.domClient=r,i.preventDefault=o,i}return r(t,e),t.prototype.start=function(){var e=this;this.domClient.listen(this.selector,this.eventType,this.preventDefault).subscribe(function(t){e.publish(t)})},t.prototype.getSelector=function(){return this.selector},t}(o.Observable);n.EventListenerObservable=i},{"../../lib/Observable":137}],7:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var i,s=e("../preconditions/BooleanExpression"),a=e("../../lib/Logger"),u=e("../../lib/CachingObservable"),c=e("../../lib/Observable"),l=e("../../lib/Set"),p=e("./ExecutionComponent");!function(e){e[e.OFF=0]="OFF",e[e.PREPARING=1]="PREPARING",e[e.READY=2]="READY",e[e.TRIGGER_FIRED=3]="TRIGGER_FIRED",e[e.IN_PROGRESS=4]="IN_PROGRESS",e[e.DONE=5]="DONE"}(i=n.CollectionState||(n.CollectionState={}));var f=function(){function e(e,t,n,r){this.definition=e,this.setMetadata(e),this.expressionFactory=n,this.setupPrecondition(e.targetRules),this.stateObservable=new u.CachingObservable,this.eventObservable=new c.Observable;var i=e.components.filter(function(e){return e.device===r});if(this.isControlCollection(e.experimentSplitType)){var s=i.filter(function(e){return"Overlay"===e.type})[0];i=void 0===s?[]:[o({},s,{type:"ControlOverlay"})]}this.components=t.create(i,this)}return e.prototype.start=function(){this.updateStateModel(new h(this));for(var e=0,t=this.components;e<t.length;e++){var n=t[e];this.startComponent(n)}this.precondition.start()},e.prototype.prepareComponents=function(){this.components.forEach(function(e){return e.prepare()})},e.prototype.startComponentsPrecondition=function(){this.components.forEach(function(e){return e.startPrecondition()})},e.prototype.getState=function(){return this.stateModel.getState()},e.prototype.getStateObservable=function(){return this.stateObservable},e.prototype.getEventObservable=function(){return this.eventObservable},e.prototype.getComponents=function(){return this.components},e.prototype.getOverlayPositions=function(){var e=[];return this.definition.components.forEach(function(t){"Overlay"===t.type&&e.push(t.settings.position)}),new l.Set(e)},e.prototype.getMetadata=function(){return this.metadata},e.prototype.begin=function(){this.updateStateModel(this.stateModel.begin())},e.prototype.toJSON=function(){return{metadata:this.getMetadata(),components:this.components.map(function(e){return e.getId()})}},e.prototype.updateStateModel=function(e){this.stateModel&&e.getState()===this.getState()||(this.stateModel=e,this.stateModel.start(),this.updateState(this.stateModel.getState()))},e.prototype.isControlCollection=function(e){return null!==e&&"inc"===e.exptype&&"control"===e.splittype},e.prototype.setupPrecondition=function(e){var t=this;try{this.precondition=this.expressionFactory.createExpression(e)}catch(n){a.logger.error({error:n,rulesDef:e,collectionId:this.getMetadata().id},"Error parsing expression, returning alwaysFalse()."),this.precondition=s.alwaysFalse()}this.precondition.subscribe(function(e){t.updateStateModel(t.stateModel.processPreconditionChange(e))})},e.prototype.startComponent=function(e){var t=this;e.getStateObservable().subscribe(function(n){a.logger.debug({component:e,newState:p.ComponentState[n]},"Component changed state."),t.updateStateModel(t.stateModel.processComponentStateChange(e,n))}),e.getEventObservable().subscribe(function(e){t.eventObservable.publish(e)}),e.start()},e.prototype.updateState=function(e){this.stateObservable.publishIfChanged(e)},e.prototype.setMetadata=function(e){this.metadata={id:e.id,campaignId:e.campaignId,experimentId:e.experimentId,experimentUuid:e.experimentUuid,splitId:e.splitId,experimentSplitType:e.experimentSplitType}},e}();n.ExecutionCollection=f;var d=function(){function e(e){this.collection=e}return e.prototype.processPreconditionChange=function(e){return this},e.prototype.processComponentStateChange=function(e,t){throw new Error("Unable to evaluate state change in state "+i[this.getState()]+" with component changing state to "+p.ComponentState[t])},e.prototype.begin=function(){throw new Error("Unsupported operation begin() in state "+i[this.getState()])},e.prototype.start=function(){},e.prototype.getComponentsInState=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=[],r=0,o=this.collection.getComponents();r<o.length;r++){var i=o[r];e.indexOf(i.getState())>=0&&n.push(i)}return n},e}(),h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.OFF},t.prototype.processPreconditionChange=function(e){return e?new v(this.collection):this},t.prototype.processComponentStateChange=function(t,n){return n===p.ComponentState.DORMANT?this:e.prototype.processComponentStateChange.call(this,t,n)},t}(d),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.PREPARING},t.prototype.start=function(){this.collection.prepareComponents()},t.prototype.processComponentStateChange=function(t,n){if(n===p.ComponentState.OFF){var r=this.getComponentsInState(p.ComponentState.OFF).length,o=this.collection.getComponents().length;return r===o?new g(this.collection):this}return n===p.ComponentState.PREPARING?this:e.prototype.processComponentStateChange.call(this,t,n)},t}(d),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.READY},t.prototype.start=function(){this.collection.startComponentsPrecondition()},t.prototype.processComponentStateChange=function(t,n){return n===p.ComponentState.OFF||n===p.ComponentState.READY?this:n===p.ComponentState.TRIGGER_FIRED?new y(this.collection):e.prototype.processComponentStateChange.call(this,t,n)},t}(d),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.TRIGGER_FIRED},t.prototype.begin=function(){var t=this.getComponentsInState(p.ComponentState.TRIGGER_FIRED);return t.length>0?(this.activatingComponent=t[0],this.activatingComponent.begin(),new b(this.collection,this.activatingComponent)):e.prototype.begin.call(this)},t.prototype.processComponentStateChange=function(t,n){return this.activatingComponent===t&&n===p.ComponentState.IN_PROGRESS?this:n===p.ComponentState.OFF||n===p.ComponentState.PREPARING||n===p.ComponentState.READY||n===p.ComponentState.TRIGGER_FIRED?this.getComponentsInState(p.ComponentState.TRIGGER_FIRED).length>0?this:this.getComponentsInState(p.ComponentState.READY).length>0?new g(this.collection):new h(this.collection):e.prototype.processComponentStateChange.call(this,t,n)},t}(d),b=function(e){function t(t,n){var r=e.call(this,t)||this;return r.activeComponent=n,r}return r(t,e),t.prototype.getState=function(){return i.IN_PROGRESS},t.prototype.processComponentStateChange=function(e,t){return this.activeComponent===e?this.processActiveComponentStateChange(e,t):this.activeComponent?this.processInactiveComponentStateChange(e,t):this.processStateChange(e,t)},t.prototype.processActiveComponentStateChange=function(t,n){if(n===p.ComponentState.DONE){this.activeComponent=void 0;var r=this.getComponentsInState(p.ComponentState.READY,p.ComponentState.PREPARING).length,o=this.getComponentsInState(p.ComponentState.TRIGGER_FIRED).length;if(r+o===0)return new m(this.collection);if(o>0){var i=this.getComponentsInState(p.ComponentState.TRIGGER_FIRED);return this.activeComponent=i[0],this.activeComponent.begin(),this}return this}return n===p.ComponentState.IN_PROGRESS?this:e.prototype.processComponentStateChange.call(this,t,n)},t.prototype.processInactiveComponentStateChange=function(t,n){return n===p.ComponentState.OFF||n===p.ComponentState.PREPARING||n===p.ComponentState.READY||n===p.ComponentState.TRIGGER_FIRED?this:e.prototype.processComponentStateChange.call(this,t,n)},t.prototype.processStateChange=function(t,n){return n===p.ComponentState.READY?this:n===p.ComponentState.OFF?0===this.getComponentsInState(p.ComponentState.READY).length?new m(this.collection):this:n===p.ComponentState.TRIGGER_FIRED?(this.activeComponent=t,this.activeComponent.begin(),this):e.prototype.processComponentStateChange.call(this,t,n)},t}(d),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getState=function(){return i.DONE},t}(d)},{"../../lib/CachingObservable":132,"../../lib/Logger":136,"../../lib/Observable":137,"../../lib/Set":142,"../preconditions/BooleanExpression":62,"./ExecutionComponent":10}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../redux/actions/blocked-impression"),o=e("./events/CloseEvent"),i=e("./events/ClickThroughEvent"),s=e("../../lib/Logger"),a=e("../../lib/Observable"),u=e("../../lib/Set"),c=e("./events/ImpressionEvent"),l=e("./events/FormSubmissionEvent"),p=e("./ExecutionCollection"),f=e("../redux/actions/impression"),d=e("../redux/actions/form-submit"),h=e("../redux/reducers/session"),v=e("../redux/actions/click-through"),g=e("../redux/actions/close-event");n.DEVICE_BLACKLIST=[];var y=function(){function e(e,t,n,r,o,i,s,u){this.campaignDefinitions=e,this.collectionCreator=t,this.collectionSelector=n,this.asyncWorker=r,this.randomSource=o,this.collections=[],this.eventObservable=new a.Observable,this.blacklisted=s.reduce(function(e,t){return e||t.test(i.userAgent)},!1),this.activeCollections=[],this.store=u}return e.prototype.getEventObservable=function(){return this.eventObservable},e.prototype.start=function(){var e=this;try{var t=this.campaignDefinitions.map(function(t){return e.collectionSelector.selectCollection(t)});this.collections=t.map(function(t){return e.collectionCreator.create(t)}),this.collections.forEach(function(t){e.startCollection(t)})}catch(n){s.logger.error({error:n},"Unable to select Collections to instantiate")}},e.prototype.toJSON=function(){return{campaignDefinitions:this.campaignDefinitions}},e.prototype.connectToStore=function(e){this.getEventObservable().subscribe(function(t){if(t instanceof c.ImpressionEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata();e.dispatch(f.impression({campaignId:r.campaignId,collectionId:r.id,componentId:n.getId(),experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl(),sessionCount:h.session(e.getState()).sessionCount}))}if(t instanceof i.ClickThroughEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata();e.dispatch(v.clickThrough({campaignId:r.campaignId,collectionId:r.id,componentId:n.getId(),experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl()}))}if(t instanceof o.CloseEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata();e.dispatch(g.closeEvent({campaignId:r.campaignId,collectionId:r.id,componentId:n.getId(),experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl()}))}if(t instanceof l.FormSubmissionEvent){var n=t.getSource(),r=n.getParentCollection().getMetadata();e.dispatch(d.formSubmit({campaignId:r.campaignId,collectionId:r.id,componentId:n.getId(),experimentId:r.experimentId,experimentUuid:r.experimentUuid,splitId:r.splitId,experimentSplitType:r.experimentSplitType,timestamp:t.getTimestamp(),control:t.isControl(),inputValues:t.getInputValues()}))}})},e.prototype.startCollection=function(e){var t=this;e.getStateObservable().subscribe(function(n){t.processCollectionStateChange(n,e)}),e.getEventObservable().subscribe(function(e){t.eventObservable.publish(e)}),e.start()},e.prototype.processCollectionStateChange=function(e,t){if(s.logger.debug({newState:p.CollectionState[e],collection:t},"Collection changed state."),this.activeCollections.indexOf(t)!==-1){if(e===p.CollectionState.DONE)this.activeCollections=this.activeCollections.filter(function(e){return e!==t}),this.asyncProcessTriggerFired();else if(e!==p.CollectionState.IN_PROGRESS)throw new Error("Unexpected state change to "+p.CollectionState[e]+" for active collection")}else if(0!==this.activeCollections.length){if(e===p.CollectionState.IN_PROGRESS||e===p.CollectionState.DONE)throw new Error("Unexpected state change to "+p.CollectionState[e]+" for inactive collection");this.asyncProcessTriggerFired()}else{if(e===p.CollectionState.IN_PROGRESS||e===p.CollectionState.DONE)throw new Error("Unexpected state change to "+p.CollectionState[e]+" for inactive collection");e===p.CollectionState.TRIGGER_FIRED&&this.asyncProcessTriggerFired()}},e.prototype.getCandidates=function(e){return e.filter(function(e){return e.getStateObservable().getCurrentValue()===p.CollectionState.TRIGGER_FIRED})},e.prototype.getPositionSet=function(e){var t=[];return e.forEach(function(e){t.push.apply(t,e.getOverlayPositions().values())}),new u.Set(t)},e.prototype.selectVisiblyCompatibleCollections=function(e,t){for(var n=[],r=[],o=new u.Set([]);0!==e.length;){var i=this.randomSource.getInteger(e.length-1),s=e[i];t.intersection(s.getOverlayPositions()).isEmpty()&&o.intersection(s.getOverlayPositions()).isEmpty()?(n.push(s),o=o.union(s.getOverlayPositions())):r.push(s),e.splice(i,1)}return{selected:n,blocked:r}},e.prototype.asyncProcessTriggerFired=function(){var e=this;this.blacklisted||this.asyncWorker.performAsyncCallback(function(){var t=e.getCandidates(e.collections);if(0!==t.length){var n=e.getPositionSet(e.activeCollections),o=e.selectVisiblyCompatibleCollections(t,n);(i=e.activeCollections).push.apply(i,o.selected),o.selected.forEach(function(e){e.begin()}),o.blocked.forEach(function(t){var n=t.getMetadata();e.store.dispatch(r.blockedImpression({campaignId:n.campaignId,collectionId:n.id,componentId:-1,experimentId:n.experimentId,experimentUuid:n.experimentUuid,splitId:n.splitId,experimentSplitType:n.experimentSplitType}))});var i}})},e}();n.ExecutionCollectionController=y},{"../../lib/Logger":136,"../../lib/Observable":137,"../../lib/Set":142,"../redux/actions/blocked-impression":72,"../redux/actions/click-through":73,"../redux/actions/close-event":74,"../redux/actions/form-submit":77,"../redux/actions/impression":79,"../redux/reducers/session":100,"./ExecutionCollection":7,"./events/ClickThroughEvent":14,"./events/CloseEvent":15,"./events/FormSubmissionEvent":16,"./events/ImpressionEvent":17}],9:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Creator"),i=e("./ExecutionCollection"),s=function(e){function t(t,n,r){var o=e.call(this)||this;return o.componentCreator=t,o.expressionFactory=n,o.deviceType=r,o}return r(t,e),t.prototype.create=function(e){return new i.ExecutionCollection(e,this.componentCreator,this.expressionFactory,this.deviceType)},t}(o.Creator);n.ExecutionCollectionCreator=s},{"../../lib/Creator":133,"./ExecutionCollection":7}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../preconditions/BooleanExpression"),o=e("../../lib/Logger"),i=e("../../lib/CachingObservable"),s=e("../../lib/Observable"),a=function(){function e(e,t,n,r){this.def=e,this.triggerFactory=t,this.expressionFactory=n,this.parentCollection=r,this.state=u.DORMANT,this.triggers=[],this.eventObservable=new s.Observable,this.stateObservable=new i.CachingObservable,this.uuid=e.uuid,this.id=e.id,this.type=e.type}return e.prototype.start=function(){if(!this.def.triggers)throw new Error("Missing triggers on component");if(!this.def.trigger_precondition)throw new Error("Missing trigger_precondition on component");this.updateState(this.state),this.setupTriggers(this.def.triggers),this.setupPrecondition(this.def.trigger_precondition)},e.prototype.prepare=function(){if(this.state!==u.DORMANT)throw new Error("Unsupported operation prepare in state "+u[this.state]);this.updateState(u.PREPARING),this._prepare()},e.prototype._prepare=function(){this.off()},e.prototype.off=function(){if(this.state!==u.PREPARING)throw new Error("Unsupported operation off in state "+u[this.state]);this.updateState(u.OFF)},e.prototype._off=function(){},e.prototype.startPrecondition=function(){this.precondition.start()},e.prototype.ready=function(){if(this.state!==u.OFF)throw new Error("Unsupported operation ready in state "+u[this.state]);this.updateState(u.READY);for(var e=0,t=this.triggers;e<t.length;e++){var n=t[e];n.prepare()}},e.prototype.triggerFired=function(){if(this.state!==u.READY)throw new Error("Unsupported operation triggerFired in state "+u[this.state]);this.updateState(u.TRIGGER_FIRED),this._triggerFired()},e.prototype._triggerFired=function(){},e.prototype.begin=function(){if(this.state!==u.TRIGGER_FIRED)throw new Error("Unsupported operation begin in state "+u[this.state]);this.updateState(u.IN_PROGRESS),this._begin()},e.prototype._begin=function(){},e.prototype.cancel=function(){if(this.state!==u.READY&&this.state!==u.TRIGGER_FIRED)throw new Error("Unsupported operation cancel in state "+u[this.state]);this.updateState(u.OFF);for(var e=0,t=this.triggers;e<t.length;e++){var n=t[e];n.cancel()}this._cancel()},e.prototype._cancel=function(){},e.prototype.done=function(){if(this.state!==u.IN_PROGRESS)throw new Error("Unsupported operation done in state "+u[this.state]);this.updateState(u.DONE)},e.prototype.publishEvent=function(e){this.eventObservable.publish(e)},e.prototype.updateState=function(e){this.state=e,this.stateObservable.publishIfChanged(e)},e.prototype.setupTriggers=function(e){var t=this;e.forEach(function(e){var n;try{n=t.triggerFactory.create(e)}catch(r){return void o.logger.error({error:r,triggerDef:e},"Unable to create trigger")}t.triggers.push(n),n.subscribe(function(){t.triggerFired()})})},e.prototype.setupPrecondition=function(e){var t=this;try{this.precondition=this.expressionFactory.createExpression(e)}catch(n){o.logger.error({error:n,rulesDef:e},"Error parsing expression, returning alwaysFalse()."),this.precondition=r.alwaysFalse()}this.precondition.subscribe(function(e){e===!0&&t.state===u.OFF?t.ready():e!==!1||t.state!==u.PREPARING&&t.state!==u.READY&&t.state!==u.TRIGGER_FIRED||t.cancel()})},e.prototype.getType=function(){return this.type},e.prototype.getId=function(){return this.id},e.prototype.getState=function(){return this.state},e.prototype.getPrecondition=function(){return this.precondition},e.prototype.getEventObservable=function(){return this.eventObservable},e.prototype.getStateObservable=function(){return this.stateObservable},e.prototype.getUuid=function(){return this.uuid},e.prototype.getParentCollection=function(){return this.parentCollection},e.prototype.getDefinition=function(){return this.def},e.prototype.toJSON=function(){return{uuid:this.uuid,id:this.id,state:this.state,type:this.type}},e.prototype.getCampaignId=function(){return this.getParentCollection().getMetadata().campaignId},e}();n.ExecutionComponent=a;var u;!function(e){e[e.DORMANT=0]="DORMANT",e[e.PREPARING=1]="PREPARING",e[e.OFF=2]="OFF",e[e.READY=3]="READY",e[e.TRIGGER_FIRED=4]="TRIGGER_FIRED",e[e.IN_PROGRESS=5]="IN_PROGRESS",e[e.DONE=6]="DONE"}(u=n.ComponentState||(n.ComponentState={}))},{"../../lib/CachingObservable":132,"../../lib/Logger":136,"../../lib/Observable":137,"../preconditions/BooleanExpression":62}],11:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Logger"),i=e("../../lib/Creator"),s=e("./Overlay"),a=e("./ControlOverlay"),u=e("../../sandbox/remote-windows/RemoteWindow"),c=function(e){function t(t,n,r,o,i,s,a,u,c){var l=e.call(this)||this;return l.domClient=t,l.windowClient=n,l.iframeClient=r,l.triggerFactory=o,l.expressionFactory=i,l.formCreator=s,l.window=a,l.timeProvider=u,l.store=c,l}return r(t,e),t.prototype.create=function(e,t){var n=this;return e.reduce(function(e,r){switch(r.type){case"Overlay":e.push(new s.Overlay(n.domClient,n.windowClient,n.iframeClient,r,n.triggerFactory,n.expressionFactory,t,n.formCreator,n.window,n.timeProvider,n.store,u.RemoteWindow.connect));break;case"ControlOverlay":e.push(new a.ControlOverlay(r,n.triggerFactory,n.expressionFactory,t,n.timeProvider));break;default:o.logger.warn({type:r.type},"Unknown Execution Component type in configuration")}return e},[])},t}(i.Creator);n.ExecutionComponentCreator=c},{"../../lib/Creator":133,"../../lib/Logger":136,"../../sandbox/remote-windows/RemoteWindow":181,"./ControlOverlay":5,"./Overlay":12}],12:[function(e,t,n){"use strict";function r(e,t){var n=/{{\s*page\.url\s*}}/g;return e.replace(n,encodeURIComponent(t))}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("../redux/reducers/device"),s=e("../../lib/utils"),a=e("../../lib/Logger"),u=e("../../lib/Promise"),c=e("../../lib/events/DOMEventType"),l=e("../../sandbox/modules/dom/Client"),p=e("../../sandbox/modules/redux-store/Agent"),f=e("./ExecutionComponent"),d=e("./EventListenerObservable"),h=e("./events/ImpressionEvent"),v=e("./events/ClickThroughEvent"),g=e("./events/CloseEvent"),y=e("./events/RedirectEvent"),b=e("../lib/utils"),m=e("../model/form/Form"),_=e("../layouts/OverlayLayout"),E=e("../layouts/NotificationLayout"),O=e("../redux/tag"),w=e("../redux/actionRelay"),S=e("../redux/reducers/overlay-status"),C=e("../redux/reducers/window-dimensions"),P=e("../redux/utils"),I=e("../redux/sagas/trackable"),R=e("../redux/reducers/page"),T=e("../redux/actions/last-component-submitted");n.IFRAME_NAME_PREFIX="yie-iframe-";var x=300,M={display:"block",overflow:"hidden",width:"100%",height:"100%"},L={frameBorder:"0",marginWidth:"0",marginHeight:"0"},A=[100,200,400,550,600,700,1e3];n.MIN_BORDER=.1;var D=function(e){function t(t,n,r,o,i,s,a,u,c,l,p,f){var d=e.call(this,o,i,s,a)||this;return d.domClient=t,d.windowClient=n,d.iframeClient=r,d.settings=o.settings,d.formCreator=u,d.oneTimePrepareDone=!1,d.timeProvider=l,d.store=p,d.focused=!1,d.connectToRemoteWindow=f,d.window=c,d.layout=d.getLayout(d.settings),d.iframeSelector=d.layout.getIFrameParentSelector()+" iframe",d}return o(t,e),t.prototype._prepare=function(){var e=this;this.oneTimePrepareDone?this.off():(this.oneTimePrepareDone=!0,this.layout.renderElements(this.getDisplayState(),this.domClient).timeout(1e3,"Overlay "+this.uuid+": Initial render timed out").then(function(){return e.iframeClient.createIFrame({src:s.addHashParameters(e.settings.url,s.getHash(e.window)),parentElement:e.layout.getIFrameParentSelector(),name:n.IFRAME_NAME_PREFIX+e.uuid}).timeout(6e4,"Overlay "+e.uuid+": Iframe creation timed out")}).then(function(t){a.logger.debug({connection:t,overlayUuid:e.uuid},"Connection established");var n=e.createRemoteDomClient(),r=new p.ReduxStoreAgent(e.store),o={initConfig:JSON.stringify({uuid:e.uuid,settings:e.settings}),provide:[n,r]};return e.connectToRemoteWindow(JSON,o)(t).timeout(1e3,"Overlay "+e.uuid+": RemoteWindow connection timed out")}).then(function(t){a.logger.debug({remoteWindow:t,overlayUuid:e.uuid},"Connected to RemoteWindow"),e.remoteOverlayWindow=t;var n=e.remoteOverlayWindow.getModuleByClass(l.DOMClient);if(!n)throw new Error("Missing overlay DOM client");e.overlayElements=e.createElements(e.getDefinition().settings.overlayElements,n),e.setupListeners(),e.styleIFrame(),e.redraw();var r=new u["default"](function(t,n){var r=e.store.subscribe(function(){var o=e.store.getState();S.overlayReady(e.settings.url)(o)?(t(void 0),r()):S.overlayError(e.settings.url)(o)&&(n(new Error("Overlay "+e.uuid+": Overlay went into error state")),r())})}),o=e.remoteOverlayWindow.getModuleByClass(p.ReduxStoreAgent);return O.replicateDerivedState(e.store.getState(),o),e.store.dispatch(w.remoteStoreCreated(o,e.getUuid())),r}).then(function(){e.off()},function(e){a.logger.error({error:e},"Overlay preparation promise rejected")}))},t.prototype._begin=function(){this.redraw(),this.publishEvent(new h.ImpressionEvent(this,this.timeProvider))},t.prototype.close=function(){return this.done(),this.redraw()},t.prototype.getOverlayElements=function(){return this.overlayElements;
},t.prototype.getPosition=function(){return this.settings.position},t.prototype.getLayout=function(e){var t=this.settings.position;switch(t){case"Centre":if(!this.settings.hasBackdrop)throw new Error("centre position overlays without a backdrop are not supported");return new _.OverlayLayout(this.uuid);case"TopRight":case"TopLeft":case"BottomRight":case"BottomLeft":if(this.settings.hasBackdrop)throw new Error("notification style overlays with a backdrop are not supported");return new E.NotificationLayout(this.uuid);default:throw a.logger.error({position:t},"Unsupported overlay position"),new Error("unsupported overlay position: "+t)}},t.prototype.redraw=function(){var e=this.getDisplayState();return a.logger.debug({state:e},"Redrawing overlay "+this.uuid),this.layout.updateElements(e,this.domClient)},t.prototype.setupListeners=function(){var e=this;this.overlayElements.forEach(function(t){t.start(),t instanceof m.Form&&t.getFocusObservable().subscribe(function(t){e.focused="focus"===t.type,A.forEach(function(t){setTimeout(function(){e.redraw()},t)})})}),P.onChange(C.windowDimensions,this.store,function(){return e.redraw()})},t.prototype.getDisplayState=function(){return{uuid:this.uuid,overlayState:this.getState(),settings:this.settings,windowDimensions:C.windowDimensions(this.store.getState()),deviceType:i.deviceType(this.store.getState()),focused:this.focused}},t.prototype.styleIFrame=function(){var e=this;return u["default"].all(Object.keys(M).map(function(t){return e.domClient.style(e.iframeSelector,t,M[t])}).concat(Object.keys(L).map(function(t){return e.domClient.modifyAttribute(e.iframeSelector,t,L[t])})))},t.prototype.createRemoteDomClient=function(){return new l.DOMClient},t.prototype.createElements=function(e,t){var n=this,r=e.reduce(function(e,r){switch(r.type){case"cta":a.logger.debug({cta:r},"Creating CTA");var o=new d.EventListenerObservable(c.DOMEventType.CLICK,b.getElementIdSelector(r.id),t,(!0));o.subscribe(function(){var e=r.onClick;n.handleCtaClick(e)}),e.push(o);break;case"form":a.logger.debug({form:r},"Creating Form");var i=n.formCreator.create(r,t);i.subscribe(function(e){e.setSource(n),n.publishEvent(e),n.handleCtaClick(e.getCtaAction())}),e.push(i);break;default:a.logger.debug({type:r.type},"Unhandled overlay element type in configuration")}return e},[]),o=new d.EventListenerObservable(c.DOMEventType.CLICK,this.layout.getCloseButtonSelector(),this.domClient);return o.subscribe(function(){n.publishEvent(new g.CloseEvent(n,n.timeProvider)),n.close()}),r.push(o),r},t.prototype.handleCtaClick=function(e){var t=this;switch(e.type){case"redirect":this.publishEvent(new v.ClickThroughEvent(this,this.timeProvider,"dismiss")),this.publishEvent(new y.RedirectEvent(this,this.timeProvider)),this.close(),I.waitForInFlightTrackables(this.store).timeout(x)["catch"](function(e){return[]}).then(function(){var n=r(e.target,R.currentPageUrl(t.store.getState()));t.windowClient.redirect(n)});break;case"next":this.publishEvent(new v.ClickThroughEvent(this,this.timeProvider,"next")),this.store.dispatch(T.updateLastComponentSubmitted(this.uuid)),this.close();break;case"dismiss":this.publishEvent(new v.ClickThroughEvent(this,this.timeProvider,"dismiss")),this.close();break;default:throw new Error("Unknown cta action: "+e.type)}},t}(f.ExecutionComponent);n.Overlay=D},{"../../lib/Logger":136,"../../lib/Promise":138,"../../lib/events/DOMEventType":150,"../../lib/utils":163,"../../sandbox/modules/dom/Client":169,"../../sandbox/modules/redux-store/Agent":175,"../layouts/NotificationLayout":23,"../layouts/OverlayLayout":24,"../lib/utils":31,"../model/form/Form":42,"../redux/actionRelay":70,"../redux/actions/last-component-submitted":80,"../redux/reducers/device":90,"../redux/reducers/overlay-status":96,"../redux/reducers/page":99,"../redux/reducers/window-dimensions":105,"../redux/sagas/trackable":110,"../redux/tag":112,"../redux/utils":113,"./EventListenerObservable":6,"./ExecutionComponent":10,"./events/ClickThroughEvent":14,"./events/CloseEvent":15,"./events/ImpressionEvent":17,"./events/RedirectEvent":18}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("@yieldify/gendry-hash-util"),o=285899441,i=function(){function e(){}return e.prototype.selectSplit=function(e,t,n){void 0===n&&(n=r.murmur32);for(var i=e.splits.sort(function(e,t){return e.id>t.id?1:e.id<t.id?-1:0}),s=[t,e.uuid].join(""),a=n(s,o)/r.MURMUR_32_MAX_VALUE,u=i.reduce(function(e,t){return e+t.weight},0),c=a*u,l=0,p=0,f=i;p<f.length;p++){var d=f[p];if(l+=d.weight,l>c)return d}return i[i.length-1]},e}();n.SplitSelector=i},{"@yieldify/gendry-hash-util":187}],14:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n,r){var o=e.call(this,t,n)||this;return o.action=r,o}return r(t,e),t.prototype.shouldAdvanceOverlay=function(){return"next"===this.action},t.prototype.getAction=function(){return this.action},t}(o.UserJourneyEvent);n.ClickThroughEvent=i},{"./UserJourneyEvent":19}],15:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(o.UserJourneyEvent);n.CloseEvent=i},{"./UserJourneyEvent":19}],16:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n,r,o,i){var s=e.call(this,t,n)||this;return s.form=r,s.inputValues=o,s.ctaAction=i,s}return r(t,e),t.prototype.getForm=function(){return this.form},t.prototype.getInputValues=function(){return this.inputValues},t.prototype.getCtaAction=function(){return this.ctaAction},t}(o.UserJourneyEvent);n.FormSubmissionEvent=i},{"./UserJourneyEvent":19}],17:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n,r){return e.call(this,t,n,r)||this}return r(t,e),t}(o.UserJourneyEvent);n.ImpressionEvent=i},{"./UserJourneyEvent":19}],18:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UserJourneyEvent"),i=function(e){function t(t,n){return e.call(this,t,n)||this}return r(t,e),t}(o.UserJourneyEvent);n.RedirectEvent=i},{"./UserJourneyEvent":19}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t,n){this.control=!!n,this.timestamp=t.currentTime(),this.source=e}return e.prototype.getTimestamp=function(){return this.timestamp},e.prototype.getSource=function(){return this.source},e.prototype.isControl=function(){return this.control},e.prototype.setSource=function(e){this.source=e},e}();n.UserJourneyEvent=r},{}],20:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../sandbox/modules/BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"analytics"},t.prototype["interface"]=function(){return{forwardEvent:this.forwardEvent}},t}(o.BaseModule);n.AnalyticsBase=i},{"../../../sandbox/modules/BaseModule":164}],21:[function(e,t,n){"use strict";function r(e,t){switch(t.type){case"CLICK_THROUGH":case"CLOSE_EVENT":case"IMPRESSION":case"FORM_SUBMIT":return e.forwardEvent(t);default:return null}}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./Base"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o(t,e),t.prototype.forwardEvent=function(e){return this.invokeMethod("forwardEvent",e)},t}(i.AnalyticsBase);n.AnalyticsClient=s,n.forwardToAnalytics=r},{"./Base":20}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../lib/Promise"),o=function(){function e(e,t,n){this.id=[t.idPrefix,e].join("-"),this.definition=t,this.children=n?n:[],this.style={}}return e.prototype.render=function(e){this.style=this.definition.getStyle(e);var t=this.children.map(function(t){return t.render(e)}).join(""),n=this.definition.elementType;return"<"+n+" "+this.renderAttributes(e)+">"+t+"</"+n+">"},e.prototype.update=function(e,t){var n=this,o=this.definition.getStyle(e),i=this.diffStyles(o);return this.style=o,r["default"].all(Object.keys(i).map(function(e){return t.style(n.getSelector(),e,i[e])}).concat(this.children.map(function(n){return n.update(e,t)}))).then(function(){})},e.prototype.getSelector=function(){return"#"+this.id},e.prototype.diffStyles=function(e){var t={};for(var n in e)e[n]!==this.style[n]&&(t[n]=e[n]);for(var n in this.style)void 0===e[n]&&(t[n]="");return t},e.prototype.getAttributes=function(e){return{id:this.id,style:this.renderStyle(e),"class":this.renderClass(e)}},e.prototype.renderAttributes=function(e){var t=[],n=this.getAttributes(e);for(var r in n){var o=n[r];void 0!==o&&t.push(r+'="'+o+'"')}return t.join(" ")},e.prototype.renderStyle=function(e){var t=[],n=this.definition.getStyle(e);for(var r in n)t.push(r+": "+n[r]+";");return t.join(" ")},e.prototype.renderClass=function(e){var t=this.definition.getClasses(e);return t.length>0?t.join(" "):void 0},e}();n.LayoutElement=o},{"../../lib/Promise":138}],23:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./fixes/iosFixes"),i=e("../../lib/browser/deviceUtil"),s=e("./commonElements"),a=e("./utils"),u=e("./fixes/mobileScaling"),c=e("./LayoutElement"),l=e("./OverlayLayout"),p=e("../execution-components/ExecutionComponent"),f=e("../../lib/Promise");n.MARGIN=15;var d=function(){function e(e){this.closeButtonSelector=".yie_esc_"+e,this.iframeWrapper=new c.LayoutElement(e,v,[new c.LayoutElement(e,s.CLOSE_BUTTON)]),this.outerElement=new c.LayoutElement(e,h,[this.iframeWrapper]),this.referenceElement=new c.LayoutElement(e,g,[])}return e.prototype.renderElements=function(e,t){var n=r({},e,{referencePoint:{x:0,y:0}});return f["default"].all([t.draw("body",this.outerElement.render(n)),t.draw("body",this.referenceElement.render(n))]).then(function(){})},e.prototype.updateElements=function(e,t){var n=this;return t.getBoundingClientRect(this.referenceElement.getSelector()).then(function(o){var i={x:o.left,y:o.top};return n.outerElement.update(r({},e,{referencePoint:i}),t)})},e.prototype.getOuterContainerSelector=function(){return this.outerElement.getSelector()},e.prototype.getIFrameParentSelector=function(){return this.iframeWrapper.getSelector()},e.prototype.getCloseButtonSelector=function(){return this.closeButtonSelector},e}();n.NotificationLayout=d;var h={elementType:"div",idPrefix:"yie-overlay",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings,s=e.overlayState,c=e.deviceType,f=s===p.ComponentState.IN_PROGRESS,d=1,h=a.positionProperties(t.position),v=h.vertical,g=h.horizontal,y=(b={position:"fixed"},b[v]="0px",b[g]="0px",b.visibility=f?"visible":"hidden",b.overflow=f?"visible":"hidden",b["max-width"]="none",b["max-height"]="none",b.width=f?t.dimensions.width:"0px",b.height=f?t.dimensions.height:"0px",b.margin=n.MARGIN+"px",b["z-index"]=""+(l.OVERLAY_Z_INDEX-1),b["transform-origin"]=v+" "+g,b["-ms-transform-origin"]=v+" "+g,b["-webkit-transform-origin"]=v+" "+g,b);return c!==i.DeviceType.DESKTOP&&(d=a.calculateScaling(e,n.MARGIN,n.MARGIN)),r({},y,u.mobileScalingInNotifications(e,d),o.iosFixesInNotifications(e,d));var b}},v={elementType:"div",idPrefix:"yie-overlay-wrapper",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings;return{position:"absolute",top:"0px",left:"0px",width:t.dimensions.width,height:t.dimensions.height}}},g={elementType:"div",idPrefix:"yie-reference",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings,n=a.positionProperties(t.position),r=n.vertical,o=n.horizontal;return i={position:"fixed",width:"0px",height:"0px"},i[r]="0px",i[o]="0px",i;var i}}},{"../../lib/Promise":138,"../../lib/browser/deviceUtil":148,"../execution-components/ExecutionComponent":10,"./LayoutElement":22,"./OverlayLayout":24,"./commonElements":25,"./fixes/iosFixes":27,"./fixes/mobileScaling":29,"./utils":30}],24:[function(e,t,n){"use strict";var r=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var o=e("./fixes/iosSoftKeyboardFix"),i=e("./utils"),s=e("../../lib/browser/deviceUtil"),a=e("./commonElements"),u=e("./fixes/mobileScaling"),c=e("./LayoutElement"),l=e("../execution-components/ExecutionComponent"),p=e("./fixes/iosFixedPositionInputsHack");n.OVERLAY_Z_INDEX=2147483646;var f=function(){function e(e){this.closeButtonSelector=".yie_esc_"+e,this.wrapper=new c.LayoutElement(e,v,[new c.LayoutElement(e,a.CLOSE_BUTTON)]),this.backdrop=new c.LayoutElement(e,a.BACKDROP),this.outerElement=new c.LayoutElement(e,d,[this.backdrop,new c.LayoutElement(e,h,[this.wrapper])])}return e.prototype.renderElements=function(e,t){var n=r({},e,{referencePoint:{x:0,y:0}});return t.draw("body",this.outerElement.render(n))},e.prototype.updateElements=function(e,t){var n=this;return t.getBoundingClientRect(this.backdrop.getSelector()).then(function(o){var i={x:o.left,y:o.top};return n.outerElement.update(r({},e,{referencePoint:i}),t)})},e.prototype.getOuterContainerSelector=function(){return this.outerElement.getSelector()},e.prototype.getIFrameParentSelector=function(){return this.wrapper.getSelector()},e.prototype.getCloseButtonSelector=function(){return this.closeButtonSelector},e}();n.OverlayLayout=f;var d={elementType:"div",idPrefix:"yie-overlay",getClasses:function(e){return[]},getStyle:function(e){var t=e.overlayState===l.ComponentState.IN_PROGRESS,o={position:"fixed",visibility:t?"visible":"hidden",top:"0px",left:"0px",overflow:t?"visible":"hidden",width:t?"100%":"0px",height:t?"200%":"0px","max-height":"none","max-width":"none","z-index":""+n.OVERLAY_Z_INDEX};return r({},o,p.iosFixedPositionInputsHackInOverlays(e))}},h={elementType:"div",idPrefix:"yie-inner-overlay",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings,n=e.deviceType,a=e.windowDimensions,c=-parseInt(t.dimensions.height,10)/2,l=-parseInt(t.dimensions.width,10)/2,p=1,f={position:"absolute",top:"25%",left:"50%","max-width":"none","max-height":"none",width:t.dimensions.width,height:t.dimensions.height,"margin-top":c+"px","margin-left":l+"px"};if(n!==s.DeviceType.DESKTOP){var d=.05*a.width,h=.05*a.height;p=i.calculateScaling(e,d,h)}return r({},f,u.mobileScalingInOverlays(e,p),o.iosSoftKeyboardFixInInnerOverlay(e,p))}},v={elementType:"div",idPrefix:"yie-overlay-wrapper",getClasses:function(e){return[]},getStyle:function(e){var t=e.settings;return{width:t.dimensions.width,height:t.dimensions.height}}}},{"../../lib/browser/deviceUtil":148,"../execution-components/ExecutionComponent":10,"./LayoutElement":22,"./commonElements":25,"./fixes/iosFixedPositionInputsHack":26,"./fixes/iosSoftKeyboardFix":28,"./fixes/mobileScaling":29,"./utils":30}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="https://dwmvwp56lzq5t.cloudfront.net/assets/close-button-shadow.svg";n.CLOSE_BUTTON={elementType:"span",idPrefix:"yie-close-button",getClasses:function(e){var t=e.uuid;return["yie_esc_"+t]},getStyle:function(e){var t=e.settings,n=t.closeButton,o=n&&n.position?n.position:{right:0,top:0};return{cursor:"pointer",position:"absolute",right:o.right+"px",top:o.top+"px",display:"block",width:"30px",height:"30px","background-image":"url("+r+")","background-repeat":"no-repeat",margin:"-15px"}}},n.BACKDROP={elementType:"div",idPrefix:"yie-backdrop",getClasses:function(e){var t=e.uuid;return["yie_esc_"+t]},getStyle:function(e){return{position:"absolute",top:"0px",left:"0px",right:"0px",bottom:"0px",opacity:"0.7","background-color":"rgb(0, 0, 0)","-webkit-transform":"translateZ(0)","-moz-transform":"translateZ(0)","-ms-transform":"translateZ(0)","-o-transform":"translateZ(0)",transform:"translateZ(0)"}}}},{}],26:[function(e,t,n){"use strict";function r(e){return i.IS_IOS_11&&e.focused?{position:"absolute",top:e.windowDimensions._iOS11_top+"px"}:{}}function o(e,t){if(!i.IS_IOS_11||!e.focused)return{};var n=parseInt(e.settings.dimensions.height,10)*t+2*s.MARGIN,r=e.windowDimensions.height/a,o=r-n/2,u=Math.round(e.windowDimensions._iOS11_top+o);return{position:"absolute",top:u+"px",bottom:"unset"}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/browser/WindowUtil"),s=e("../NotificationLayout"),a=3;n.iosFixedPositionInputsHackInOverlays=r,n.iosFixedPositionInputsHackInNotifications=o},{"../../../lib/browser/WindowUtil":147,"../NotificationLayout":23}],27:[function(e,t,n){"use strict";function r(e,t){return s.IS_IOS_11?o.iosFixedPositionInputsHackInNotifications(e,t):i.iosSoftKeyboardFix(e,t)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./iosFixedPositionInputsHack"),i=e("./iosSoftKeyboardFix"),s=e("../../../lib/browser/WindowUtil");n.iosFixesInNotifications=r},{"../../../lib/browser/WindowUtil":147,"./iosFixedPositionInputsHack":26,"./iosSoftKeyboardFix":28}],28:[function(e,t,n){"use strict";function r(e,t){function n(e){var t,n,r;return"vertical"===e?(t=p.height/c,r=i.y,"top"===h?(n=t-g/2,Math.round(n-r)):(n=t+g/2,Math.round(r-n))):(t=p.width/l,r=i.x,"left"===v?(n=t-y/2,Math.round(n-r)):(n=t+y/2,Math.round(r-n)))}var r=e.focused,o=e.deviceType,i=e.referencePoint,p=e.windowDimensions,f=e.settings;if(!r||o===s.DeviceType.DESKTOP)return{};var d=a.positionProperties(f.position),h=d.vertical,v=d.horizontal,g=parseInt(f.dimensions.height,10)*t+2*u.MARGIN,y=parseInt(f.dimensions.width,10)*t+2*u.MARGIN,b={};return("top"===h&&0!==i.y||"bottom"===h&&i.y!==p.height)&&(b[h]=n("vertical")+"px"),("left"===v&&0!==i.x||"right"===v&&i.x!==p.width)&&(b[v]=n("horizontal")+"px"),b}function o(e,t){var n=e.deviceType,r=e.referencePoint,o=e.focused;if(n===s.DeviceType.DESKTOP)return{};var u=a.centredOffset(e,t),c=u.left,l=u.top;return(r.y<0||i.IS_IOS_11)&&o&&(l/=3,l-=r.y,c-=r.x),{top:l+"px",left:c+"px"}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/browser/WindowUtil"),s=e("../../../lib/browser/deviceUtil"),a=e("../utils"),u=e("../NotificationLayout"),c=3,l=2;n.iosSoftKeyboardFix=r,n.iosSoftKeyboardFixInInnerOverlay=o},{"../../../lib/browser/WindowUtil":147,"../../../lib/browser/deviceUtil":148,"../NotificationLayout":23,"../utils":30}],29:[function(e,t,n){"use strict";function r(e,t){var n=e.deviceType;if(n===i.DeviceType.DESKTOP)return{};var r=s.centredOffset(e,t),o=r.left,a=r.top;return{transform:"scale("+t+")","-ms-transform":"scale("+t+")","-webkit-transform":"scale("+t+")","transform-origin":"0 0","-ms-transform-origin":"0 0","-webkit-transform-origin":"0 0",top:a+"px",left:o+"px","margin-top":"0px","margin-left":"0px","margin-bottom":"0px","margin-right":"0px"}}function o(e,t){var n=e.deviceType;return n===i.DeviceType.DESKTOP?{}:{transform:"scale("+t+")","-ms-transform":"scale("+t+")","-webkit-transform":"scale("+t+")"}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/browser/deviceUtil"),s=e("../utils");n.mobileScalingInOverlays=r,n.mobileScalingInNotifications=o},{"../../../lib/browser/deviceUtil":148,"../utils":30}],30:[function(e,t,n){"use strict";function r(e,t){var n=e.settings,r=e.windowDimensions,o=parseInt(n.dimensions.width,10),i=parseInt(n.dimensions.height,10),s=(r.width-o*t)/2,a=(r.height-i*t)/2;return{left:s,top:a}}function o(e,t,n){var r=e.settings,o=e.windowDimensions,i=parseInt(r.dimensions.width,10),s=parseInt(r.dimensions.height,10),a=1,u=Math.min(a,Math.min((o.width-2*t)/i,(o.height-2*n)/s));return Math.round(1e4*u)/1e4}function i(e){switch(e){case"TopRight":return{vertical:"top",horizontal:"right"};case"TopLeft":return{vertical:"top",horizontal:"left"};case"BottomRight":return{vertical:"bottom",horizontal:"right"};case"BottomLeft":return{vertical:"bottom",horizontal:"left"};default:throw new Error("This layout is not valid for the position "+e)}}Object.defineProperty(n,"__esModule",{value:!0}),n.centredOffset=r,n.calculateScaling=o,n.positionProperties=i},{}],31:[function(e,t,n){"use strict";function r(e){return'[y-id="'+e+'"]'}Object.defineProperty(n,"__esModule",{value:!0}),n.getElementIdSelector=r},{}],32:[function(e,t,n){"use strict";function r(e,t){t instanceof q.CachingObservable&&c.logger.debug({initialValue:t.getCurrentValue()},"Initial value for "+e),t.subscribe(function(t){c.logger.debug({newValue:t},"Updated value for "+e)})}function o(e){return function(t){r("DataLayer("+t+")",e.getValue(t).getObservable())}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./redux/actions/domain-entity-properties"),s=e("../lib/utils"),a=e("../lib/utils"),u=e("../lib/browser/CookieUtil"),c=e("../lib/Logger"),l=e("../lib/events/EventTargetUtil"),p=e("../lib/AsyncWorker"),f=e("../lib/object"),d=e("./storage/thirdPartyLocalStorage"),h=e("./model/DataLayer"),v=e("../lib/browser/deviceUtil"),g=e("./model/MouseOut"),y=e("./model/DesktopExitIntention"),b=e("./model/MobileExitIntention"),m=e("./model/PageVisibility"),_=e("./model/PageFocus"),E=e("./model/PageUrl"),O=e("./model/CanonicalisedPageUrl"),w=e("./model/page/page-elements/PageElementValueCreator"),S=e("./model/page/PageCreator"),C=e("./redux/reducers/domain-entity-properties"),P=e("./redux/sagas/domainEntityPropertyUpdateDispatcher"),I=e("./tracker/Emitter"),R=e("./tracker/EventTracker"),T=e("./preconditions/ExpressionFactory"),x=e("./triggers/Factory"),M=e("../sandbox/modules/dom/Client"),L=e("./execution-components/ExecutionCollectionCreator"),A=e("./execution-components/ExecutionComponentCreator"),D=e("./execution-components/ExecutionCollectionController"),N=e("./execution-components/CollectionSelector"),j=e("./execution-components/SplitSelector"),k=e("../sandbox/modules/window/Client"),U=e("../sandbox/modules/cookie/Client"),V=e("../sandbox/modules/local-storage/Client"),F=e("../sandbox/modules/iframe/Client"),B=e("./redux/reducers/labelled-last-impressions"),G=e("./redux/reducers/last-impression"),Y=e("./redux/reducers/last-component-submitted"),H=e("./storage/y2Cookie"),K=e("./storage/yiCookie"),W=e("./model/VisitorType"),q=e("../lib/CachingObservable"),J=e("../lib/Observable"),X=e("../sandbox/remote-windows/RemoteWindow"),z=e("../sandbox/remote-windows/CrossOriginClient"),Q=e("../lib/RandomSource"),Z=e("../lib/TimeProvider"),$=e("../lib/UUIDGenerator"),ee=e("./model/site/SaleDetector"),te=e("./model/site/PageView"),ne=e("./model/form/FormCreator"),re=e("./model/form/ValidationRuleCreator"),oe=e("./redux/reducers/time"),ie=e("./redux/actions/page"),se=e("./redux/reducers/page"),ae=e("./redux/actions/sale-detected"),ue=e("./redux/actions/window-dimensions"),ce=e("./redux/actions/log"),le=e("./redux/actionRelay"),pe=e("./redux/actionListener"),fe=e("./redux/reducers/urls-visited"),de=e("./redux/reducers/user"),he=e("./redux/reducers/session"),ve=e("./redux/reducers/geolocation"),ge=e("./redux/storage"),ye=e("./storage/cookie"),be=e("./redux/tag"),me=e("../lib/Redux"),_e=e("../lib/browser/httpUtil"),Ee=e("../lib/jsonrpc/JsonRpcClient"),Oe=e("./redux/sagas/pageViews"),we=e("./redux/sagas/session"),Se=e("./redux/sagas/geolocation"),Ce=e("./storage/cookieDomainUtils"),Pe=e("./redux/actionTimestamper"),Ie=e("./api/Client"),Re=e("./redux/actions/exit-intent"),Te=e("./redux/reducers/device"),xe=e("./integrations/analytics/Client");a.initialiseDebugMode(window),a.isDebugMode()&&(c.logger.setLevel(c.Level.DEBUG),c.logger.enableConsoleLogging());try{l.EventTargetUtil.addEventListener(window,"error",function(e){c.logger.error({error:e},"Error in main.ts (global error handler)"),e.preventDefault()});var Me=new z.CrossOriginClient(window),Le=new M.DOMClient,Ae=new k.WindowClient,De=new F.IFrameClient,Ne=new V.LocalStorageClient,je=new Ie.APIClient,ke=new xe.AnalyticsClient,Ue={provide:[Le,Ae,new U.CookieClient,De,Ne,je,ke]};Me.connect(window.parent).then(X.RemoteWindow.connect(JSON,Ue)).then(function(e){function t(e,t,n){return{start:function(){e.publish(t(n.getState()))}}}var n=JSON.parse(e.getConfig());c.logger.debug({initConfig:n},"Parsed InitConfig");var s=JSON.parse(n.websiteConfig);c.logger.debug({websiteConfig:s},"Parsed website configuration");var l=new Z.TimeProvider(Z.TimeProvider.parseSeedFromHash(window.location.hash)),V=e.getModuleByClass(U.CookieClient),F=Ce.getCookieDomain(n.location.hostname,s.cookieDomain),X=u.CookieUtil.parseCookieStr(n.cookies),z=l.currentTime(),Ie=new $.UUIDGenerator,Me=new I.Emitter(document,JSON,s.trackerEndpoint),Ue=new R.EventTracker(Me,l,n.tagVersion),Ve=Pe.actionTimestamperMiddleware(l),Fe=le.actionRelayMiddleware(le.SANDBOX_SOURCE),Be=pe.actionListenerMiddleware(null,function(e,t){Ue.handleAction(e,t),s.gaIntegration&&xe.forwardToAnalytics(ke,e)}),Ge=null;try{Ge=localStorage}catch(Ye){c.logger.warn({error:Ye},"Usage of third-party local storage is blocked")}var He=me.createStore(be.tagReducer(),be.initialState({config:s,sandboxConfig:n,cookieDomain:F,thirdPartyLocalStorage:Ge,cookieJar:X,currentTime:z,uuidGenerator:Ie,deviceType:v.detectDeviceType(navigator)}),me.reduxDebugEnabledEnhancer(a.isDebugMode())(me.applyMiddleware(Ve,Fe,Be)));c.logger.subscribe(function(e){return He.dispatch(ce.logMessage(e))}),c.logger.debug({state:He.getState()},"Main store initialised"),a.isDebugMode()&&(window.store=He),ge.connectPersistence(He,d.thirdPartyLocalStorageSerialisedState,d.persistToThirdPartyLocalStorage(Ge,s.websiteId,Ne)),ge.connectPersistence(He,K.yiCookieSerialisedState,ye.persistToCookie(K.YI_COOKIE_NAME,V,F,X,n.location.hostname)),ge.connectPersistence(He,H.y2CookieSerialisedState,ye.persistToCookie(H.Y2_COOKIE_NAME,V,F,X,n.location.hostname)),setInterval(oe.updateTime(He,l),oe.UPDATE_TIME_INTERVAL_MS),Ae.observeInnerDimensions().dispatchAs(ue.windowDimensionsUpdated,He);var Ke=[],We=new h.DataLayer;je.start(He);var qe;if(Te.deviceType(He.getState())===v.DeviceType.DESKTOP){var Je=new g.MouseOut(e.getModuleByClass(M.DOMClient));qe=new y.DesktopExitIntention(Je),Ke.push(Je),Ke.push(qe)}else{var Xe=new m.PageVisibility(document),ze=new _.PageFocusGain(e.getModuleByClass(k.WindowClient),Xe),Qe=new _.PageFocusLoss(e.getModuleByClass(k.WindowClient),Xe);qe=new b.MobileExitIntention(ze,Qe,l),Ke.push(Xe),Ke.push(ze),Ke.push(Qe),Ke.push(qe)}qe.dispatchAs(Re.exitIntent,He);var Ze=new E.PageUrl(e.getModuleByClass(k.WindowClient));Ze.dispatchAs(ie.pageUrlUpdated,He);var $e=new te.PageView(l,He),et=new O.CanonicalisedPageUrl(Ze);Ke.push(Ze),Ke.push($e),Ke.push(et);var tt=q.CachingObservable.cache(J.Observable.fromSelector(he.session,He));if(Ke.push(t(tt,he.session,He)),s.scraping){var nt=new w.PageElementValueCreator(Le,He),rt=new S.PageCreator(nt,He),ot=rt.create(s.scraping.pageTypes);Ke.push(ot)}else c.logger.error({},"No scraping configuration present");var it=new p.AsyncWorker,st=new Q.RandomSource,at=new x.TriggerFactory(qe),ut=new T.ExpressionFactory(We),ct=s&&s.mapping&&s.mapping.thankYou?s.mapping.thankYou:void 0,lt=new j.SplitSelector,pt=new N.CollectionSelector(He,lt),ft=new re.ValidationRuleCreator,dt=new ne.FormCreator(ft,l),ht=new L.ExecutionCollectionCreator(new A.ExecutionComponentCreator(Le,Ae,De,at,ut,dt,window,l,He),ut,Te.deviceType(He.getState())),vt=new D.ExecutionCollectionController(s.campaigns,ht,pt,it,st,window.navigator,D.DEVICE_BLACKLIST,He);Ke.push(vt),vt.connectToStore(He);var gt=new ee.SaleDetector(ct,He,Ie,l);gt.getEventObservable().dispatchAs(ae.saleDetected,He);var yt=J.Observable.fromSelector(Y.lastComponentSubmitted,He);Ke.push(t(yt,Y.lastComponentSubmitted,He));var bt=new W.VisitorType(tt);Ke.push(bt);var mt=J.Observable.fromSelector(B.secondsSinceLabelledLastImpressions,He);Ke.push(t(mt,B.secondsSinceLabelledLastImpressions,He)),Ke.push(gt);var _t=o(We),Et=J.Observable.fromSelector(ve.geolocationCountry,He);Ke.push(t(Et,ve.geolocationCountry,He));var Ot=J.Observable.fromSelector(de.user,He);Ke.push(t(Ot,de.user,He));var wt=J.Observable.fromSelector(G.secondsSinceLastImpression,He);Ke.push(t(wt,G.secondsSinceLastImpression,He));var St=J.Observable.fromSelector(fe.urlsVisitedDataLayerValues,He);Ke.push(t(St,fe.urlsVisitedDataLayerValues,He));var Ct=J.Observable.fromSelector(se.pageViewsDatalayerValues,He);Ke.push(t(Ct,se.pageViewsDatalayerValues,He));var Pt=J.Observable.fromSelector(C.domainEntityPropertyValues,He);Ke.push(t(Pt,C.domainEntityPropertyValues,He));var It=B.allLabels(He.getState());It.forEach(function(e){var t=J.Observable.pluck(mt,e),n=B.secondsSinceLabelledLastImpressionDatalayerKey(e);We.registerValue(n,q.CachingObservable.cache(t),h.DataLayerType.NUMBER)});var Rt=J.Observable.fromSelector(Te.deviceType,He);We.registerValue("device",q.CachingObservable.cache(Rt),h.DataLayerType.STRING),_t("device"),We.registerValue("currentUrl",et,h.DataLayerType.STRING),_t("currentUrl"),We.registerValue("session/referrer",q.CachingObservable.cache(J.Observable.pluck(tt,"sessionReferrer")),h.DataLayerType.STRING),_t("session/referrer"),We.registerValue("user/location/country",q.CachingObservable.cache(Et),h.DataLayerType.STRING),_t("user/location/country"),We.registerValue("user/hasPurchased",q.CachingObservable.cache(J.Observable.pluck(Ot,"hasPurchased")),h.DataLayerType.BOOLEAN),_t("user/hasPurchased"),We.registerValue("user/isLead",q.CachingObservable.cache(J.Observable.pluck(Ot,"isLead")),h.DataLayerType.BOOLEAN),_t("user/isLead"),We.registerValue("visitorType",bt,h.DataLayerType.STRING),_t("visitorType"),We.registerValue("secondsSinceLastImpression",q.CachingObservable.cache(wt),h.DataLayerType.NUMBER),
We.registerValue("lastExecutionComponentSubmitted",q.CachingObservable.cache(yt),h.DataLayerType.STRING),_t("lastExecutionComponentSubmitted");for(var Tt in fe.urlsVisitedDataLayerValues(He.getState()))We.registerValue(Tt,q.CachingObservable.cache(J.Observable.pluck(St,Tt)),h.DataLayerType.BOOLEAN),_t(Tt);for(var xt=0,Mt=f.keys(se.pageViewsDatalayerValues(He.getState()));xt<Mt.length;xt++){var Tt=Mt[xt];We.registerValue(Tt,q.CachingObservable.cache(J.Observable.pluck(Ct,Tt)),h.DataLayerType.NUMBER),_t(Tt)}var Lt=C.domainEntityPropertyValues(He.getState());for(var Tt in Lt){var At=Lt[Tt];We.registerValue(C.propertyDatalayerKey(At),q.CachingObservable.cache(J.Observable.pluck(J.Observable.pluck(Pt,Tt),"value")),C.propertyDatalayerDataType(At)),_t(C.propertyDatalayerKey(At))}for(c.logger.debug({numModels:Ke.length},"Starting models");Ke.length>0;)Ke.pop().start();c.logger.debug({executionCollectionController:vt},"Initialisation complete"),r("session",tt),r("executionCollectionControllerEvent",vt.getEventObservable()),gt&&r("saleDetectorEvent",gt.getEventObservable());var Dt=Ee.newJsonRpcClient({gatewayEndpoint:s.gatewayEndpoint,send:_e.sendHttpRequest,uuidGenerator:Ie,version:n.tagVersion});Se.updateGeolocation(He,Dt),Oe.updatePageViews(He,Dt),we.watchSession(He),P.domainEntityPropertyUpdateDispatcher(He,function(e){He.dispatch(i.domainEntityPropertyUpdated(e))})}).then(s.noop,function(e){c.logger.error({error:e},"Error in main.ts (initial promise chain)")})}catch(Ve){c.logger.error({error:Ve},"Error in main.ts (sync try catch)")}},{"../lib/AsyncWorker":129,"../lib/CachingObservable":132,"../lib/Logger":136,"../lib/Observable":137,"../lib/RandomSource":140,"../lib/Redux":141,"../lib/TimeProvider":143,"../lib/UUIDGenerator":144,"../lib/browser/CookieUtil":145,"../lib/browser/deviceUtil":148,"../lib/browser/httpUtil":149,"../lib/events/EventTargetUtil":151,"../lib/jsonrpc/JsonRpcClient":153,"../lib/object":156,"../lib/utils":163,"../sandbox/modules/cookie/Client":167,"../sandbox/modules/dom/Client":169,"../sandbox/modules/iframe/Client":171,"../sandbox/modules/local-storage/Client":174,"../sandbox/modules/window/Client":178,"../sandbox/remote-windows/CrossOriginClient":179,"../sandbox/remote-windows/RemoteWindow":181,"./api/Client":1,"./execution-components/CollectionSelector":4,"./execution-components/ExecutionCollectionController":8,"./execution-components/ExecutionCollectionCreator":9,"./execution-components/ExecutionComponentCreator":11,"./execution-components/SplitSelector":13,"./integrations/analytics/Client":21,"./model/CanonicalisedPageUrl":33,"./model/DataLayer":34,"./model/DesktopExitIntention":35,"./model/MobileExitIntention":36,"./model/MouseOut":37,"./model/PageFocus":38,"./model/PageUrl":39,"./model/PageVisibility":40,"./model/VisitorType":41,"./model/form/FormCreator":43,"./model/form/ValidationRuleCreator":46,"./model/page/PageCreator":48,"./model/page/page-elements/PageElementValueCreator":55,"./model/site/PageView":58,"./model/site/SaleDetector":60,"./preconditions/ExpressionFactory":65,"./redux/actionListener":69,"./redux/actionRelay":70,"./redux/actionTimestamper":71,"./redux/actions/domain-entity-properties":75,"./redux/actions/exit-intent":76,"./redux/actions/log":81,"./redux/actions/page":83,"./redux/actions/sale-detected":84,"./redux/actions/window-dimensions":88,"./redux/reducers/device":90,"./redux/reducers/domain-entity-properties":91,"./redux/reducers/geolocation":92,"./redux/reducers/labelled-last-impressions":93,"./redux/reducers/last-component-submitted":94,"./redux/reducers/last-impression":95,"./redux/reducers/page":99,"./redux/reducers/session":100,"./redux/reducers/time":101,"./redux/reducers/urls-visited":103,"./redux/reducers/user":104,"./redux/sagas/domainEntityPropertyUpdateDispatcher":106,"./redux/sagas/geolocation":107,"./redux/sagas/pageViews":108,"./redux/sagas/session":109,"./redux/storage":111,"./redux/tag":112,"./storage/cookie":115,"./storage/cookieDomainUtils":116,"./storage/thirdPartyLocalStorage":118,"./storage/y2Cookie":120,"./storage/yiCookie":121,"./tracker/Emitter":122,"./tracker/EventTracker":123,"./triggers/Factory":127}],33:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=e("../../lib/browser/UrlUtil"),s=function(e){function t(t){var n=e.call(this)||this;return n.pageUrl=t,n}return r(t,e),t.prototype.start=function(){var e=this;this.pageUrl.subscribe(function(t){e.process(t)})},t.prototype.process=function(e){this.publish(i.UrlUtil.canonicalise(e))},t}(o.CachingObservable);n.CanonicalisedPageUrl=s},{"../../lib/CachingObservable":132,"../../lib/browser/UrlUtil":146}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e[e.STRING=0]="STRING",e[e.NUMBER=1]="NUMBER",e[e.BOOLEAN=2]="BOOLEAN"}(r=n.DataLayerType||(n.DataLayerType={}));var o=function(){function e(){this.values={}}return e.prototype.registerValue=function(e,t,n){if(this.values[e])throw new Error("Key already has an assigned observable: "+e);this.values[e]=new i(t,n)},e.prototype.getValue=function(e){return this.values[e]||void 0},e}();n.DataLayer=o;var i=function(){function e(e,t){this.observable=e,this.type=t}return e.prototype.getObservable=function(){return this.observable},e.prototype.getType=function(){return this.type},e}();n.DataLayerValue=i},{}],35:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable");n.MAX_CLIENT_Y=4;var i=function(e){function t(t){var n=e.call(this)||this;return n.mouseOut=t,n}return r(t,e),t.prototype.start=function(){this.mouseOut.filter(function(e){return e.clientY<=n.MAX_CLIENT_Y}).subscribe(this.publish.bind(this))},t}(o.Observable);n.DesktopExitIntention=i},{"../../lib/Observable":137}],36:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable");n.FOCUSLOSS_THRESHOLD_SECONDS=5;var i=function(e){function t(t,n,r){var o=e.call(this)||this;return o.pageFocusGain=t,o.pageFocusLoss=n,o.timeProvider=r,o}return r(t,e),t.prototype.start=function(){var e=this;this.pageFocusLoss.subscribe(this.setFocusLossTimestamp.bind(this)),this.pageFocusGain.filter(function(){return e.isValidExitIntent()}).subscribe(this.publish.bind(this))},t.prototype.setFocusLossTimestamp=function(){this.focusLossTimestamp=this.timeProvider.currentTime()},t.prototype.isValidExitIntent=function(){if("undefined"!=typeof this.focusLossTimestamp){var e=(this.timeProvider.currentTime()-this.focusLossTimestamp)/1e3;if(e>=n.FOCUSLOSS_THRESHOLD_SECONDS)return!0}return!1},t}(o.Observable);n.MobileExitIntention=i},{"../../lib/Observable":137}],37:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=function(e){function t(t){var n=e.call(this)||this;return n.dom=t,n}return r(t,e),t.prototype.start=function(){this.dom.listen("html","mouseout").subscribe(this.publish.bind(this))},t}(o.Observable);n.MouseOut=i},{"../../lib/Observable":137}],38:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=function(e){function t(t,n){var r=e.call(this)||this;return r.windowClient=t,r.pageVisibility=n,r}return r(t,e),t}(o.Observable),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.start=function(){var e=this;this.windowClient.listen("blur").subscribe(this.publish.bind(this)),this.pageVisibility.filter(function(){return e.pageVisibility.isHidden()}).subscribe(this.publish.bind(this))},t}(i);n.PageFocusLoss=s;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.start=function(){var e=this;this.windowClient.listen("focus").subscribe(this.publish.bind(this)),this.pageVisibility.filter(function(){return!e.pageVisibility.isHidden()}).subscribe(this.publish.bind(this))},t}(i);n.PageFocusGain=a},{"../../lib/Observable":137}],39:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=function(e){function t(t){var n=e.call(this)||this;return n.windowClient=t,n}return r(t,e),t.prototype.start=function(){var e=this;this.windowClient.observeLocation().subscribe(function(t){e.publish(t.href)})},t}(o.CachingObservable);n.PageUrl=i},{"../../lib/CachingObservable":132}],40:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/events/EventTargetUtil"),i=e("../../lib/Observable"),s="Unrecognized Page Visibility API",a=function(e){function t(t){var n=e.call(this)||this;return n.documentLike=t,n.setup(),n}return r(t,e),t.isStandardsDocumentLike=function(e){return"undefined"!=typeof e.hidden},t.isMozDocumentLike=function(e){return"undefined"!=typeof e.mozHidden},t.isMsDocumentLike=function(e){return"undefined"!=typeof e.msHidden},t.isWebkitDocumentLike=function(e){return"undefined"!=typeof e.webkitHidden},t.prototype.start=function(){o.EventTargetUtil.addEventListener(this.documentLike,this.visibilityChangeEvent,this.publish.bind(this))},t.prototype.isHidden=function(){var e=this.documentLike;if(t.isStandardsDocumentLike(e))return e.hidden;if(t.isMozDocumentLike(e))return e.mozHidden;if(t.isMsDocumentLike(e))return e.msHidden;if(t.isWebkitDocumentLike(e))return e.webkitHidden;throw new Error(s)},t.prototype.setup=function(){var e=this.documentLike;if(t.isStandardsDocumentLike(e))this.visibilityChangeEvent="visibilitychange";else if(t.isMozDocumentLike(e))this.visibilityChangeEvent="mozvisibilitychange";else if(t.isMsDocumentLike(e))this.visibilityChangeEvent="msvisibilitychange";else{if(!t.isWebkitDocumentLike(e))throw new Error(s);this.visibilityChangeEvent="webkitvisibilitychange"}},t}(i.Observable);n.PageVisibility=a},{"../../lib/Observable":137,"../../lib/events/EventTargetUtil":151}],41:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=e("../redux/reducers/session");n.VISITOR_TYPE={NEW:"new",RETURNING:"returning"};var s=function(e){function t(t){var n=e.call(this)||this;return n.session=t,n}return r(t,e),t.prototype.start=function(){var e=this;this.session.subscribe(function(t){e.detectVisitorType(t)})},t.prototype.detectVisitorType=function(e){var t=this.isReturningUser(e)?n.VISITOR_TYPE.RETURNING:n.VISITOR_TYPE.NEW;this.publishIfChanged(t)},t.prototype.isReturningUser=function(e){return e.sessionCount>i.STARTING_SESSION_COUNT},t}(o.CachingObservable);n.VisitorType=s},{"../../lib/CachingObservable":132,"../redux/reducers/session":100}],42:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../execution-components/events/FormSubmissionEvent"),i=e("../../../lib/Observable"),s=e("../../../lib/Logger"),a=e("../../../lib/Promise"),u=function(e){function t(t,n,r,o){var i=e.call(this)||this;return i.inputs=t,i.cta=n,i.submitting=!1,i.timeProvider=r,i.ctaAction=o,i}return r(t,e),t.prototype.start=function(){var e=this;this.cta.subscribe(function(){s.logger.debug({form:e},"Submitting form"),e.submit()}),this.focusObservable=i.Observable.merge(this.inputs.map(function(e){return e.getFocusObservable()}))},t.prototype.getInputs=function(){return this.inputs},t.prototype.getFocusObservable=function(){return this.focusObservable},t.prototype.submit=function(){var e=this;if(!this.submitting)return this.submitting=!0,this.getInputValues().then(function(t){s.logger.debug({form:e},"Form submited"),e.publish(new o.FormSubmissionEvent(null,e.timeProvider,e,t,e.ctaAction)),e.submitting=!1},function(t){return e.submitting=!1,a["default"].reject(t)})},t.prototype.getInputValues=function(){return a["default"].all(this.inputs.map(function(e){return e.getValue()}))},t}(i.Observable);n.Form=u},{"../../../lib/Logger":136,"../../../lib/Observable":137,"../../../lib/Promise":138,"../../execution-components/events/FormSubmissionEvent":16}],43:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Form"),i=e("./InputField"),s=e("../../execution-components/EventListenerObservable"),a=e("../../../lib/Creator"),u=e("../../../lib/Observable"),c=e("../../../lib/events/DOMEventType"),l=e("../../lib/utils"),p=function(e){function t(t,n){var r=e.call(this)||this;return r.ruleCreator=t,r.timeProvider=n,r}return r(t,e),t.prototype.create=function(e,t){var n=this,r=e.children.filter(function(e){return"cta"===e.type});if(1!==r.length)throw new Error("There must be one CTA for form. Got: "+r.length);var a=new s.EventListenerObservable(c.DOMEventType.SUBMIT,"form",t,(!0)),p=new s.EventListenerObservable(c.DOMEventType.CLICK,l.getElementIdSelector(r[0].id),t,(!0)),f=u.Observable.merge([a,p]);a.start();var d=e.children.filter(function(e){return"input"===e.type}).map(function(e){var r=e.validationRules.map(function(e){return n.ruleCreator.create(e)});return new i.InputField(e.id,e.name,r,t)});return new o.Form(d,f,this.timeProvider,r[0].onClick)},t}(a.Creator);n.FormCreator=p},{"../../../lib/Creator":133,"../../../lib/Observable":137,"../../../lib/events/DOMEventType":150,"../../execution-components/EventListenerObservable":6,"../../lib/utils":31,"./Form":42,"./InputField":44}],44:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../lib/Logger"),o=e("../../lib/utils"),i=e("../../../lib/Observable"),s=e("../../../lib/Promise"),a={"border-right":"4px solid #C62828",color:"#C62828","box-shadow":"0px 0px 6px 0px #C62828"},u=function(){function e(e,t,n,r){this.id=e,this.selector=o.getElementIdSelector(e),this.name=t,this.validationRules=n,this.value=null,this.domClient=r}return e.prototype.getValue=function(){var e=this;return this.fetchValue().then(function(t){var n=e.validateValue(t);return n.length>0?e.setErrorState(n[0]).then(function(){return s["default"].reject(new Error("validation failed"))}):{elementId:e.id,name:e.name,value:t}})},e.prototype.validate=function(){var e=this;return this.fetchValue().then(function(t){var n=e.validateValue(t);return 0===n.length||(e.setErrorState(n[0]),!1)})},e.prototype.getFocusObservable=function(){return i.Observable.merge([this.domClient.listen(this.selector,"focus"),this.domClient.listen(this.selector,"blur")])},e.prototype.fetchValue=function(){return this.domClient.getInputValue(this.selector)},e.prototype.validateValue=function(e){return this.validationRules.filter(function(t){return!t.validate(e)})},e.prototype.setErrorState=function(e){r.logger.debug({field:this,rule:e},"setting InputField to error state");var t=[];for(var n in a)t.push(this.domClient.style(this.selector,n,a[n]));return s["default"].all(t)},e}();n.InputField=u},{"../../../lib/Logger":136,"../../../lib/Observable":137,"../../../lib/Promise":138,"../../lib/utils":31}],45:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0}),n.ValidationType={REQUIRED:"required",REGEX:"regex",EMAIL:"email"};var o=function(){function e(e,t){this.type=e,this.message=t}return e.prototype.getMessage=function(){return this.message},e.prototype.getType=function(){return this.type},e}();n.ValidationRule=o;var i=function(e){function t(t){return e.call(this,n.ValidationType.REQUIRED,t)||this}return r(t,e),t.prototype.validate=function(e){return e.length>0},t}(o);n.RequiredValidationRule=i;var s=function(e){function t(t,r){var o=e.call(this,n.ValidationType.REGEX,t)||this;return o.regex=r,o}return r(t,e),t.prototype.validate=function(e){return 0===e.length||null!==e.match(this.regex)},t}(o);n.RegexValidationRule=s},{}],46:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./ValidationRule"),i=e("../../../lib/Creator"),s=e("@yieldify/gendry-validator-util"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(e){switch(e.type){case o.ValidationType.REQUIRED:return new o.RequiredValidationRule(e.message);case o.ValidationType.REGEX:var t=e;return new o.RegexValidationRule(t.message,new RegExp(t.constraint));case o.ValidationType.EMAIL:return new o.RegexValidationRule(e.message,s.EMAIL_REGEXP);default:throw new Error("Unknown ValidationType: "+e.type)}},t}(i.Creator);n.ValidationRuleCreator=a},{"../../../lib/Creator":133,"./ValidationRule":45,"@yieldify/gendry-validator-util":190}],47:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../lib/Logger"),o=function(){function e(e){this.pageTypes=e}return e.prototype.start=function(){for(var e=0,t=this.pageTypes;e<t.length;e++){var n=t[e];n.start()}},e.prototype.getPageTypes=function(){return this.pageTypes},e.prototype.getPageElement=function(e){for(var t=0,n=this.pageTypes;t<n.length;t++){var o=n[t],i=o.getElementById(e);if("undefined"!=typeof i)return i}r.logger.warn({id:e},"Unknown element id")},e}();n.Page=o},{"../../../lib/Logger":136}],48:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/Creator"),i=e("../../../lib/Logger"),s=e("./PageType"),a=e("./Page"),u=function(e){function t(t,n){var r=e.call(this)||this;return r.elementCreator=t,r.store=n,r}return r(t,e),t.prototype.create=function(e){var t=this,n=e.map(function(e){for(var n=[],r=0,o=e.pageElements;r<o.length;r++){var a=o[r];try{"PageElementValue"===a.type&&n.push(t.elementCreator.create(a))}catch(u){i.logger.warn({error:u,element:a},"Error while creating PageElement")}}return new s.PageType(e.name,t.store,n)});return new a.Page(n)},t}(o.Creator);n.PageCreator=u},{"../../../lib/Creator":133,"../../../lib/Logger":136,"./Page":47,"./PageType":49}],49:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../redux/reducers/page-types"),o=e("../../redux/utils"),i=function(){function e(e,t,n){this.name=e,this.store=t,this.elements=n.reduce(function(e,t){return e[t.getId()]=t,e},{})}return e.prototype.start=function(){var e=this;o.onChange(r.pageType(this.name),this.store,function(t){t.active?e.activate():e.deactivate()})},e.prototype.getName=function(){return this.name},e.prototype.getElementById=function(e){return this.elements[e]},e.prototype.deactivate=function(){for(var e in this.elements)this.elements[e].stop()},e.prototype.activate=function(){for(var e in this.elements)this.elements[e].start()},e}();n.PageType=i},{"../../redux/reducers/page-types":98,"../../redux/utils":113}],50:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=e("./NumericPageElementValue"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parse=function(e){try{return e=this.cleanNumber(e),parseFloat(e)}catch(t){throw new Error(o.PARSING_ERROR)}},t}(i.NumericPageElementValue);n.FloatPageElementValue=s},{"./NumericPageElementValue":52,"./PageElementValue":54}],51:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=e("./NumericPageElementValue"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parse=function(e){try{return e=this.cleanNumber(e),parseInt(e,10)}catch(t){throw new Error(o.PARSING_ERROR)}},t}(i.NumericPageElementValue);n.IntegerPageElementValue=s},{"./NumericPageElementValue":52,"./PageElementValue":54}],52:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.cleanNumber=function(e){return e.replace(/\s/g,"").replace(/[.,]([0-9]{3,})/g,"$1").replace(/,([0-9]{0,2})$/,".$1")},t}(o.PageElementValue);n.NumericPageElementValue=i},{"./PageElementValue":54}],53:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){this.id=e,this.type=t}return e.prototype.getId=function(){return this.id},e.prototype.getType=function(){return this.type},e}();n.PageElement=r},{}],54:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../../lib/CachingObservable"),i=e("../../../../lib/Logger"),s=e("./PageElement"),a=e("../../../redux/actions/page-elements");n.WRONG_LENGTH_ERROR="PageElementValue support only one value",n.PARSING_ERROR="PageElementValue value could not be parsed";var u=function(e){function t(t,n,r,i,s,u,c){var l=e.call(this,t,"PageElementValue")||this;return l.selector=n,l.dataType=r,l.setRegex(i),l.attr=s,l.domClient=u,l.value=new o.CachingObservable,l.running=!1,l.store=c,l.value.subscribe(function(e){l.store.dispatch(a.pageElementValueUpdated(l.getId(),e))}),l}return r(t,e),t.prototype.getDataType=function(){return this.dataType},t.prototype.getValue=function(){return this.value},t.prototype.setRegex=function(e){e&&(this.regex=new RegExp(e))},t.prototype.start=function(){var e=this;this.running||(this.running=!0,this.createScraper().then(function(t){e.remoteValueScraper=t,e.remoteValueScraper.getValuesObservable().subscribe(function(t){try{var n=e.parse(e.applyRegex(e.extractElementValue(t)));e.value.publishIfChanged(n),i.logger.debug({pageElementValue:e,value:n},"PageElementValue scraped successfully")}catch(r){i.logger.debug({pageElementValue:e,error:r},"PageElementValue scraping failed"),e.value.publishIfChanged(null)}}),e.remoteValueScraper.start()},function(t){""===e.selector?i.logger.debug({id:e.getId()},"Empty selector for PageElementValue"):i.logger.error({id:e.getId(),selector:e.selector,attr:e.attr,message:t.message},"Unable to create value scraper"),e.value.publishIfChanged(null)}))},t.prototype.stop=function(){var e=this;return"undefined"==typeof this.remoteValueScraper?void this.value.publishIfChanged(null):void(this.running&&(this.running=!1,this.remoteValueScraper.stop().then(function(){e.running||e.value.publishIfChanged(null)})))},t.prototype.toJSON=function(){return{attr:this.attr,dataType:this.dataType,id:this.getId(),running:this.running,selector:this.selector,type:this.getType(),value:this.value}},t.prototype.createScraper=function(){return this.domClient.createValueScraper(this.selector,this.attr)},t.prototype.applyRegex=function(e){if(!this.regex)return e;var t=this.regex.exec(e);if(!t)throw new Error(n.PARSING_ERROR);return t[0]},t.prototype.extractElementValue=function(e){if(1!==e.length)throw new Error(n.WRONG_LENGTH_ERROR);return e[0]},t}(s.PageElement);n.PageElementValue=u},{"../../../../lib/CachingObservable":132,"../../../../lib/Logger":136,"../../../redux/actions/page-elements":82,"./PageElement":53}],55:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../../lib/Creator"),i=e("../../../config"),s=e("./StringPageElementValue"),a=e("./IntegerPageElementValue"),u=e("./FloatPageElementValue"),c=function(e){function t(t,n){var r=e.call(this)||this;return r.domClient=t,r.store=n,r}return r(t,e),t.prototype.create=function(e){switch(e.dataType){case i.ValueSourceDataType.STRING:return new s.StringPageElementValue(e.id,e.selector,e.dataType,e.regex,e.attr,this.domClient,this.store);case i.ValueSourceDataType.INTEGER:return new a.IntegerPageElementValue(e.id,e.selector,e.dataType,e.regex,e.attr,this.domClient,this.store);case i.ValueSourceDataType.FLOAT:return new u.FloatPageElementValue(e.id,e.selector,e.dataType,e.regex,e.attr,this.domClient,this.store);default:throw new Error("Unknown PageElementValue data type in configuration "+e.type)}},t}(o.Creator);n.PageElementValueCreator=c},{"../../../../lib/Creator":133,"../../../config":3,"./FloatPageElementValue":50,"./IntegerPageElementValue":51,"./StringPageElementValue":56}],56:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageElementValue"),i=e("../../../../lib/Logger");n.MAX_SCRAPED_STRING_LENGTH=256;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.parse=function(e){if(e.length>n.MAX_SCRAPED_STRING_LENGTH)throw i.logger.error({length:e.length,pageElementValue:this},"Scraped string value is longer than the max limit"),new Error("Scraped value is too long");return e},t}(o.PageElementValue);n.StringPageElementValue=s},{"../../../../lib/Logger":136,"./PageElementValue":54}],57:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../../lib/CachingObservable"),o=function(){function e(e,t,n,o){this.id=e,this.domClient=t,this.selector=n,this.attr=o,this.valuesObservable=new r.CachingObservable}return e.prototype.start=function(){var e=this;this.domClient.startScraping(this.id).subscribe(function(t){e.valuesObservable.publishIfChanged(t)})},e.prototype.stop=function(){return this.domClient.stopScraping(this.id)},e.prototype.getValuesObservable=function(){return this.valuesObservable},e}();n.RemoteValueScraper=o},{"../../../../lib/CachingObservable":132}],58:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PageViewEvent"),i=e("../../../lib/CachingObservable"),s=e("../../redux/utils"),a=e("../../redux/reducers/page"),u=e("../../redux/reducers/session"),c=function(e){function t(t,n){var r=e.call(this)||this;return r.timeProvider=t,r.store=n,r}return r(t,e),t.prototype.start=function(){var e=this;s.onChange(a.currentPageUrl,this.store,function(t){e.publish(new o.PageViewEvent(t,e.timeProvider,u.currentReferrer(e.store.getState())))})},t}(i.CachingObservable);n.PageView=c;
},{"../../../lib/CachingObservable":132,"../../redux/reducers/page":99,"../../redux/reducers/session":100,"../../redux/utils":113,"./PageViewEvent":59}],59:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../execution-components/events/UserJourneyEvent"),i=function(e){function t(t,n,r){var o=e.call(this,null,n)||this;return o.url=t,o.referrer=r,o}return r(t,e),t.prototype.getUrl=function(){return this.url},t.prototype.getReferrer=function(){return this.referrer},t}(o.UserJourneyEvent);n.PageViewEvent=i},{"../../execution-components/events/UserJourneyEvent":19}],60:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../lib/Observable"),o=e("./SaleEvent"),i=e("../../../lib/Logger"),s=e("../../redux/reducers/last-impression"),a=e("../../redux/reducers/session"),u=e("../../redux/reducers/domain-entity-properties"),c=e("../../redux/reducers/page"),l=e("../../redux/utils"),p=e("../../../lib/selectors");n.EMPTY_ATTRIBUTE=0,n.SALE_ENTITY_NAME="sale",n.SALE_VALUE_PROPERTY_NAME="sale-total-value";var f=function(){function e(e,t,n,o){e&&e.url?this.urlMatcher=new RegExp(e.url):i.logger.debug({thankyouMapping:e},"No sales mapping available"),this.store=t,this.uuidGenerator=n,this.timeProvider=o,this.lastPrice=null,this.lastSaleUuid=null,this.eventObservable=new r.Observable}return e.prototype.start=function(){var e=this,t=p.selector(u.domainEntityPropertyValues,function(e){var t=e["sale.sale-total-value"];return"undefined"==typeof t?null:t.value});l.onChange(t,this.store,function(t){e.lastPrice=t,e.isThankYouPage()&&e.publishNewSale()}),l.onChange(c.currentPageUrl,this.store,function(t){e.updatedPageUrl(t)})},e.prototype.getEventObservable=function(){return this.eventObservable},e.prototype.updatedPageUrl=function(e){this.lastSeenUrl!==e&&(this.lastSeenUrl=e,this.isThankYouPage()&&(this.lastSaleUuid=this.uuidGenerator.generate(),this.publishNewSale()))},e.prototype.publishNewSale=function(){this.lastSaleUuid||(this.lastSaleUuid=this.uuidGenerator.generate());var e=s.lastImpression(this.store.getState()),t=a.session(this.store.getState());return i.logger.debug({lastImpression:e},"Last impression in saleDetector"),null===e?void this.eventObservable.publish(new o.SaleEvent(this,n.EMPTY_ATTRIBUTE,n.EMPTY_ATTRIBUTE,n.EMPTY_ATTRIBUTE,this.lastSaleUuid,this.lastPrice,(!1),this.timeProvider)):(i.logger.debug({sessionCount:t.sessionCount,liSessionCount:e.sessionCount},"Session count value in saleDetector"),void(e.sessionCount===t.sessionCount?this.eventObservable.publish(new o.SaleEvent(this,e.collectionId,e.campaignId,e.componentId,this.lastSaleUuid,this.lastPrice,e.control,this.timeProvider)):this.eventObservable.publish(new o.SaleEvent(this,n.EMPTY_ATTRIBUTE,n.EMPTY_ATTRIBUTE,n.EMPTY_ATTRIBUTE,this.lastSaleUuid,this.lastPrice,(!1),this.timeProvider))))},e.prototype.isThankYouPage=function(){return!!this.urlMatcher&&this.urlMatcher.test(this.lastSeenUrl)},e}();n.SaleDetector=f},{"../../../lib/Logger":136,"../../../lib/Observable":137,"../../../lib/selectors":161,"../../redux/reducers/domain-entity-properties":91,"../../redux/reducers/last-impression":95,"../../redux/reducers/page":99,"../../redux/reducers/session":100,"../../redux/utils":113,"./SaleEvent":61}],61:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../execution-components/events/UserJourneyEvent"),i=function(e){function t(t,n,r,o,i,s,a,u){var c=e.call(this,t,u,a)||this;return c.collectionId=n,c.campaignId=r,c.componentId=o,c.uuid=i,c.value=s||0,c}return r(t,e),t.prototype.getCollectionId=function(){return this.collectionId},t.prototype.getCampaignId=function(){return this.campaignId},t.prototype.getComponentId=function(){return this.componentId},t.prototype.getValue=function(){return this.value},t.prototype.getUuid=function(){return this.uuid},t}(o.UserJourneyEvent);n.SaleEvent=i},{"../../execution-components/events/UserJourneyEvent":19}],62:[function(e,t,n){"use strict";function r(e){return new d(f.AND,e)}function o(e){return new d(f.OR,e)}function i(e){return new d(f.NOT,[e])}function s(){return new p.LiteralExpression((!0))}function a(){return new p.LiteralExpression((!1))}function u(e,t){return new d(f.EQUALS,[e,t])}var c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var l=e("./Expression"),p=e("./LiteralExpression");n.and=r,n.or=o,n.not=i,n.alwaysTrue=s,n.alwaysFalse=a;var f;!function(e){e[e.AND=0]="AND",e[e.OR=1]="OR",e[e.NOT=2]="NOT",e[e.EQUALS=3]="EQUALS"}(f||(f={})),n.equals=u,n.OPERATIONS={equals:u};var d=function(e){function t(t,n){var r=e.call(this,n)||this;if(r.type=t,r.type===f.NOT&&1!==n.length)throw new Error("NOT can only be used with exactly one subexpression.");if(r.type!==f.NOT&&0===n.length)throw new Error("Must specify at least one subexpression.");if(r.type===f.EQUALS&&2!==n.length)throw new Error("EQUALS can only be used with exactly two subexpressions.");return r}return c(t,e),t.isNull=function(e){return null===e||void 0===e},t.prototype.evaluate=function(e){var n=null;switch(this.type){case f.AND:n=!0;for(var r=0,o=e;r<o.length;r++){var i=o[r];if(t.isNull(i))return null;i===!1&&(n=!1)}return n;case f.OR:for(var s=0,a=e;s<a.length;s++){var u=a[s];if(u===!0)return!0;u===!1&&(n=!1)}return n;case f.NOT:var c=e[0];return t.isNull(c)?null:!c;case f.EQUALS:var l=e[0],p=e[1];return t.isNull(l)||t.isNull(p)?null:l===p;default:throw new Error("Unexpected type of: "+this.type)}},t}(l.Expression)},{"./Expression":63,"./LiteralExpression":66}],63:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/CachingObservable"),i=function(e){function t(t){var n=e.call(this)||this;n.subexpressions=t;for(var r=0,o=n.subexpressions;r<o.length;r++){var i=o[r];if(!i)throw new Error("Subexpression objects must not be null")}return n}return r(t,e),t.prototype.start=function(){for(var e=0,t=this.subexpressions;e<t.length;e++){var n=t[e];n.subscribe(this.getObserverFunction()),n.start()}this.eval()},t.prototype.getSubexpressionValues=function(){for(var e=[],t=0,n=this.subexpressions;t<n.length;t++){var r=n[t];e.push(r.getCurrentValue())}return e},t.prototype.getObserverFunction=function(){return this.eval.bind(this)},t.prototype.eval=function(){this.publishIfChanged(this.evaluate(this.getSubexpressionValues()))},t}(o.CachingObservable);n.Expression=i},{"../../lib/CachingObservable":132}],64:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Expression"),i=function(e){function t(t){var n=e.call(this,[])||this;if(!t)throw new Error("adaptee must be not null or undefined");return n.adaptee=t,n}return r(t,e),t.prototype.start=function(){this.adaptee.subscribe(this.getObserverFunction()),e.prototype.start.call(this)},t.prototype.evaluate=function(){return this.adaptee.getCurrentValue()},t}(o.Expression);n.ExpressionAdaptor=i},{"./Expression":63}],65:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./BooleanExpression"),o=e("./NumericExpression"),i=e("./StringExpression"),s=e("../model/DataLayer"),a=e("./ExpressionAdaptor"),u=e("./LiteralExpression"),c=function(){function e(e){this.dataLayer=e}return e.prototype.createExpression=function(e){var t=this;return 0===e.length?r.alwaysTrue():r.and(e.map(function(e){return 0===e.length?r.alwaysTrue():r.or(e.map(function(e){return t.createSubExpression(e)}))}))},e.prototype.createSubExpression=function(e){if("noop"===e.op)return r.alwaysTrue();var t=e.attr,n=e.op,a=e.val,u=0===n.indexOf("not");u&&(n=n.charAt(3).toLowerCase()+n.slice(4));var c=this.dataLayer.getValue(t);if(!c)throw new Error("Unsupported precondition attr: "+t);var l;switch(c.getType()){case s.DataLayerType.STRING:var p=a;l=this.composeExpression(c,n,p,i.OPERATIONS);break;case s.DataLayerType.NUMBER:var f=a;l=this.composeExpression(c,n,f,o.OPERATIONS);break;case s.DataLayerType.BOOLEAN:var d=a;l=this.composeExpression(c,n,d,r.OPERATIONS);break;default:throw new Error("Unsupported DataLayerType of "+c.getType())}return u&&(l=r.not(l)),l},e.prototype.composeExpression=function(e,t,n,r){var o=r[t];if(!o)throw new Error("Unsupported precondition op: "+t);switch(t){case"in":case"between":if(!(n instanceof Array))throw new Error("Expected val to be an array.");break;default:if(n instanceof Array)throw new Error("Expected val to be a literal.")}return o(new a.ExpressionAdaptor(e.getObservable()),new u.LiteralExpression(n))},e}();n.ExpressionFactory=c},{"../model/DataLayer":34,"./BooleanExpression":62,"./ExpressionAdaptor":64,"./LiteralExpression":66,"./NumericExpression":67,"./StringExpression":68}],66:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Expression"),i=function(e){function t(t){var n=e.call(this,[])||this;return n.literalValue=t,n}return r(t,e),t.prototype.evaluate=function(){return this.literalValue},t}(o.Expression);n.LiteralExpression=i},{"./Expression":63}],67:[function(e,t,n){"use strict";function r(e,t){return new f(p.EQUALS,e,t)}function o(e,t){return new f(p.BETWEEN,e,t)}function i(e,t){return new f(p.GREATER_THAN,e,t)}function s(e,t){return new f(p.LESS_THAN,e,t)}function a(e,t){return new f(p.IN,e,t)}var u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var c=e("./Expression"),l=e("../../lib/Logger");n.equals=r,n.between=o,n.greaterThan=i,n.lessThan=s,n.inArray=a,n.OPERATIONS={"in":a,between:o,equals:r,greaterThan:i,lessThan:s};var p;!function(e){e[e.EQUALS=0]="EQUALS",e[e.BETWEEN=1]="BETWEEN",e[e.LESS_THAN=2]="LESS_THAN",e[e.GREATER_THAN=3]="GREATER_THAN",e[e.IN=4]="IN"}(p||(p={}));var f=function(e){function t(t,n,r){var o=e.call(this,[n,r])||this;return o.type=t,o}return u(t,e),t.prototype.evaluate=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(null==r)return null}var o=e[0],i=e[1];switch(this.type){case p.EQUALS:return o===i;case p.LESS_THAN:return o<i;case p.GREATER_THAN:return o>i;case p.BETWEEN:var s=i[0],a=i[1];return"number"!=typeof s||"number"!=typeof a||2!==i.length?(l.logger.error({range:i},"Invalid range for a numeric between expression"),null):s<=o&&o<=a;case p.IN:return i.indexOf(o)>=0;default:throw new Error("Unexpected type of: "+this.type)}},t}(c.Expression)},{"../../lib/Logger":136,"./Expression":63}],68:[function(e,t,n){"use strict";function r(e,t){return new l(c.EQUALS,e,t)}function o(e,t){return new l(c.CONTAINS,e,t)}function i(e,t){return new l(c.STARTS_WITH,e,t)}function s(e,t){return new l(c.IN,e,t)}var a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var u=e("./Expression");n.equals=r,n.contains=o,n.startsWith=i,n.inArray=s,n.OPERATIONS={"in":s,equals:r,contains:o,startsWith:i};var c;!function(e){e[e.EQUALS=0]="EQUALS",e[e.CONTAINS=1]="CONTAINS",e[e.STARTS_WITH=2]="STARTS_WITH",e[e.IN=3]="IN"}(c||(c={}));var l=function(e){function t(t,n,r){var o=e.call(this,[n,r])||this;return o.type=t,o}return a(t,e),t.prototype.evaluate=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(null===r||void 0===r)return null}var o=e[0],i=e[1];switch(this.type){case c.EQUALS:return o===i;case c.CONTAINS:return o.indexOf(i)>=0;case c.STARTS_WITH:return 0===o.indexOf(i);case c.IN:return i.indexOf(o)>=0;default:throw new Error("Unexpected type of: "+this.type)}},t}(u.Expression)},{"./Expression":63}],69:[function(e,t,n){"use strict";function r(e,t){return function(n){return function(r){return function(o){var i=n;e&&e(o,i);var s=r(o);return t&&t(o,i),s}}}}Object.defineProperty(n,"__esModule",{value:!0}),n.actionListenerMiddleware=r},{}],70:[function(e,t,n){"use strict";function r(e,t){return{type:"REMOTE_STORE_CREATED",client:e,id:t}}function o(e){var t=[];return function(r){return function(r){return function(o){if("REMOTE_STORE_CREATED"===o.type)return t.push(o.client),null;o.actionMeta=o.actionMeta||{};var a=o.actionMeta.relay||{source:e,senders:[]};if(a.senders.indexOf(e)!==-1)return null;var u=r(o);if(e===n.SANDBOX_SOURCE&&a.source!==n.SANDBOX_SOURCE)return u;var c=s.shallowClone(o);c.actionMeta.relay=i({},a,{senders:a.senders.concat([e])});for(var l=0,p=t;l<p.length;l++){var f=p[l];f.dispatch(c)}return u}}}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../lib/utils");n.SANDBOX_SOURCE="sandbox",n.remoteStoreCreated=r,n.actionRelayMiddleware=o},{"../../lib/utils":163}],71:[function(e,t,n){"use strict";function r(e){return function(t){return function(t){return function(n){var r=o({},n,{actionMeta:o({},n.actionMeta||{},{timestamp:e.currentTime()})});return t(r)}}}}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.actionTimestamperMiddleware=r},{}],72:[function(e,t,n){"use strict";function r(e){return o({type:"BLOCKED_IMPRESSION"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.blockedImpression=r},{}],73:[function(e,t,n){"use strict";function r(e){return o({type:"CLICK_THROUGH"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.clickThrough=r},{}],74:[function(e,t,n){"use strict";function r(e){return o({type:"CLOSE_EVENT"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.closeEvent=r},{}],75:[function(e,t,n){"use strict";function r(e){return{type:"DOMAIN_ENTITY_PROPERTIES_SYNC",state:e}}function o(e){return{type:"DOMAIN_ENTITY_PROPERTY_UPDATED",entity:e.entity,property:e.property,previousValue:e.previousValue,newValue:e.newValue,dataType:e.dataType}}Object.defineProperty(n,"__esModule",{value:!0}),n.domainEntityPropertiesSync=r,n.domainEntityPropertyUpdated=o},{}],76:[function(e,t,n){"use strict";function r(){return{type:"EXIT_INTENT"}}Object.defineProperty(n,"__esModule",{value:!0}),n.exitIntent=r},{}],77:[function(e,t,n){"use strict";function r(e){return o({type:"FORM_SUBMIT"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.formSubmit=r},{}],78:[function(e,t,n){"use strict";function r(e){return void 0===e&&(e=null),{location:{country:e},type:"GEOLOCATION_RECEIVED"}}Object.defineProperty(n,"__esModule",{value:!0}),n.geolocationReceived=r},{}],79:[function(e,t,n){"use strict";function r(e){return o({type:"IMPRESSION"},e)}var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.impression=r},{}],80:[function(e,t,n){"use strict";function r(e){return{type:"LAST_COMPONENT_SUBMITTED",componentUuid:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.updateLastComponentSubmitted=r},{}],81:[function(e,t,n){"use strict";function r(e){return{type:"LOG_MESSAGE",log:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.logMessage=r},{}],82:[function(e,t,n){"use strict";function r(e,t){return{type:"PAGE_ELEMENT_VALUE_UPDATED",id:e,value:t}}function o(e){return{type:"PAGE_ELEMENT_VALUES_SYNC",elements:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.pageElementValueUpdated=r,n.pageElementValuesSync=o},{}],83:[function(e,t,n){"use strict";function r(e){return{type:"PAGE_URL_UPDATED",url:e}}function o(e,t){return{type:"PAGE_VIEWS_RECEIVED",url:e,day:t.views.day,hour:t.views.hour,minute:t.views.minute}}Object.defineProperty(n,"__esModule",{value:!0}),n.pageUrlUpdated=r,n.pageViewsReceived=o},{}],84:[function(e,t,n){"use strict";function r(e){return{type:"SALE_DETECTED",sale:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.saleDetected=r},{}],85:[function(e,t,n){"use strict";function r(e){return{type:"NEW_SESSION_STARTED",sessionCount:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.newSessionStarted=r},{}],86:[function(e,t,n){"use strict";function r(e){return{type:"TICK",timestamp:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.tick=r},{}],87:[function(e,t,n){"use strict";function r(e){return{type:"TRACKABLE_REQUEST_START",requestId:e}}function o(e){return{type:"TRACKABLE_REQUEST_SUCCESS",requestId:e}}function i(e){return{type:"TRACKABLE_REQUEST_FAIL",requestId:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.trackableRequestStart=r,n.trackableRequestSuccess=o,n.trackableRequestFail=i},{}],88:[function(e,t,n){"use strict";function r(e){return{type:"WINDOW_DIMENSIONS_UPDATED",dimensions:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.windowDimensionsUpdated=r},{}],89:[function(e,t,n){"use strict";function r(e){return e}function o(e,t){return void 0===e&&(e=null),e}function i(e){switch(e.type){case"numeric-literal":case"string-literal":return!1;case"arithmetic":return i(e.lhs)||i(e.rhs);case"concat":return a.some(e.value,i);case"variable":return"pageviews.m"===e.name||"pageviews.h"===e.name||"pageviews.d"===e.name;default:return u.logger.error({expression:e},"Unrecognised expression, social proof enabled"),!0}}function s(e){switch(e.type){case"body":case"cta":case"text":case"coupon":case"input":return void 0!==e.text&&"string"!=typeof e.text&&i(e.text);case"form":return a.some(e.children,s);case"advanced-component":return!1;default:return u.logger.error({element:e},"Unrecognised overlay element, social proof enabled"),!0}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../../lib/list"),u=e("../../../lib/Logger");n.initialConfigState=r,n.configReducer=o,n.organisationId=function(e){return e.config.organisationId},n.websiteId=function(e){return e.config.websiteId},n.websiteCurrency=function(e){return e.config.websiteCurrency},n.geolocationRequired=function(e){return a.some(e.config.campaigns,function(e){return a.some(e.collections,function(e){return a.some(e.targetRules,function(e){return a.some(e,function(e){return"user/location/country"===e.attr})})})})},n.socialProofRequired=function(e){var t=a.some(e.config.campaigns,function(e){return a.some(e.collections,function(e){return a.some(e.targetRules,function(e){return a.some(e,function(e){return"pageViews/minuteInterval"===e.attr||"pageViews/hourInterval"===e.attr||"pageViews/dayInterval"===e.attr})})})}),n=a.some(e.config.campaigns,function(e){return a.some(e.collections,function(e){return a.some(e.components,function(e){return"Overlay"===e.type&&a.some(e.settings.overlayElements,s)})})});return t||n}},{"../../../lib/Logger":136,"../../../lib/list":155}],90:[function(e,t,n){"use strict";function r(e,t){return void 0===e&&(e=null),e}Object.defineProperty(n,"__esModule",{value:!0}),n.deviceReducer=r,n.deviceType=function(e){return e.device}},{}],91:[function(e,t,n){"use strict";function r(e){return"de#"+e}function o(e,t,n,o){var i;if(i=o.deps?o.deps[e]:n[r(e)],void 0!==i&&t===i.sc)return i.val}function i(e,t,n,r){return e.scraping&&e.scraping.domainEntities?b.dict(y.flatten(e.scraping.domainEntities.map(function(e){return e.properties.map(function(i){var s=e.name+"."+i.name,u=o(s,t,n,r);return{key:s,value:a(s,e.name,i.name,i.dataType,i.valueSourceIds,u)}})}))):{}}function s(e,t){switch(t){case"String":return"string"==typeof e;case"Float":case"Integer":return"number"==typeof e;default:return!1}}function a(e,t,n,r,o,i){switch(void 0===i||null===i||s(i,r)||g.logger.error({value:i,dataType:r},"Persisted domain entity property value does not match configured data type"),r){case"String":return{name:e,entity:t,property:n,dataType:r,sources:o,persistedValue:s(i,r)?i:void 0};case"Integer":return{name:e,entity:t,property:n,dataType:r,sources:o,persistedValue:s(i,r)?i:void 0};case"Float":return{name:e,entity:t,property:n,dataType:r,sources:o,persistedValue:s(i,r)?i:void 0};default:throw new Error("Unknown DomainEntityProperty dataType: "+r)}}function u(e,t){switch(void 0===e&&(e={}),t.type){case"DOMAIN_ENTITY_PROPERTIES_SYNC":return t.state;case"NEW_SESSION_STARTED":var n={};for(var r in e)n[r]=v({},e[r],{persistedValue:void 0});return n;default:return e}}function c(e){return"string"==typeof e}function l(e){return"number"==typeof e}function p(e,t){return null===e||void 0===e||t(e)}function f(e,t){switch(e.dataType){case"String":return{name:e.name,dataType:e.dataType,value:p(t,c)?t:null};case"Float":return{name:e.name,dataType:e.dataType,value:p(t,l)?t:null};case"Integer":return{name:e.name,dataType:e.dataType,value:p(t,l)?t:null};default:throw new Error("Unknown domain entity property datatype: "+e.dataType)}}function d(e){var t;switch(h(e)){case O.DataLayerType.STRING:t="string";break;case O.DataLayerType.NUMBER:t="number";break;case O.DataLayerType.BOOLEAN:t="boolean";break;default:throw new Error("Unknown DataLayerType")}return"entity/"+t+"/"+e.name}function h(e){switch(e.dataType){case"String":return O.DataLayerType.STRING;case"Float":case"Integer":return O.DataLayerType.NUMBER;default:throw new Error("Unknown dataType for variable")}}var v=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var g=e("../../../lib/Logger"),y=e("../../../lib/list"),b=e("../../../lib/Dictionary"),m=e("./page-elements"),_=e("../../../lib/selectors"),E=e("./session"),O=e("../../model/DataLayer");n.initialDomainEntityPropertiesState=i,n.domainEntityPropertiesReducer=u,n.domainEntityProperties=function(e){return e.domainEntityProperties},n.domainEntityProperty=function(e){return function(t){return t.domainEntityProperties[e]}},n.domainEntityPropertyValues=_.mapSelector({elements:m.pageElements,properties:n.domainEntityProperties},function(e){var t=e.elements,n=e.properties;return b.dictMapValues(n,function(e){function n(){for(var t=0,n=r;t<n.length;t++){var o=n[t];if(void 0===o||0===o.values.length)return}var i=r.map(function(e){return e.values}),s=y.flatten(y.zip(i)),a=y.compact(s)[0];return void 0!==a?a:void 0!==e.persistedValue?e.persistedValue:"basket.value"===e.name?0:null}var r=e.sources.map(function(e){return t[e]});return f(e,n())})}),n.persistentDomainEntityPropertiesState=_.mapSelector({values:n.domainEntityPropertyValues,count:E.sessionCount,props:n.domainEntityProperties},function(e){var t=e.values,n=e.count,r=e.props;return b.dict(b.entries(t).map(function(e){var t=e.value.value,o=r[e.key].persistedValue;return{key:e.key,value:{val:void 0!==t?t:o,sc:n}}}).filter(function(e){return null!==e.value.val&&void 0!==e.value.val}))}),n.propertyDatalayerKey=d,n.propertyDatalayerDataType=h},{"../../../lib/Dictionary":135,"../../../lib/Logger":136,"../../../lib/list":155,"../../../lib/selectors":161,"../../model/DataLayer":34,"./page-elements":97,"./session":100}],92:[function(e,t,n){"use strict";function r(e,t){switch(void 0===e&&(e=n.DEFAULT_GEOLOCATION_STATE),t.type){case"GEOLOCATION_RECEIVED":return t.location;default:return e}}Object.defineProperty(n,"__esModule",{value:!0}),n.DEFAULT_GEOLOCATION_STATE={country:null},n.geolocationReducer=r,n.geolocationCountry=function(e){return e.location.country}},{}],93:[function(e,t,n){"use strict";function r(e){return/^\d+$/.test(e)}function o(e){return r(e)?e:v[e]}function i(e,t){var r=u.dict(e.campaigns.map(function(e){return{key:e.id.toString(),value:e.cappingLabels.map(function(t){return t===n.ID_LABEL?e.id.toString():t})}})),i=h.flatten(u.values(r)),s=u.dict(i.map(function(e){return{key:e,value:0}}).concat(u.entries(t).map(function(e){var t=e.key,n=e.value;return{key:o(t),value:f.getRegularTimestamp(n)}})));return{lastImpressions:s,cappingLabels:r}}function s(e,t){switch(void 0===e&&(e=null),t.type){case"IMPRESSION":return l.update(e).get("lastImpressions").set(l.partial(function(){var n=e.cappingLabels[t.campaignId.toString()];return u.dict(n.map(function(e){return{key:e,value:t.timestamp}}))}));default:return e}}function a(e){var t=r(e)?"id:"+e:e;return"campaigns/byCappingLabel/"+t+"/secondsSinceLastImpression"}Object.defineProperty(n,"__esModule",{value:!0});var u=e("../../../lib/Dictionary"),c=e("../../../lib/selectors"),l=e("../../../lib/updater"),p=e("./time"),f=e("../../storage/timestamp"),d=e("../../../lib/utils"),h=e("../../../lib/list");n.FREQ_CAP_MAX_KEYS=11,n.ID_LABEL="@id";var v=d.createTranslationTable({overlay:"o"});n.translateLabel=o,n.initialLabelledLastImpressionsState=i,n.labelledLastImpressionsReducer=s,n.labelledLastImpressions=function(e){return e.labelledLastImpressions.lastImpressions},n.allLabels=c.selector(n.labelledLastImpressions,Object.keys),n.persistedLabelledLastImpressionState=c.selector(n.labelledLastImpressions,function(e){return u.dict(u.entries(e).sort(h._compare(function(e){return e.value})).reverse().filter(function(e,t){return t<n.FREQ_CAP_MAX_KEYS}).map(function(e){var t=e.key,n=e.value;return{key:o(t),value:f.getStorableTimestamp(n)}}))}),n.secondsSinceLabelledLastImpressions=c.mapSelector({labelledLastImpressions:n.labelledLastImpressions,time:p.time},function(e){var t=e.labelledLastImpressions,n=e.time;return u.dictMapValues(t,function(e){var t=Math.floor((n-e)/1e3);return t>0?t:0})}),n.secondsSinceLabelledLastImpressionDatalayerKey=a},{"../../../lib/Dictionary":135,"../../../lib/list":155,"../../../lib/selectors":161,"../../../lib/updater":162,"../../../lib/utils":163,"../../storage/timestamp":119,"./time":101}],94:[function(e,t,n){"use strict";function r(e,t){switch(void 0===e&&(e=null),t.type){case"LAST_COMPONENT_SUBMITTED":return t.componentUuid;default:return e}}Object.defineProperty(n,"__esModule",{value:!0}),n.lastComponentSubmittedReducer=r,n.lastComponentSubmitted=function(e){return e.lastComponentSubmitted}},{}],95:[function(e,t,n){"use strict";function r(e){return e?{timestamp:e.ts,campaignId:e.cpg,collectionId:e.col,componentId:e.cpi,sessionCount:e.sc,control:!!e.c}:null}function o(e,t){switch(void 0===e&&(e=null),t.type){case"IMPRESSION":return{control:t.control,collectionId:t.collectionId,campaignId:t.campaignId,componentId:t.componentId,sessionCount:t.sessionCount,timestamp:t.timestamp};default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/selectors"),s=e("./time");n.initialLastImpressionState=r,n.impressionReducer=o,n.lastImpression=function(e){return e.lastImpression},n.persistentLastImpressionState=i.selector(n.lastImpression,function(e){return e?{c:e.control?1:0,col:e.collectionId,cpg:e.campaignId,cpi:e.componentId,sc:e.sessionCount,ts:e.timestamp}:null}),n.secondsSinceLastImpression=i.mapSelector({currentTime:s.time,impression:n.lastImpression},function(e){var t=e.currentTime,n=e.impression;if(!n)return t;var r=Math.floor((t-n.timestamp)/1e3);return r>0?r:0})},{"../../../lib/selectors":161,"./time":101}],96:[function(e,t,n){"use strict";function r(e,t){switch(void 0===e&&(e={}),t.type){case"OVERLAY_READY":var n=t.actionMeta.relay.source;return void 0!==e[n]&&e[n]!==s.LOADING?e:i({},e,(r={},r[n]=s.READY,r));case"OVERLAY_ERROR":return i({},e,(o={},o[t.actionMeta.relay.source]=s.ERROR,o));default:return e}var r,o}function o(e,t){if(void 0===e&&(e=s.LOADING),e===s.ERROR)return e;switch(t.type){case"OVERLAY_READY":return s.READY;case"OVERLAY_ERROR":return s.ERROR;default:return e}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s;!function(e){e[e.LOADING=0]="LOADING",e[e.READY=1]="READY",e[e.ERROR=2]="ERROR"}(s=n.OverlayStatusState||(n.OverlayStatusState={})),n.overlayStatusReducer=r,n.statusReducer=o,n.overlayReady=function(e){return function(t){return t.overlays[e]===s.READY}},n.overlayError=function(e){return function(t){return t.overlays[e]===s.ERROR}},n.ready=function(e){return e.status===s.READY},n.error=function(e){return e.status===s.ERROR},n.loading=function(e){return e.status===s.LOADING}},{}],97:[function(e,t,n){"use strict";function r(e){var t=e.scraping.pageTypes.map(function(e){return e.pageElements.map(function(t){return{key:t.id.toString(),value:{id:t.id,name:t.name,pageTypeName:e.name,type:t.type,dataType:t.dataType,values:[]}}})});return s.dict(a.flatten(t))}function o(e,t){switch(void 0===e&&(e={}),t.type){case"PAGE_ELEMENT_VALUES_SYNC":return t.elements;case"PAGE_ELEMENT_VALUE_UPDATED":return u.update(e).get(t.id.toString()).set(function(e){return e?{id:t.id,name:e.name,pageTypeName:e.pageTypeName,type:e.type,dataType:e.dataType,values:i(e.values,t.value)}:e});default:return e}}function i(e,t){return 0===e.length?[t]:e[0]===t?e:null===t?[null].concat(e):[t]}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../../lib/Dictionary"),a=e("../../../lib/list"),u=e("../../../lib/updater"),c=e("../../../lib/selectors");
n.initialPageElementsState=r,n.pageElementsReducer=o,n.updateValueHistory=i,n.pageElements=function(e){return e.pageElements},n.pageElementValue=function(e){return c.selector(n.pageElements,function(t){var n=t[e.toString()];if(void 0!==n)return n.values})},n.externalValue=function(e,t){return c.selector(n.pageElements,function(n){return a.find(s.values(n),function(n){return t===n.pageTypeName&&e===n.name&&"ExternalValue"===n.type})})}},{"../../../lib/Dictionary":135,"../../../lib/list":155,"../../../lib/selectors":161,"../../../lib/updater":162}],98:[function(e,t,n){"use strict";function r(e,t,n,r){var o=new RegExp(t),i=o.test(n);return{name:e,urlPattern:t,active:i,elementIds:r}}function o(e,t){return e.scraping?s.dict(e.scraping.pageTypes.map(function(e){return{key:e.name,value:r(e.name,e.urlPattern,t,e.pageElements.map(function(e){return e.id}))}})):{}}function i(e,t){switch(void 0===e&&(e={}),t.type){case"PAGE_URL_UPDATED":return a.update(e).set(s._dictMapValues(function(e){return a.update(e).get("active").set(function(){var n=new RegExp(e.urlPattern);return n.test(t.url)})}));default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../../lib/Dictionary"),a=e("../../../lib/updater"),u=e("../../../lib/selectors");n.initialPageTypes=o,n.pageTypesReducer=i,n.pageTypes=function(e){return e.pageTypes},n.activePageTypes=u.selector(n.pageTypes,function(e){return s.values(e).filter(function(e){return e.active})}),n.pageType=function(e){return function(t){return t.pageTypes[e]}}},{"../../../lib/Dictionary":135,"../../../lib/selectors":161,"../../../lib/updater":162}],99:[function(e,t,n){"use strict";function r(e,t){return{navigatedAt:t,url:e,views:{minute:null,hour:null,day:null}}}function o(e,t){void 0===e&&(e=null);var n=null;switch(t.actionMeta&&"number"==typeof t.actionMeta.timestamp&&(n=t.actionMeta.timestamp),t.type){case"PAGE_URL_UPDATED":return e.url===t.url?e:i.update(e).set(i.partial(function(e){return{navigatedAt:n,url:t.url,views:{minute:null,hour:null,day:null}}}));case"PAGE_VIEWS_RECEIVED":return t.url!==e.url?e:i.update(e).get("views").set(function(){return{minute:t.minute,hour:t.hour,day:t.day}});default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/updater"),s=e("../../../lib/selectors"),a=e("../../../lib/object");n.initialPageState=r,n.pageReducer=o,n.currentPageUrl=function(e){return e.page.url},n.currentPageNavigatedAt=function(e){return e.page.navigatedAt},n.pageViews=function(e){return e.page.views},n.pageViewVariables=s.selector(n.pageViews,function(e){return a.keys(e).map(function(t){var n={name:"pageviews."+t[0],dataType:"Integer",value:e[t]};return n})}),n.pageViewsDatalayerValues=s.selector(n.pageViews,function(e){return{"pageViews/dayInterval":e.day,"pageViews/hourInterval":e.hour,"pageViews/minuteInterval":e.minute}})},{"../../../lib/object":156,"../../../lib/selectors":161,"../../../lib/updater":162}],100:[function(e,t,n){"use strict";function r(e,t,r,o,s){if(!o){var a=l.first([s.googleAnalytics,s.universalAnalytics,n.STARTING_SESSION_COUNT]);return{lastActivities:[e],sessionCount:a,sessionReferrer:t,currentReferrer:t}}var u=i([e,o.la]),c=o.c+(u?1:0),p=r&&r.count===c,f=p?r.referrer:t;return{lastActivities:[e],sessionCount:c,sessionReferrer:f,currentReferrer:t}}function o(e,t){switch(void 0===e&&(e=null),t.type){case"NEW_SESSION_STARTED":return u({},e,{sessionReferrer:e.currentReferrer,sessionCount:t.sessionCount,lastActivities:[e.lastActivities[0]]});case"TICK":var n=t.timestamp-e.lastActivities[0];return s(n)?c.update(e).get("lastActivities").set(function(e){return a(t.timestamp,e)}):e;default:return e}}function i(e){return!(!e||e.length<2)&&e[0]-e[1]>n.SESSION_CUTOFF}function s(e){return e-n.COOKIE_REFRESH_RATE>0}function a(e,t){return[e,t[0]]}var u=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var c=e("../../../lib/updater"),l=e("../../../lib/list"),p=e("../../../lib/selectors");n.SESSION_CUTOFF=18e5,n.COOKIE_REFRESH_RATE=6e4,n.STARTING_SESSION_COUNT=1,n.initialSessionState=r,n.sessionReducer=o,n.session=function(e){return e.session},n.sessionCount=p.selector(n.session,function(e){return e.sessionCount}),n.sessionReferrer=p.selector(n.session,function(e){return e.sessionReferrer}),n.currentReferrer=p.selector(n.session,function(e){return e.currentReferrer}),n.lastActivities=p.selector(n.session,function(e){return e.lastActivities}),n.persistentSessionReferrerState=p.selector(n.session,function(e){return{count:e.sessionCount,referrer:e.sessionReferrer}}),n.persistentSessionCountState=p.selector(n.session,function(e){return{c:e.sessionCount,la:e.lastActivities[0]}}),n.isNewSession=i},{"../../../lib/list":155,"../../../lib/selectors":161,"../../../lib/updater":162}],101:[function(e,t,n){"use strict";function r(e,t){switch(void 0===e&&(e=null),t.type){case"TICK":return t.timestamp;default:return e}}function o(e,t){return function(){return e.dispatch(i.tick(t.currentTime()))}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../actions/time");n.timeReducer=r,n.time=function(e){return e.time},n.UPDATE_TIME_INTERVAL_MS=1e3,n.updateTime=o},{"../actions/time":86}],102:[function(e,t,n){"use strict";function r(){return{pending:[]}}function o(e,t){switch(void 0===e&&(e=null),t.type){case"TRACKABLE_REQUEST_START":return i.update(e).get("pending").set(s._append(t.requestId));case"TRACKABLE_REQUEST_SUCCESS":case"TRACKABLE_REQUEST_FAIL":return i.update(e).get("pending").set(s._remove(t.requestId));default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/updater"),s=e("../../../lib/list");n.initialTrackableState=r,n.trackableReducer=o,n.pendingRequests=function(e){return e.trackable.pending}},{"../../../lib/list":155,"../../../lib/updater":162}],103:[function(e,t,n){"use strict";function r(e,t,n,r){t&&t.session===n||(t=void 0);var s={session:n,campaigns:e.campaigns.filter(function(e){return Object.keys(e.urlsVisitedRules).length>0}).reduce(function(e,n){var r=t?t.campaigns[n.id]:void 0;return l({},e,(i={},i[n.id]=o(n.urlsVisitedRules,r),i));var i},{})};return i(s,h.pageUrlUpdated(r))}function o(e,t){var n=g.deepHash(e);return t&&t.rulesHash===n?{rules:e,ruleResults:t.ruleResults}:{rules:e,ruleResults:p.dictMapValues(e,function(e){return a(e)})}}function i(e,t){switch(void 0===e&&(e=null),t.type){case"PAGE_URL_UPDATED":return v.update(e).get("campaigns").set(p._dictMapValues(function(e){return v.update(e).get("ruleResults").set(p._dictMapValues(function(n,r){var o=e.rules[r],i=s(o,d.UrlUtil.canonicalise(t.url));return a(o)?i&&n:i||n}))}));case"NEW_SESSION_STARTED":var n=e.session,r=t.sessionCount;return n===r?e:v.update(e).set(function(){return{session:r,campaigns:v.update(e.campaigns).set(p._dictMapValues(function(e){return o(e.rules,void 0)}))}});default:return e}}function s(e,t){return u(t,e.val,e.op)}function a(e){return/^not/.test(e.op)}function u(e,t,n){switch(n){case"equals":return e===t;case"notEquals":return e!==t;case"contains":return e.indexOf(t)>=0;case"notContains":return e.indexOf(t)<0;case"startsWith":return 0===e.indexOf(t);case"notStartsWith":return 0!==e.indexOf(t);case"in":return t.indexOf(e)>=0;default:throw new Error("Unexpected type of: "+n)}}function c(e){return{rulesHash:g.deepHash(e.rules),ruleResults:e.ruleResults}}var l=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var p=e("../../../lib/Dictionary"),f=e("../../../lib/selectors"),d=e("../../../lib/browser/UrlUtil"),h=e("../actions/page"),v=e("../../../lib/updater"),g=e("@yieldify/gendry-hash-util"),y="user/hasVisited/";n.initialUrlsVisitedState=r,n.urlsVisitedReducer=i,n.evaluateRule=s;var b=function(e){return e.urlsVisited},m=f.selector(b,function(e){return e.campaigns});n.urlsVisitedDataLayerValues=f.mapSelector({campaigns:m},function(e){var t=e.campaigns,n={};for(var r in t){var o=t[r];for(var i in o.rules){var s=y+i;n[s]=o.ruleResults[i]}}return n}),n.persistentUrlsVisitedState=f.selector(b,function(e){return{session:e.session,campaigns:p.dictMapValues(e.campaigns,c)}})},{"../../../lib/Dictionary":135,"../../../lib/browser/UrlUtil":146,"../../../lib/selectors":161,"../../../lib/updater":162,"../actions/page":83,"@yieldify/gendry-hash-util":187}],104:[function(e,t,n){"use strict";function r(e,t){if(e&&e.id){var r=void 0;return r=e.fl?i.fromBitVector(e.fl,n.BIT_VECTOR_KEYS.length):n.BIT_VECTOR_KEYS.map(function(){return!1}),{id:e.id,hasPurchased:r[n.BIT_VECTOR_KEYS.indexOf("hasPurchased")],isLead:r[n.BIT_VECTOR_KEYS.indexOf("isLead")]}}return{id:t.generate(),hasPurchased:!1,isLead:!1}}function o(e,t){switch(void 0===e&&(e=null),t.type){case"SALE_DETECTED":return a.update(e).get("hasPurchased").set(function(){return!0});case"FORM_SUBMIT":return a.update(e).get("isLead").set(function(){return!0});default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../../lib/utils"),s=e("../../../lib/selectors"),a=e("../../../lib/updater");n.BIT_VECTOR_KEYS=["isLead","hasPurchased"],n.initialUserState=r,n.userReducer=o,n.user=function(e){return e.user},n.persistentUserState=s.selector(n.user,function(e){var t=n.BIT_VECTOR_KEYS.map(function(t){return e[t]});return{id:e.id,fl:i.toBitVector(t)}})},{"../../../lib/selectors":161,"../../../lib/updater":162,"../../../lib/utils":163}],105:[function(e,t,n){"use strict";function r(e,t){switch(void 0===e&&(e=null),t.type){case"WINDOW_DIMENSIONS_UPDATED":return o.update(e).set(function(){return t.dimensions});default:return e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/updater");n.windowDimensionsReducer=r,n.windowDimensions=function(e){return e.windowDimensions}},{"../../../lib/updater":162}],106:[function(e,t,n){"use strict";function r(e,t){var n=i.domainEntityPropertyValues(e.getState()),r=function(n){var r,a=s.selector(i.domainEntityPropertyValues,function(e){return e[n]}),u=i.domainEntityProperty(n)(e.getState()),c=u.entity,l=u.property,p=u.persistedValue,f=u.dataType;o.onChange(a,e,function(e){var n=e.value;if(!(n===p&&void 0===r||null===n&&void 0===p&&void 0===r||n===r)){var o=null;void 0!==r?o=r:void 0!==p&&(o=p),t({entity:c,property:l,previousValue:o,newValue:n,dataType:f}),r=n}})};for(var a in n)r(a)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utils"),i=e("../reducers/domain-entity-properties"),s=e("../../../lib/selectors");n.domainEntityPropertyUpdateDispatcher=r},{"../../../lib/selectors":161,"../reducers/domain-entity-properties":91,"../utils":113}],107:[function(e,t,n){"use strict";function r(e,t){if(!s.geolocationRequired(e.getState()))return void u.logger.debug({},"Geolocation data not required");var n=o.newGeolocationClient(t);n.getGeolocation({}).then(a.getResponseData).then(function(t){"UNKNOWN"===t.country?u.logger.debug({location:t},"Geolocation unknown location"):(u.logger.debug({location:t},"Geolocation data received"),e.dispatch(i.geolocationReceived(t.country)))},function(e){u.logger.error({error:e},"Geolocation error")})}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/jsonrpc/GeolocationClient"),i=e("../actions/geolocation"),s=e("../reducers/config"),a=e("../../../lib/jsonrpc/JsonRpcClient"),u=e("../../../lib/Logger");n.updateGeolocation=r},{"../../../lib/Logger":136,"../../../lib/jsonrpc/GeolocationClient":152,"../../../lib/jsonrpc/JsonRpcClient":153,"../actions/geolocation":78,"../reducers/config":89}],108:[function(e,t,n){"use strict";function r(e,t){if(!l.socialProofRequired(e.getState()))return void u.logger.debug({},"Social Proof data not required");var n=a.newSocialProofClient(t);c.onChange(o.currentPageUrl,e,function(t){n.getPageViews({url:t}).then(s.getResponseData).then(function(n){u.logger.debug({pageViews:n},"Social Proof data received"),e.dispatch(i.pageViewsReceived(t,n))},function(e){u.logger.error({error:e},"Social Proof error")})})}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../reducers/page"),i=e("../actions/page"),s=e("../../../lib/jsonrpc/JsonRpcClient"),a=e("../../../lib/jsonrpc/SocialProofClient"),u=e("../../../lib/Logger"),c=e("../utils"),l=e("../reducers/config");n.updatePageViews=r},{"../../../lib/Logger":136,"../../../lib/jsonrpc/JsonRpcClient":153,"../../../lib/jsonrpc/SocialProofClient":154,"../actions/page":83,"../reducers/config":89,"../reducers/page":99,"../utils":113}],109:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../utils"),o=e("../actions/session"),i=e("../reducers/session");n.watchSession=function(e){r.onChange(i.session,e,n.watchForNewSession(e))},n.watchForNewSession=function(e){return function(t){i.isNewSession(t.lastActivities)&&e.dispatch(o.newSessionStarted(t.sessionCount+1))}}},{"../actions/session":85,"../reducers/session":100,"../utils":113}],110:[function(e,t,n){"use strict";function r(e){var t=new s.Set(i.pendingRequests(e.getState()));return o.waitForState(e,i.pendingRequests,function(e){return 0===t.intersection(new s.Set(e)).size})}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utils"),i=e("../reducers/trackable"),s=e("../../../lib/Set");n.waitForInFlightTrackables=r},{"../../../lib/Set":142,"../reducers/trackable":102,"../utils":113}],111:[function(e,t,n){"use strict";function r(e){var t=s.Base64.encode(JSON.stringify(e));return[n.LOCAL_STORAGE_VERSION,t,i(t)].join(":")}function o(e){var t=e.split(":");if(3!==t.length)throw new Error("Malformed raw contents, unable to parse.");var r=t[0],o=t[1],a=t[2];if(!r||r!==n.LOCAL_STORAGE_VERSION)throw new Error("Unexpected version from storage: "+r);var u=i(n.LOCAL_STORAGE_VERSION+":"+o);if(u!==a)throw new Error("Checksum of contents doesn't match calculated checksum");return JSON.parse(s.Base64.decode(o))}function i(e){for(var t=0,n=0;n<e.length;n++)t^=e.charCodeAt(n),t<<=5;return s.Base64.encode(t.toString())}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../../lib/Base64");n.LOCAL_STORAGE_VERSION="1",n.connectPersistence=function(e,t,n){var r;e.subscribe(function(){var o=t(e.getState());null!==o&&void 0!==o&&o!==r&&(n(o),r=o)})},n.serialise=r,n.deserialise=o,n.checksum=i},{"../../lib/Base64":130}],112:[function(e,t,n){"use strict";function r(e){var t=e.config,n=e.cookieDomain,r=e.cookieJar,o=e.currentTime,i=e.thirdPartyLocalStorage,s=e.sandboxConfig,a=e.uuidGenerator,c=e.deviceType,l=A.firstPartyLocalStorageInitialState(s.localStorage),p=L.thirdPartyLocalStorageInitialState(i,t.websiteId),f=N.yiCookieInitialState(r,n),d=D.y2CookieInitialState(r,n),v=b.initialSessionState(o,s.referrer,p.session,f.se,u.analyticsSessions(r,o));return{config:h.initialConfigState(t),device:c,page:y.initialPageState(s.location.href,o),pageTypes:S.initialPageTypes(t,s.location.href),pageElements:x.initialPageElementsState(t),urlsVisited:w.initialUrlsVisitedState(t,p.urlsVisited,v.sessionCount,s.location.href),domainEntityProperties:R.initialDomainEntityPropertiesState(t,v.sessionCount,l,p),session:v,labelledLastImpressions:O.initialLabelledLastImpressionsState(t,d.c),time:o,windowDimensions:s.windowDimensions,lastImpression:E.initialLastImpressionState(f.li),user:_.initialUserState(f.u,a),trackable:I.initialTrackableState()}}function o(){return c.combineReducers({config:h.configReducer,device:v.deviceReducer,page:y.pageReducer,pageTypes:S.pageTypesReducer,pageElements:x.pageElementsReducer,domainEntityProperties:R.domainEntityPropertiesReducer,session:b.sessionReducer,overlays:l.overlayStatusReducer,user:_.userReducer,lastImpression:E.impressionReducer,labelledLastImpressions:O.labelledLastImpressionsReducer,location:P.geolocationReducer,urlsVisited:w.urlsVisitedReducer,time:m.timeReducer,windowDimensions:M.windowDimensionsReducer,trackable:I.trackableReducer,lastComponentSubmitted:d.lastComponentSubmittedReducer})}function i(e){var t=f.shallowClone(e);return t.actionMeta=a({},t.actionMeta,{relay:{source:p.SANDBOX_SOURCE,senders:[p.SANDBOX_SOURCE]}}),t}function s(e,t){t.dispatch(i(C.pageElementValuesSync(x.pageElements(e)))),t.dispatch(i(g.pageUrlUpdated(y.currentPageUrl(e)))),t.dispatch(i(T.domainEntityPropertiesSync(R.domainEntityProperties(e)))),t.dispatch(i(g.pageViewsReceived(y.currentPageUrl(e),{views:y.pageViews(e)})))}var a=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var u=e("../storage/analyticsSessions"),c=e("../../lib/Redux"),l=e("./reducers/overlay-status"),p=e("./actionRelay"),f=e("../../lib/utils"),d=e("./reducers/last-component-submitted"),h=e("./reducers/config"),v=e("./reducers/device"),g=e("./actions/page"),y=e("./reducers/page"),b=e("./reducers/session"),m=e("./reducers/time"),_=e("./reducers/user"),E=e("./reducers/last-impression"),O=e("./reducers/labelled-last-impressions"),w=e("./reducers/urls-visited"),S=e("./reducers/page-types"),C=e("./actions/page-elements"),P=e("./reducers/geolocation"),I=e("./reducers/trackable"),R=e("./reducers/domain-entity-properties"),T=e("./actions/domain-entity-properties"),x=e("./reducers/page-elements"),M=e("./reducers/window-dimensions"),L=e("../storage/thirdPartyLocalStorage"),A=e("../storage/firstPartyLocalStorage"),D=e("../storage/y2Cookie"),N=e("../storage/yiCookie");n.initialState=r,n.tagReducer=o,n.replicateDerivedState=s},{"../../lib/Redux":141,"../../lib/utils":163,"../storage/analyticsSessions":114,"../storage/firstPartyLocalStorage":117,"../storage/thirdPartyLocalStorage":118,"../storage/y2Cookie":120,"../storage/yiCookie":121,"./actionRelay":70,"./actions/domain-entity-properties":75,"./actions/page":83,"./actions/page-elements":82,"./reducers/config":89,"./reducers/device":90,"./reducers/domain-entity-properties":91,"./reducers/geolocation":92,"./reducers/labelled-last-impressions":93,"./reducers/last-component-submitted":94,"./reducers/last-impression":95,"./reducers/overlay-status":96,"./reducers/page":99,"./reducers/page-elements":97,"./reducers/page-types":98,"./reducers/session":100,"./reducers/time":101,"./reducers/trackable":102,"./reducers/urls-visited":103,"./reducers/user":104,"./reducers/window-dimensions":105}],113:[function(e,t,n){"use strict";function r(e,t,n){return new i["default"](function(r,o){var i=t(e.getState());if(n(i))r(i);else var s=e.subscribe(function(){var o=t(e.getState());n(o)&&(r(o),s())})})}function o(e,t,n,r){void 0===r&&(r=!0);var o=e(t.getState());r&&n(o),t.subscribe(function(){var r=e(t.getState());r!==o&&(o=r,n(o))})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../lib/Promise");n.waitForState=r,n.onChange=o},{"../../lib/Promise":138}],114:[function(e,t,n){"use strict";function r(e,t){var r=e[n.GOOGLE_ANALYTICS_COOKIE_KEY]||[],s=e[n.UNIVERSAL_ANALYTICS_COOKIE_KEY]||[];return{googleAnalytics:o(r[0]),universalAnalytics:i(s[0],t)}}function o(e){if(e&&e.content)try{var t=e.content.split(".");if(t.length!==l)return;var n=parseInt(t[0],10),r=parseInt(t[1],10),o=parseInt(t[2],10),i=parseInt(t[3],10),s=parseInt(t[4],10),a=parseInt(t[5],10);if(!(u.isValidNumber(n)&&u.isValidNumber(r)&&u.isValidNumber(o)&&u.isValidNumber(i)&&u.isValidNumber(s)&&u.isValidNumber(a)))return;return a}catch(c){return}}function i(e,t){if(e&&e.content)try{var n=e.content.split(".");if(n.length!==c)return;var r=parseInt(n[1],10),o=parseInt(n[2],10),i=parseInt(n[3],10);if(!u.isValidNumber(r)||!u.isValidNumber(o)||!u.isValidNumber(i))return;return a.isNewSession([t,1e3*i])?s.STARTING_SESSION_COUNT+1:s.STARTING_SESSION_COUNT}catch(l){return}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../redux/reducers/session"),a=e("../redux/reducers/session"),u=e("../../lib/utils");n.UNIVERSAL_ANALYTICS_COOKIE_KEY="_ga",n.GOOGLE_ANALYTICS_COOKIE_KEY="__utma";var c=4,l=6;n.analyticsSessions=r},{"../../lib/utils":163,"../redux/reducers/session":100}],115:[function(e,t,n){"use strict";function r(e,t,n){try{var r=e[n]||[],o=r.map(function(e){return a(e.content)}),i=u.selectCookie(o,u.calculateDomainDegree(t));return i?JSON.parse(i.data):{}}catch(s){return c.logger.error({error:s},"Error deserialising "+n+" cookie"),{}}}function o(e,t,n,r,o){var a=!1;return function(p){var f={data:JSON.stringify(p),degree:u.calculateDomainDegree(n)};if(t.setCookie({name:e,content:s(f),domain:n||void 0,path:"/"}).then(l.noop,function(t){c.logger.error({error:t},"Error persisting to "+e+" cookie")}),!a){var d=i(e,r,n,o);d.forEach(function(n){t.deleteCookie(e,n).then(l.noop,function(t){c.logger.error({error:t},"Error deleting "+e+" cookie on domain "+n)})}),a=!0}}}function i(e,t,n,r){return d.compact((t[e]||[]).map(function(e){try{return a(e.content).degree}catch(t){return null}})).map(function(e){return e===u.MAX_COOKIE_DEGREE?null:r.split(".").slice(-e).join(".")}).filter(function(e){return e!==n})}function s(e){var t=p.Base64.encode(e.data),r=[n.COOKIE_VERSION,t,f.checksum(t),e.degree].join(":");return r}function a(e){var t=e.split(":");if(t.length<3||t.length>4)throw new Error("Malformed raw contents, unable to parse.");var r=t[0],o=t[1],i=t[2],s=t[3];if(!r||r!==n.COOKIE_VERSION)throw new Error("Unexpected version from storage: "+r);var a=f.checksum(n.COOKIE_VERSION+":"+o);if(a!==i)throw new Error("Checksum of contents doesn't match calculated checksum");return{data:p.Base64.decode(o),degree:u.parseDomainDegree(s)}}Object.defineProperty(n,"__esModule",{value:!0});var u=e("./cookieDomainUtils"),c=e("../../lib/Logger"),l=e("../../lib/utils"),p=e("../../lib/Base64"),f=e("../redux/storage"),d=e("../../lib/list");n.COOKIE_VERSION="1",n.cookieInitialState=r,n.persistToCookie=o,n.findRedundantCookieDomains=i,n.serialiseCookieContent=s,n.deserialiseCookieContent=a},{"../../lib/Base64":130,"../../lib/Logger":136,"../../lib/list":155,"../../lib/utils":163,"../redux/storage":111,"./cookieDomainUtils":116}],116:[function(e,t,n){"use strict";function r(e){return e?e.replace(/^\.+/,"").split(".").length:n.MAX_COOKIE_DEGREE}function o(e){if(!e)return n.MAX_COOKIE_DEGREE;var t=parseInt(e,10);return isNaN(t)?n.MAX_COOKIE_DEGREE:t}function i(e,t){if(0!==e.length){if(e.length<2)return e[0];var n=e.filter(function(e){return e.degree===t})[0];return"undefined"!=typeof n?n:a.sort(e,a._compare(function(e){return e.degree}))[0]}}function s(e,t){if(!t)return null;var n=e.indexOf(t),r=n===e.length-t.length,o=0===n||"."===e[n-1];return n!==-1&&r&&o?t:e}Object.defineProperty(n,"__esModule",{value:!0});var a=e("../../lib/list");n.MAX_COOKIE_DEGREE=99,n.calculateDomainDegree=r,n.parseDomainDegree=o,n.selectCookie=i,n.getCookieDomain=s},{"../../lib/list":155}],117:[function(e,t,n){"use strict";function r(e){try{return e?o.deserialise(e):{}}catch(t){return i.logger.error({error:t},"Error deserialising first party local storage contents"),{}}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../redux/storage"),i=e("../../lib/Logger");n.FIRST_PARTY_LOCAL_STORAGE_KEY="_yi",n.firstPartyLocalStorageInitialState=r},{"../../lib/Logger":136,"../redux/storage":111}],118:[function(e,t,n){"use strict";function r(e,t){try{if(!e)return{};var n=e.getItem(t.toString());return n?i.deserialise(n):{}}catch(r){return p.logger.error({error:r},"Error deserialising third party local storage"),{}}}function o(e,t,n){return function(r){if(e)try{e.setItem(t.toString(),i.serialise(r)),n.removeItem(f.FIRST_PARTY_LOCAL_STORAGE_KEY)}catch(o){p.logger.error({error:o},"Error writing to third party local storage")}}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../redux/storage"),s=e("../redux/reducers/urls-visited"),a=e("../redux/reducers/session"),u=e("../redux/reducers/domain-entity-properties"),c=e("../../lib/selectors"),l=e("../../lib/utils"),p=e("../../lib/Logger"),f=e("./firstPartyLocalStorage");n.THIRD_PARTY_LOCAL_STORAGE_KEY="_yi",n.thirdPartyLocalStorageInitialState=r,n.thirdPartyLocalStorageSerialisedState=c.mapSelector({urlsVisited:s.persistentUrlsVisitedState,session:a.persistentSessionReferrerState,deps:u.persistentDomainEntityPropertiesState},l.identity),n.persistToThirdPartyLocalStorage=o},{"../../lib/Logger":136,"../../lib/selectors":161,"../../lib/utils":163,"../redux/reducers/domain-entity-properties":91,"../redux/reducers/session":100,"../redux/reducers/urls-visited":103,"../redux/storage":111,"./firstPartyLocalStorage":117}],119:[function(e,t,n){"use strict";function r(e){return 1e3*(e+n.YIPOCH)}function o(e){return Math.floor(e/1e3)-n.YIPOCH}Object.defineProperty(n,"__esModule",{value:!0}),n.YIPOCH=1473984e3,n.getRegularTimestamp=r,n.getStorableTimestamp=o},{}],120:[function(e,t,n){"use strict";function r(e,t){return o.cookieInitialState(e,t,n.Y2_COOKIE_NAME)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./cookie"),i=e("../../lib/selectors"),s=e("../../lib/utils"),a=e("../redux/reducers/labelled-last-impressions");n.Y2_COOKIE_NAME="_y2",n.y2CookieInitialState=r,n.y2CookieSerialisedState=i.mapSelector({c:a.persistedLabelledLastImpressionState},s.identity)},{"../../lib/selectors":161,"../../lib/utils":163,"../redux/reducers/labelled-last-impressions":93,"./cookie":115}],121:[function(e,t,n){"use strict";function r(e,t){return i.cookieInitialState(e,t,n.YI_COOKIE_NAME)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../redux/reducers/session"),i=e("./cookie"),s=e("../../lib/utils"),a=e("../redux/reducers/last-impression"),u=e("../redux/reducers/user"),c=e("../../lib/selectors");n.YI_COOKIE_NAME="_yi",n.yiCookieSerialisedState=c.mapSelector({li:a.persistentLastImpressionState,se:o.persistentSessionCountState,u:u.persistentUserState},s.identity),n.yiCookieInitialState=r},{"../../lib/selectors":161,"../../lib/utils":163,"../redux/reducers/last-impression":95,"../redux/reducers/session":100,"../redux/reducers/user":104,"./cookie":115}],122:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../lib/events/EventTargetUtil"),o=e("../../lib/Logger"),i=e("../../lib/Promise"),s=e("../../lib/QueryStringUtil");n.MAX_URL_LENGTH=2083,n.EMITTING_ERROR="Error at emitting the event",n.TOO_BIG_ERROR="Trackable payload is too big";var a=function(){function e(e,t,n){this.documentLike=e,this.json=t,this.endpoint=n}return e.prototype.sendEvent=function(e){var t=this,a=s.QueryStringUtil.build(e);return new i["default"](function(e,i){var s="https://"+t.endpoint+"/i?"+a;if(s.length>n.MAX_URL_LENGTH)return o.logger.error({},n.TOO_BIG_ERROR),void i(new Error(n.TOO_BIG_ERROR));var u=t.documentLike.createElement("img");r.EventTargetUtil.addEventListener(u,"load",e),r.EventTargetUtil.addEventListener(u,"error",function(e){i(new Error(n.EMITTING_ERROR))}),u.src=s})},e}();n.Emitter=a},{"../../lib/Logger":136,"../../lib/Promise":138,"../../lib/QueryStringUtil":139,"../../lib/events/EventTargetUtil":151}],123:[function(e,t,n){"use strict";function r(e,t,r){var p={e:n.EVENT_CATEGORY,ue_px:c.Base64.encode(JSON.stringify(o(r))),tv:n.TRACKER_VERSION,aid:i.websiteId(t),yuid:a.user(t).id,url:s.currentPageUrl(t),dtm:(new Date).getTime(),sc:u.sessionCount(t),trv:e};return l.logger.debug({payload:p,context:r},"Creating trackable payload"),p}function o(e){return{data:{data:e}}}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../redux/reducers/config"),s=e("../redux/reducers/page"),a=e("../redux/reducers/user"),u=e("../redux/reducers/session"),c=e("../../lib/Base64"),l=e("../../lib/Logger"),p=e("./trackableEvents"),f=e("../redux/actions/trackable");n.EVENT_CATEGORY="ue",n.TRACKER_VERSION="2-0.5.0";var d=function(){function e(e,t,n){this.emitter=e,this.timeProvider=t,this.releaseVersion=n,this.currentEventId=0}return e.prototype.handleAction=function(e,t){var n=p.TRACKABLE_EVENTS[e.type];if(n){this.currentEventId+=1;var r=this.currentEventId;t.dispatch(f.trackableRequestStart(r));var o=this.prepareAction(e,t,n);return this.emitter.sendEvent(o).then(function(){t.dispatch(f.trackableRequestSuccess(r))},function(e){t.dispatch(f.trackableRequestFail(r))})}return null},e.prototype.prepareAction=function(e,t,n){var o=n(e,t.getState(),this.timeProvider),i=r(this.releaseVersion,t.getState(),o);return i},e}();n.EventTracker=d},{"../../lib/Base64":130,"../../lib/Logger":136,"../redux/actions/trackable":87,"../redux/reducers/config":89,"../redux/reducers/page":99,"../redux/reducers/session":100,"../redux/reducers/user":104,"./trackableEvents":124}],124:[function(e,t,n){"use strict";function r(e,t,n,r){return{et:e,dev:c.deviceType(n),dwell:r.currentTime()-a.currentPageNavigatedAt(n),oid:u.organisationId(n),wid:u.websiteId(n)}}function o(e,t,n,o){return s({},r(e,t,n,o),{cid:t.campaignId,colid:t.collectionId,comid:t.componentId})}function i(e,t,n,r){return s({},o(e,t,n,r),{expid:t.experimentId,expuuid:t.experimentUuid,splid:t.splitId,split:t.experimentSplitType})}var s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../redux/reducers/page"),u=e("../redux/reducers/config"),c=e("../redux/reducers/device"),l=e("../redux/reducers/page-types"),p=e("../redux/reducers/session"),f=function(e,t,n){var o=l.activePageTypes(t).filter(function(e){return"common"!==e.name}).map(function(e){return e.name}),i=p.currentReferrer(t);return s({},r("PageView",e,t,n),{dwell:0,ref:i.substring(0,256),pagetype:o})},d=function(e,t,n){return s({},r("Sale",e,t,n),{value:e.sale.getValue(),currency:u.websiteCurrency(t),cid:e.sale.getCampaignId(),colid:e.sale.getCollectionId(),comid:e.sale.getComponentId(),suuid:e.sale.getUuid(),iscontrol:e.sale.isControl()})},h=function(e,t,n){return s({},o("FormSubmit",e,t,n),{formdata:e.inputValues})},v=function(e,t,n){return i("Impression",e,t,n)},g=function(e,t,n){return i("Click",e,t,n)},y=function(e,t,n){return i("Close",e,t,n)},b=function(e,t,n){return i("BlockedImpression",e,t,n)},m=function(e,t,n){return s({},r("TagLog",e,t,n),{lvl:e.log.level,msg:e.log.message})},_=function(e,t,n){return r("ExitIntent",e,t,n)},E=function(e,t,n){return s({},r("DomainEntityPropertyUpdate",e,t,n),{entity:e.entity,property:e.property,prevval:e.previousValue,newval:e.newValue,type:e.dataType})};n.TRACKABLE_EVENTS={PAGE_URL_UPDATED:f,SALE_DETECTED:d,FORM_SUBMIT:h,IMPRESSION:v,CLICK_THROUGH:g,CLOSE_EVENT:y,BLOCKED_IMPRESSION:b,LOG_MESSAGE:m,EXIT_INTENT:_,DOMAIN_ENTITY_PROPERTY_UPDATED:E}},{"../redux/reducers/config":89,"../redux/reducers/device":90,"../redux/reducers/page":99,"../redux/reducers/page-types":98,"../redux/reducers/session":100}],125:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Observable"),i=e("../../lib/Logger"),s=function(e){function t(){var t=e.call(this)||this;return t.state=a.OFF,t}return r(t,e),t.prototype.prepare=function(){this.state===a.OFF&&(i.logger.debug({trigger:this},"Preparing trigger"),this.preparation(),this.state=a.READY)},t.prototype.cancel=function(){this.state===a.READY&&(i.logger.debug({trigger:this},"Cancelling trigger"),this.cancellation(),this.state=a.OFF)},t.prototype.trigger=function(){if(this.state!==a.READY)throw new Error("A trigger can only be triggered when it's in a READY state");this.state=a.TRIGGERED,this.publish(null)},t}(o.Observable);n.Trigger=s;var a;!function(e){e[e.OFF=0]="OFF",e[e.READY=1]="READY",e[e.TRIGGERED=2]="TRIGGERED"}(a=n.TriggerState||(n.TriggerState={}))},{"../../lib/Logger":136,"../../lib/Observable":137
}],126:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(t){var n=e.call(this)||this;return n.exits=t,n}return r(t,e),t.prototype.preparation=function(){var e=this;this.subscription=this.exits.subscribe(function(){e.subscription.dispose(),e.trigger()})},t.prototype.cancellation=function(){this.subscription.dispose()},t}(o.Trigger);n.ExitIntentTrigger=i},{"./Base":125}],127:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./ExitIntentTrigger"),o=e("./TimerTrigger"),i=function(){function e(e){this.exitIntention=e}return e.prototype.create=function(e){switch(e.type){case"Timer":return new o.TimerTrigger(e.settings);case"ExitIntent":return new r.ExitIntentTrigger(this.exitIntention);default:throw new Error("Unknown trigger type")}},e}();n.TriggerFactory=i},{"./ExitIntentTrigger":126,"./TimerTrigger":128}],128:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(t){var n=e.call(this)||this;return n.timeMs=n.timeToMilliseconds(t.time,t.unit),n}return r(t,e),t.prototype.getTimeoutDuration=function(){return this.timeMs},t.prototype.preparation=function(){var e=this;this.timeout=setTimeout(function(){e.trigger()},this.timeMs)},t.prototype.cancellation=function(){clearTimeout(this.timeout)},t.prototype.timeToMilliseconds=function(e,t){var n={seconds:1e3,minutes:6e4};return e*n[t]},t}(o.Trigger);n.TimerTrigger=i},{"./Base":125}],129:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./Logger"),o=function(){function e(){this.nextCallbackId=0,this.timeoutKey=0,this.timeoutIdMap={}}return e.prototype.performAsyncCallback=function(e,t,n){var r=this,o=++this.timeoutKey;return this.timeoutIdMap[o]=setTimeout(function(){r.executeCallback(o,e,n,n)},t),o},e.prototype.stopCallback=function(e){try{clearTimeout(this.timeoutIdMap[e])}catch(t){r.logger.error({error:t,timeoutKey:e},"Could not stop the callback.")}},e.prototype.cancelPendingCallbacks=function(){this.cancelBeforeId=this.nextCallbackId},e.prototype.executeCallback=function(e,t,n,o){var i=this,s=this.nextCallbackId++;if(!(this.cancelBeforeId&&s<this.cancelBeforeId))try{t()}catch(a){r.logger.error({error:a},"Async callback failed.")}finally{o&&(this.timeoutIdMap[e]=setTimeout(function(){i.executeCallback(e,t,o,o)},n))}},e}();n.AsyncWorker=o},{"./Logger":136}],130:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=function(){function e(){}return e.encode=function(t){var n,o,i,s,a,u,c,l="",p=0;for(t=e.utf8Encode(t);p<t.length;)n=t.charCodeAt(p++),o=t.charCodeAt(p++),i=t.charCodeAt(p++),s=n>>2,a=(3&n)<<4|o>>4,u=(15&o)<<2|i>>6,c=63&i,isNaN(o)?u=c=64:isNaN(i)&&(c=64),l+=r.charAt(s)+r.charAt(a)+r.charAt(u)+r.charAt(c);return l},e.decode=function(t){var n,o,i,s,a,u,c,l="",p=0;if(t.match(/[^A-Za-z0-9\+\/\=]/))throw new Error("Provided string is malformed: "+t);for(;p<t.length;)s=r.indexOf(t.charAt(p++)),a=r.indexOf(t.charAt(p++)),u=r.indexOf(t.charAt(p++)),c=r.indexOf(t.charAt(p++)),n=s<<2|a>>4,o=(15&a)<<4|u>>2,i=(3&u)<<6|c,l+=String.fromCharCode(n),64!==u&&(l+=String.fromCharCode(o)),64!==c&&(l+=String.fromCharCode(i));return l=e.utf8Decode(l)},e.utf8Encode=function(e){for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},e.utf8Decode=function(e){for(var t="",n=0,r=0,o=0,i=0;n<e.length;)r=e.charCodeAt(n),r<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(o=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&o),n+=2):(o=e.charCodeAt(n+1),i=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&o)<<6|63&i),n+=3);return t},e}();n.Base64=o},{}],131:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Observable"),i=100,s=function(e){function t(t){void 0===t&&(t=i);var n=e.call(this)||this;return n.buffer=[],n.maxBufferSize=t,n}return r(t,e),t.prototype.publish=function(t){if(0===this.subscribers.length){if(this.buffer.length>=this.maxBufferSize)throw new Error("Max buffered values limit reached");this.buffer.push(t)}else e.prototype.publish.call(this,t)},t.prototype.subscribe=function(t){var n=e.prototype.subscribe.call(this,t);return this.buffer.length>0&&this.flush(),n},t.prototype.flush=function(){var t=this.buffer;this.buffer=[];for(var n=0,r=t;n<r.length;n++){var o=r[n];e.prototype.publish.call(this,o)}},t}(o.Observable);n.BufferingObservable=s},{"./Observable":137}],132:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../lib/Observable"),i=e("../lib/DeepEqual"),s=e("../lib/Promise"),a=function(e){function t(){return e.call(this)||this}return r(t,e),t.cache=function(e){var n=new t;return e.subscribe(function(e){n.publishIfChanged(e)}),n},t.prototype.publish=function(t){this.value=t,e.prototype.publish.call(this,t)},t.prototype.publishIfChanged=function(e){return!i.DeepEqual.deepEqual(e,this.getCurrentValue())&&(this.publish(e),!0)},t.prototype.getCurrentValue=function(){return this.value},t.prototype.getValue=function(){var e=this;return new s["default"](function(t,n){if("undefined"!=typeof e.value)t(e.value);else var r=e.subscribe(function(e){t(e),r.dispose()})})},t.prototype.toJSON=function(){return{value:this.value}},t}(o.Observable);n.CachingObservable=a},{"../lib/DeepEqual":134,"../lib/Observable":137,"../lib/Promise":138}],133:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e}();n.Creator=r},{}],134:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.deepEqual=function(t,n){if(null===t||null===n)return t===n;if("undefined"==typeof t||"undefined"==typeof n)return t===n;if(e.isPrimitive(t)||e.isPrimitive(n))return t===n;if(t instanceof Date)return n instanceof Date&&t.getTime()===n.getTime();var r=Object.getOwnPropertyNames(t),o=Object.getOwnPropertyNames(n);if(r.length!==o.length)return!1;r.sort(),o.sort();for(var i=0;i<r.length;i++)if(r[i]!==o[i])return!1;for(var s=0,a=r;s<a.length;s++){var u=a[s];if(!e.deepEqual(t[u],n[u]))return!1}return!0},e.isPrimitive=function(e){return/boolean|number|string/.test(typeof e)},e}();n.DeepEqual=r},{}],135:[function(e,t,n){"use strict";function r(e){return Object.keys(e).map(function(t){return e[t]})}function o(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t}function i(e,t){void 0===t&&(t=n.lastValueWins);for(var r={},o=0,i=e;o<i.length;o++){var s=i[o];void 0!==r[s.key]&&(s=t({key:s.key,value:r[s.key]},s)),r[s.key]=s.value}return r}function s(e,t){return i(o(e).map(t))}function a(e,t){return s(e,function(e){var n=e.key,r=e.value;return{key:n,value:t(r,n)}})}Object.defineProperty(n,"__esModule",{value:!0}),n.values=r,n.entries=o,n.lastValueWins=function(e,t){return t},n.dict=i,n.dictMap=s,n._dictMap=function(e){return function(t){return s(t,e)}},n.dictMapValues=a,n._dictMapValues=function(e){return function(t){return a(t,e)}}},{}],136:[function(e,t,n){"use strict";function r(e){return a.indexOf(e)}var o=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var i=e("./BufferingObservable"),s=e("./Dictionary");n.Level={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",FATAL:"FATAL"};var a=["DEBUG","INFO","WARN","ERROR","FATAL"];n.MAX_REMOTE_LOG=20,n.MAX_LOG_PAYLOAD=1500;var u=function(e){function t(){var t=e.call(this)||this;return t.level=n.Level.INFO,t.consoleLogging=!1,t.messageCount=0,t.messageBuffer=[],t.isRecursing=!1,t}return o(t,e),t.prototype.debug=function(e,t){this.log(n.Level.DEBUG,t,e)},t.prototype.info=function(e,t){this.log(n.Level.INFO,t,e)},t.prototype.warn=function(e,t){this.log(n.Level.WARN,t,e)},t.prototype.error=function(e,t){this.log(n.Level.ERROR,t,e)},t.prototype.fatal=function(e,t){this.log(n.Level.FATAL,t,e)},t.prototype.getLevel=function(){return this.level},t.prototype.setLevel=function(e){this.level=e},t.prototype.enableConsoleLogging=function(){this.consoleLogging=!0},t.prototype.publish=function(t){this.messageCount>=n.MAX_REMOTE_LOG||(e.prototype.publish.call(this,t),this.messageCount++,this.messageCount>=n.MAX_REMOTE_LOG&&(this.consoleLog(n.Level.DEBUG,"Remote log cap reached"),e.prototype.publish.call(this,{level:n.Level.WARN,message:JSON.stringify({msg:"Log message cap reached, log truncated"}),timestamp:(new Date).getTime()})))},t.prototype.log=function(e,t,o){if(!(r(e)<r(this.level))){var i=this.normaliseArgs(o);if(this.consoleLog(e,t,i),this.isRecursing)return void this.consoleLog(n.Level.WARN,"Log message triggered while logging. skipping remote log");this.isRecursing=!0,this.remoteLog(e,t,i),this.isRecursing=!1}},t.prototype.remoteLog=function(e,t,r){t=t||"";var o;try{o=JSON.stringify({msg:t,args:r})}catch(i){return void this.consoleLog(n.Level.WARN,"Couldnt serialise remote log message")}o.length>n.MAX_LOG_PAYLOAD&&(o=JSON.stringify({msg:t.substring(0,n.MAX_LOG_PAYLOAD)}),this.consoleLog(n.Level.WARN,"Log message was truncated before sending remotely")),this.publish({level:e,message:o,timestamp:(new Date).getTime()})},t.prototype.consoleLog=function(e,t,r){if(this.consoleLogging)switch(t+=t.match("\n$")?"":"\n",e){default:case n.Level.DEBUG:console.log(t,r);break;case n.Level.INFO:console.info(t,r);break;case n.Level.WARN:console.warn(t,r);break;case n.Level.ERROR:case n.Level.FATAL:console.error(t,r)}},t.prototype.normaliseArgs=function(e){var t=this;if(e)return s.dictMapValues(e,function(e,n){var r;return r=e instanceof Error?t.serialiseError(e):"undefined"!=typeof ErrorEvent&&e instanceof ErrorEvent?e.error?t.serialiseError(e.error):t.serialiseErrorEvent(e):e})},t.prototype.serialiseError=function(e){return{name:e.name,message:e.message,fileName:e.fileName,lineNumber:e.lineNumber,columnNumber:e.columnNumber,stack:e.stack?e.stack.split("\n")[1]:void 0}},t.prototype.serialiseErrorEvent=function(e){return{message:e.message,fileName:e.filename,lineNumber:e.lineno,columnNumber:e.colno}},t}(i.BufferingObservable);n.Logger=u,n.logger=new u},{"./BufferingObservable":131,"./Dictionary":135}],137:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./Promise"),o=e("./DeepEqual"),i=function(){function e(){this.subscribers=[],this.publishCount=0}return e.merge=function(t){var n=new e;return t.forEach(function(e){e.subscribe(function(e){n.publish(e)})}),n},e.map=function(t,n){var r=new e;return t.subscribe(function(e){return r.publish(n(e))}),r},e.pluck=function(t,n){return e.map(t,function(e){return e[n]})},e.fromSelector=function(t,n){var r,o=new e;return n.subscribe(function(){var e=t(n.getState());e!==r&&(o.publish(e),r=e)}),o},e.prototype.subscribe=function(e){if(this.subscribers.indexOf(e)!==-1)throw new Error("Cannot subscribe more than once");return this.subscribers.push(e),this.createSubscription(e)},e.prototype.publish=function(e){for(var t=this.subscribers.map(function(e){return e}),n=0;n<t.length;n++)t[n](e);this.publishCount++},e.prototype.filter=function(t,n){void 0===n&&(n=null);var r=new e,o=this;return this.subscribe(function(e){t.call(n,e,o.publishCount,o)&&r.publish(e)}),r},e.prototype.waitFor=function(e){var t=this;return new r["default"](function(n){t.subscribe(function(t){o.DeepEqual.deepEqual(t,e)&&n(t)})})},e.prototype.nextValue=function(){var e=this;return new r["default"](function(t){var n=e.subscribe(function(e){n.dispose(),t(e)})})},e.prototype.dispatchAs=function(e,t){return this.subscribe(function(n){return t.dispatch(e(n))})},e.prototype.createSubscription=function(e){var t=this;return{dispose:function(){var n=t.subscribers.indexOf(e);n>-1&&t.subscribers.splice(n,1)}}},e}();n.Observable=i},{"./DeepEqual":134,"./Promise":138}],138:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./utils"),o=function(){function e(e){var t=this;if(this.status=i.PENDING,this.queue=[],"function"==typeof e)try{e(function(e){t.resolve(e)},function(e){t.reject(e)})}catch(n){this.reject(n)}}return e.resolve=function(t){return new e(function(n,r){"undefined"==typeof t?n(void 0):t instanceof e?t.then(n,r):n(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.all=function(t){return 0===t.length?e.resolve([]):new e(function(e,n){var r=[],o=0;t.forEach(function(i,s){i.then(function(n){r[s]=n,o+=1,o===t.length&&e(r)},function(e){n(e)})})})},e.race=function(t){return new e(function(e,n){var r=!1;for(var o in t)t[o].then(function(t){r||(r=!0,e(t))},function(e){r||(r=!0,n(e))})})},e.prototype.then=function(t,n){var r={onFulfilled:t,onRejected:n,promise:new e};return this.queue.push(r),this.status===i.FULFILLED?this.resolve(this.resolution):this.status===i.REJECTED&&this.reject(this.error),r.promise},e.prototype["catch"]=function(e){return this.then(r.identity,e)},e.prototype.resolve=function(e){this.status=i.FULFILLED,this.resolution=e;var t=this.queue.shift();try{for(;t;){var n=t.onFulfilled(e);this.resolveValue(n,t),t=this.queue.shift()}}catch(r){setTimeout(function(){return t.promise.reject(r)},0)}},e.prototype.reject=function(e){this.status=i.REJECTED,this.error=e;var t=this.queue.shift();try{for(;t;){if("function"==typeof t.onRejected){var n=t.onRejected(e);this.resolveValue(n,t)}else setTimeout(t.promise.reject.bind(t.promise,e),0);t=this.queue.shift()}}catch(e){setTimeout(function(){return t.promise.reject(e)},0)}},e.prototype.timeout=function(t,n){return void 0===n&&(n="Promise timed out after "+t+"ms"),e.race([this,new e(function(e,r){setTimeout(function(){r(new Error(n))},t)})])},e.prototype.resolveValue=function(t,n){t instanceof e?t.then(function(e){setTimeout(n.promise.resolve.bind(n.promise,e),0)},function(e){setTimeout(n.promise.reject.bind(n.promise,e),0)}):setTimeout(n.promise.resolve.bind(n.promise,t),0)},e}();n["default"]=o;var i;!function(e){e[e.PENDING=0]="PENDING",e[e.REJECTED=1]="REJECTED",e[e.FULFILLED=2]="FULFILLED"}(i||(i={}))},{"./utils":163}],139:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.build=function(e){var t=new Array;for(var n in e)null!==e[n]?t.push(encodeURIComponent(n)+"="+encodeURIComponent(""+e[n])):t.push(encodeURIComponent(n));return t.join("&")},e.parse=function(e){var t,n;return t={},n=e.split("&").map(function(e){return e.split("=")}),n.forEach(function(e){var n=e[0],r=e[1],o=decodeURIComponent(r);t[decodeURIComponent(n)]="undefined"===o?null:o}),t},e}();n.QueryStringUtil=r},{}],140:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getInteger=function(e){var t=Math.random()*(e+1);return Math.floor(t)},e}();n.RandomSource=r},{}],141:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./redux/createStore");n.createStore=r.createStore;var o=e("./redux/combineReducers");n.combineReducers=o.combineReducers;var i=e("./redux/applyMiddleware");n.applyMiddleware=i.applyMiddleware;var s=e("./redux/reduxDebugEnabledEnhancer");n.reduxDebugEnabledEnhancer=s.reduxDebugEnabledEnhancer},{"./redux/applyMiddleware":157,"./redux/combineReducers":158,"./redux/createStore":159,"./redux/reduxDebugEnabledEnhancer":160}],142:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./DeepEqual"),o=function(){function e(e){this.set=this.unique(e)}return Object.defineProperty(e.prototype,"size",{get:function(){return this.set.length},enumerable:!0,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.size},e.prototype.add=function(t){return this.has(t)?this:new e(this.set.concat([t]))},e.prototype["delete"]=function(t){return new e(this.set.filter(function(e){return!r.DeepEqual.deepEqual(t,e)}))},e.prototype.has=function(e){for(var t=0;t<this.size;t++)if(r.DeepEqual.deepEqual(e,this.set[t]))return!0;return!1},e.prototype.values=function(){return this.set.slice()},e.prototype.union=function(t){return new e(t.set.concat(this.set))},e.prototype.intersection=function(t){var n=new e([]);return this.set.forEach(function(e){t.has(e)&&(n=n.add(e))}),n},e.prototype.unique=function(e){function t(e,t){for(var n=0;n<e.length;n++)if(r.DeepEqual.deepEqual(e[n],t))return n;return-1}return e.filter(function(n,r){return t(e,n)===r})},e}();n.Set=o},{"./DeepEqual":134}],143:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../lib/QueryStringUtil");n.YITIME_HASH_PARAMETER="yitime",n.TIME_PROVIDER_THRESHOLD_MS=6e4;var o=function(){function e(e){if(this.offsetMs=0,e){var t=1e3*e-(new Date).getTime();Math.abs(t)>n.TIME_PROVIDER_THRESHOLD_MS&&(this.offsetMs=t)}}return e.parseSeedFromHash=function(e){var t=r.QueryStringUtil.parse(e.substring(1)),o=parseInt(t[n.YITIME_HASH_PARAMETER]||"",10)||0;return o},e.prototype.currentTime=function(){return(new Date).getTime()+this.offsetMs},e}();n.TimeProvider=o},{"../lib/QueryStringUtil":139}],144:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",o=/[xy]/g,i="y",s=16,a=3,u=8,c=function(){function e(){}return e.prototype.generate=function(){var e=this;return r.replace(o,function(t){var n=Math.random()*s|0,r=t===i?e.maskReservedBits(n):n;return r.toString(s)})},e.prototype.maskReservedBits=function(e){return e&a|u},e}();n.UUIDGenerator=c},{}],145:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../list"),o=365,i=864e5,s=function(){function e(){}return e.generateCookieStr=function(t){var n;n=encodeURIComponent(t.content);var r,i=encodeURIComponent(t.name);return r="undefined"!=typeof t.expiration?t.expiration.toUTCString():e.calculateExpiryDate(o).toUTCString(),[i,"=",n,"; expires="+r,t.domain&&"; domain="+t.domain,t.path&&"; path="+t.path,t.httpOnly?"; httpOnly":"",t.secure?"; secure":""].join("")},e.parseCookieStr=function(e){var t=e?e.split("; "):[],n=t.map(function(e){var t=e.split("="),n=t[0],r=t.slice(1).join("=");'"'===r.charAt(0)&&(r=r.slice(1,-1));try{r=decodeURIComponent(r)}catch(o){}return{name:n,content:r}});return r.groupBy(n,r.property("name"))},e.calculateExpiryDate=function(e){var t=new Date;return t.setMilliseconds(t.getMilliseconds()+e*i),t},e}();n.CookieUtil=s},{"../list":155}],146:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.canonicalise=function(e){return encodeURIComponent(decodeURIComponent(this.removeLeadingSlashes(this.removeProtocol(this.trim(this.lower(e))))))},e.trim=function(e){return e.trim()},e.removeProtocol=function(e){return e.replace(/^https?:/,"")},e.removeLeadingSlashes=function(e){return e.replace(/^\/\//,"")},e.lower=function(e){return e.toLowerCase()},e}();n.UrlUtil=r},{}],147:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../Promise"),o=e("../events/EventTargetUtil"),i=e("../Observable"),s=e("../CachingObservable");n.URL_PUBLISH_INTERVAL_MILLISECONDS=500,n.WINDOW_DIMENSION_CHECK_INTERVAL_MILLISECONDS=1e3;var a="complete";n.IS_IOS_11=window.navigator.appVersion&&window.navigator.appVersion.indexOf("iPhone OS 11")>=0;var u=function(){function e(e){this.windowLike=e}return e.prototype.listen=function(e){var t=new i.Observable,n=function(e){t.publish(e)};return o.EventTargetUtil.addEventListener(this.windowLike,e,n),t},e.prototype.observeLocation=function(){var e=this;if(!this.locationObservable){this.locationObservable=new s.CachingObservable;var t=function(){e.locationObservable.publishIfChanged(e.getLocation())};setInterval(t,n.URL_PUBLISH_INTERVAL_MILLISECONDS)}return this.locationObservable},e.prototype.getLocation=function(){return{hash:this.windowLike.location.hash,host:this.windowLike.location.host,hostname:this.windowLike.location.hostname,href:this.windowLike.location.href,pathname:this.windowLike.location.pathname,port:this.windowLike.location.port,protocol:this.windowLike.location.protocol,search:this.windowLike.location.search}},e.prototype.getInnerDimensions=function(){var e={height:this.windowLike.innerHeight,width:this.windowLike.innerWidth,deviceScale:this.windowLike.devicePixelRatio||1};return n.IS_IOS_11&&(e._iOS11_top=this.windowLike.scrollY),e},e.prototype.observeInnerDimensions=function(){var e=this;if(!this.dimensionsObservable){this.dimensionsObservable=new s.CachingObservable;var t=function(){e.dimensionsObservable.publishIfChanged(e.getInnerDimensions())};this.listen("resize").subscribe(t),n.IS_IOS_11&&this.listen("scroll").subscribe(t),setInterval(t,n.WINDOW_DIMENSION_CHECK_INTERVAL_MILLISECONDS)}return this.dimensionsObservable},e.prototype.assetsLoaded=function(){var e=this;return new r["default"](function(t){e.windowLike.document.readyState===a?t(void 0):e.listen("load").subscribe(function(e){t(void 0)})})},e.prototype.redirect=function(e){this.windowLike.location.href=e},e}();n.WindowUtil=u},{"../CachingObservable":132,"../Observable":137,"../Promise":138,"../events/EventTargetUtil":151}],148:[function(e,t,n){"use strict";function r(e){for(var t in e)if(e[t])return!0;return!1}function o(e){var t=e.userAgent,o=r({Android:/Android/i.test(t)&&/mobile|Mobile/i.test(t),BlackBerry:/BlackBerry/i.test(t)||/BB10; Touch/.test(t),iOS:/iPhone|iPod/i.test(t),Opera:/Opera Mini/i.test(t),Windows:/IEMobile/i.test(t)||/webOS/i.test(t)}),i=r({Android:/Android/i.test(t)&&!/mobile|Mobile/i.test(t),iOS:/iPad/i.test(t),Windows:t.toLowerCase().indexOf("windows nt")!==-1&&t.toLowerCase().indexOf("touch")!==-1,Kindle:t.toLowerCase().indexOf("kindle")!==-1||t.toLowerCase().indexOf("silk")!==-1});return o?n.DeviceType.MOBILE:i?n.DeviceType.TABLET:n.DeviceType.DESKTOP}Object.defineProperty(n,"__esModule",{value:!0}),n.DeviceType={MOBILE:"mobile",TABLET:"tablet",DESKTOP:"desktop"},n.detectDeviceType=o},{}],149:[function(e,t,n){"use strict";function r(e){return new s["default"](function(t,n){var r=new XMLHttpRequest;r.open(e.method,e.uri),a.EventTargetUtil.addEventListener(r,"load",o(r,t,n)),a.EventTargetUtil.addEventListener(r,"error",i(r,n)),"POST"===e.method?r.send(e.data):r.send()})}function o(e,t,n){return function(){if(/2\d\d/.test(e.status.toString())){var r=e.responseText;t(r)}else n(new Error(e.statusText))}}function i(e,t){return function(){t(new Error("Network Error"))}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("../Promise"),a=e("../events/EventTargetUtil");n.sendHttpRequest=r},{"../Promise":138,"../events/EventTargetUtil":151}],150:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DOMEventType={CLICK:"click",SUBMIT:"submit"}},{}],151:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){}return e.addEventListener=function(t,n,r,o){if(e.isStandardsEventTarget(t))t.addEventListener(n,r,o);else{if(!e.isMSEventTarget(t))throw new TypeError("object is not an EventTarget");t.attachEvent("on"+n,r)}},e.removeEventListener=function(t,n,r,o){if(e.isStandardsEventTarget(t))t.removeEventListener(n,r,o);else{if(!e.isMSEventTarget(t))throw new TypeError("object is not an EventTarget");t.detachEvent("on"+n,r)}},e.isStandardsEventTarget=function(e){return"object"==typeof e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener&&"function"==typeof e.dispatchEvent},e.isMSEventTarget=function(e){return"object"==typeof e&&"function"==typeof e.attachEvent&&"function"==typeof e.detachEvent&&"function"==typeof e.fireEvent},e}();n.EventTargetUtil=r},{}],152:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="geolocation";n.newGeolocationClient=function(e){return{getGeolocation:function(t){return e(r,"getGeolocation",t)},getGeolocationByIp:function(t){return e(r,"getGeolocationByIp",t)}}}},{}],153:[function(e,t,n){"use strict";function r(e){if("error"===e.type)throw new Error(JSON.stringify(e.value));return e.value}function o(e,t){return e+"/"+t+"/rpc"}function i(e,t,n){var r={_metadata:{ts:Math.floor(Date.now()/1e3),version:t.version}};return{id:t.uuidGenerator.generate(),jsonrpc:"2.0",method:e,params:s({},n,r)}}var s=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var a=e("../Promise");n.newJsonRpcClient=function(e){return function(t,n,r){try{return e.send({method:"POST",data:JSON.stringify(i(n,e,r)),uri:o(e.gatewayEndpoint,t)}).then(function(e){var t=JSON.parse(e),n=t,r=t,o={type:"result",value:n.result},i={type:"error",value:r.error};return n.result?o:i})}catch(s){return a["default"].reject(s)}}},n.getResponseData=r},{"../Promise":138}],154:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r="socialproof";n.newSocialProofClient=function(e){return{getPageViews:function(t){return e(r,"getPageViews",t)}}}},{}],155:[function(e,t,n){"use strict";function r(e){for(var t=[],n=0,r=e;n<r.length;n++)for(var o=r[n],i=0,s=o;i<s.length;i++){var a=s[i];t.push(a)}return t}function o(e){return e.filter(function(e){return null!==e&&void 0!==e})}function i(e,t){return e.map(t)}function s(e){return function(t){return t.map(e)}}function a(e,t){var n=e.indexOf(t);return n===-1?e:(e=e.slice(),e.splice(n,1),e)}function u(e){return function(t){return a(t,e)}}function c(e,t){return p(e,[t])}function l(e){return f([e])}function p(e,t){return e.concat(t)}function f(e){return function(t){return t.concat(e)}}function d(e,t){for(var n=0,r=e.length;n<r&&t(e[n]);)n++;return e.slice(n,r)}function h(e,t){return e.filter(t)}function v(e){return function(t){return t.filter(e)}}function g(e,t){if(0!==e.length){var n=d(e,function(e){return!t(e)});return y(n)}}function y(e){return e[0]}function b(e){return o(e)[0]}function m(e){return 0===e.length}function _(e){return e.slice(0).reverse()}function E(e,t){return e.slice(0,t)}function O(e){return function(t){return E(t,e)}}function w(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}function S(e,t){return!w(e,function(e){return!t(e)})}function C(e){for(var t=Math.max.apply(Math,e.map(function(e){return e.length})),n=[],r=0;r<t;r++){for(var o=[],i=0,s=e;i<s.length;i++){var a=s[i];o.push(a[r])}n.push(o)}return n}function P(e,t){return L.dict(e.map(function(e){return{key:t(e),value:e}}))}function I(e,t){return L.dict(e.map(function(e){return{key:t(e),value:[e]}}),function(e,t){return{key:e.key,value:e.value.concat(t.value)}})}function R(e){return function(t){var n=t[e];return"string"==typeof n?n:A.stableStringify(n)}}function T(e,t){return e.slice(0).sort(t)}function x(e){return function(t,n){var r=e(t),o=e(n);return r<o?-1:r>o?1:0}}function M(e,t){return D.values({lowerBound:e,upperBound:t})}Object.defineProperty(n,"__esModule",{value:!0});var L=e("./Dictionary"),A=e("@yieldify/gendry-hash-util");n.flatten=r,n.compact=o,n.map=i,n._map=s,n.remove=a,n._remove=u,n.append=c,n._append=l,n.concat=p,n._concat=f,n.dropWhile=d,n.filter=h,n._filter=v,n.find=g,n.head=y,n.first=b,n.isEmpty=m,n.reverse=_,n.take=E,n._take=O,n.some=w,n.every=S,n.zip=C,n.indexBy=P,n._indexBy=function(e){return function(t){return P(t,e)}},n.groupBy=I,n._groupBy=function(e){return function(t){return I(t,e)}},n.property=R,n.sort=T,n._sort=function(e){return function(t){return T(t,e)}},n._compare=x;var D={values:function(e){for(var t=[],n=e.lowerBound;n<e.upperBound;n++)t.push(n);return t}};n.range=M},{"./Dictionary":135,"@yieldify/gendry-hash-util":187}],156:[function(e,t,n){"use strict";function r(e){return Object.keys(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.keys=r},{}],157:[function(e,t,n){"use strict";function r(e){return 0===e.length?function(e){return e}:1===e.length?e[0]:e.reduce(function(e,t){return function(n){return e(t(n))}})}function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return function(n,o,s){var a=t(n,o,s),u=a.dispatch,c={getState:a.getState,dispatch:function(e){return u(e)}},l=e.map(function(e){return e(c)});return u=r(l)(a.dispatch),i({},a,{dispatch:u})}}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0}),n.applyMiddleware=o},{}],158:[function(e,t,n){"use strict";function r(e,t){var n=t&&t.type,r=n&&'"'+n.toString()+'"'||"an action";return"Given action "+r+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.'}function o(e){for(var t in e){var n=e[t],r=n(void 0,{type:s.ActionTypes.INIT});if("undefined"==typeof r)throw new Error('Reducer "'+t+"\" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.");var o="@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".");if("undefined"==typeof n(void 0,{type:o}))throw new Error('Reducer "'+t+'" returned undefined when probed with a random type. '+("Don't try to handle "+s.ActionTypes.INIT+' or other actions in "redux/*" ')+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")}}function i(e){var t;try{o(e)}catch(n){t=n}return function(n,o){if(void 0===n&&(n={}),t)throw t;var i=!1,s={};for(var a in e){var u=e[a],c=n[a],l=u(c,o);if("undefined"==typeof l)throw new Error(r(a,o));s[a]=l,i=i||l!==c}return i?s:n}}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./createStore");n.combineReducers=i},{"./createStore":159}],159:[function(e,t,n){"use strict";function r(e,t,o){function s(){h===d&&(h=d.slice())}function a(){return f}function u(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");
var t=!0;return s(),h.push(e),function(){if(t){t=!1,s();var n=h.indexOf(e);h.splice(n,1)}}}function c(e){if(!i(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if("undefined"==typeof e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(v)throw new Error("Reducers may not dispatch actions.");try{v=!0,f=p(f,e)}finally{v=!1}for(var t=d=h,n=0;n<t.length;n++){var r=t[n];r()}return e}if("undefined"!=typeof o){if("function"!=typeof o)throw new Error("Expected the enhancer to be a function.");var l=o(r);return l(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var p=e,f=t,d=[],h=d,v=!1;return c({type:n.ActionTypes.INIT}),{dispatch:c,getState:a,subscribe:u}}function o(e){return null!=e&&"object"==typeof e}function i(e){if(!o(e)||"[object Object]"!==a.call(e))return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=s.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)===c}Object.defineProperty(n,"__esModule",{value:!0}),n.ActionTypes={INIT:"@@redux/INIT"},n.createStore=r;var s=Object.prototype.hasOwnProperty,a=Object.prototype.toString,u=Function.prototype.toString,c=u.call(Object)},{}],160:[function(e,t,n){"use strict";function r(e){return window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__&&e?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({actionsBlacklist:["TICK"]}):o.identity}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utils");n.reduxDebugEnabledEnhancer=r},{"../utils":163}],161:[function(e,t,n){"use strict";function r(e,t){return e}function o(e,t){return e===t}function i(e){return function(t,n){if(t===n)return!0;for(var r=Object.keys(t).concat(Object.keys(n)),o=0,i=r;o<i.length;o++){var s=i[o];if(!e(t[s],n[s]))return!1}return!0}}function s(e){return function(t,n){if(t===n)return!0;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(!e(t[r],n[r]))return!1;return!0}}function a(e,t){var n,r,o=function(o){return void 0!==n&&t(o,n)||(r=e(o)),n=o,r};return o}function u(e,t,n,r){var o=0,i=n(function(e){return o++,t(e)},r),s=e(i);return s.resultFunc=t,s.recomputations=function(){return o},s.resetRecomputations=function(){o=0},s}function c(e,t,n,r){return void 0===n&&(n=a),void 0===r&&(r=o),u(function(t){return function(n){return t(e(n))}},t,n,r)}function l(e,t,n,r){return void 0===n&&(n=a),void 0===r&&(r=i(o)),u(function(t){return function(n){var r={};for(var o in e)r[o]=e[o](n);return t(r)}},t,n,r)}function p(e,t,n,r){return void 0===n&&(n=a),void 0===r&&(r=s(o)),u(function(t){return function(n){var r=e.map(function(e){return e(n)});return t(r)}},t,n,r)}function f(e,t){return l({state:function(e){return e},input:e},t,a,function(e,t){return e.input===t.input})}function d(e,t,n,r){void 0===n&&(n=a),void 0===r&&(r=o);var i={};return f(e,function(o){var s=o.state,a=o.input,u={},l=Object.keys(i),p=function(o){void 0===i[o]&&(i[o]=c(function(t){return e(t)[o]},t,n,r)),u[o]=i[o](s)};for(var f in a)p(f);for(var d=0,h=l;d<h.length;d++){var f=h[d];void 0===a[f]&&delete i[f]}return u})}function h(e,t){return l({index:e,map:t},function(e){for(var t=e.index,n=e.map,r=[],o=0,i=t;o<i.length;o++){var s=i[o];r.push(n[s])}return r})}function v(e,t){return l({key:e,obj:t},function(e){var t=e.key,n=e.obj;return n[t]})}function g(e){return function(t){return e(t)(t)}}function y(e){return u(function(t){return function(n){return t(e(n).map(function(e){return e(n)}))}},m.identity,a,s(o))}function b(e){return u(function(t){return function(n){var r=e(n),o={};for(var i in r)o[i]=r[i](n);return t(o)}},m.identity,a,i(o))}Object.defineProperty(n,"__esModule",{value:!0});var m=e("./utils");n.noopMemoise=r,n.strictEqualityCheck=o,n.objectEqualityCheck=i,n.listEqualityCheck=s,n.selector=c,n.mapSelector=l,n.listSelector=p,n.transformDict=d,n.materialise=h,n.pluck=v,n.lift=g,n.liftList=y,n.liftDict=b},{"./utils":163}],162:[function(e,t,n){"use strict";function r(e){function t(e,n){function r(r){function o(e,t){return void 0===t&&(t=!1),n(function(n){var o=e(a);return o===a?n:!t&&s.DeepEqual.deepEqual(o,a)?n:i({},n,(u={},u[r]=o,u));var u},!0)}var a=e[r];return{get:t(a,o),set:o}}return r}var n=function(t,n){return void 0===n&&(n=!1),t(e)};return{get:t(e,n),set:n}}function o(e){return function(t){return i({},t,e(t))}}var i=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var s=e("./DeepEqual");n.update=r,n.partial=o},{"./DeepEqual":134}],163:[function(e,t,n){"use strict";function r(e){return"number"==typeof e&&!isNaN(e)}function o(e){y=new RegExp("(^#|.*&)"+_+"($|&.*)").test(e.location.hash)}function i(){y=!1}function s(){return y}function a(e){return y===!1?e:e.indexOf("#")>=0?e+"&"+_:e+"#"+_}function u(e){return e.location.hash?e.location.hash.substring(1):""}function c(e,t){return t?e.indexOf("#")>=0?e+"&"+t:e+"#"+t:e}function l(e){var t={};for(var n in e){if(e[n]in e)throw new Error('Value "'+e[n]+'" is already a key in the lookup table');t[n]=e[n],t[e[n]]=n}return t}function p(e){return null!==e&&"object"==typeof e?e instanceof Array?e.slice():g({},e):e}function f(e){if(!e||0===e.length)return"";var t=e.reduce(function(e,t){return e+(t===!0?"1":"0")},""),n=parseInt(t,2),r=n.toString(36);return r}function d(e,t){if(""===e){if(0!==t)throw new Error("More bits than expected are encoded");return[]}var n=parseInt(e,36),r=n.toString(2),o=r.split("").map(function(e){return"1"===e}),i=t-o.length;if(isNaN(n))throw new Error("Input not parsable into base 36");if(i<0)throw new Error("More bits than expected are encoded");var s=h(i,!1);return s.concat(o)}function h(e,t){var n=Array.apply(null,Array(e));return n.map(function(){return t})}function v(e){var t=b.map(m.entries(e),function(e){return e.key+":"+e.value});return t.join(";")}var g=this&&this.__assign||Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};Object.defineProperty(n,"__esModule",{value:!0});var y,b=e("./list"),m=e("./Dictionary"),_="yidebug";n.isValidNumber=r,n.initialiseDebugMode=o,n.resetDebugMode=i,n.isDebugMode=s,n.addDebugParameter=a,n.getHash=u,n.addHashParameters=c,n.createTranslationTable=l,n.shallowClone=p,n.identity=function(e){return e},n.noop=function(){},n.notNull=function(e){return null!==e},n.toBitVector=f,n.fromBitVector=d,n.generateCssText=v},{"./Dictionary":135,"./list":155}],164:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../lib/Promise"),o=function(){function e(){this.registry=void 0}return e.methodNotImplemented=function(e){return function(){return r["default"].reject(new Error(e+" is not implemented by this module"))}},e.prototype.setRegistry=function(e){this.registry=e},e.prototype.invokeMethod=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.validateCall(e),!this.registry)throw new Error("Registry has not been defined");return(r=this.registry).invokeMethod.apply(r,[this.getRoutingLabel(),e].concat(t));var r},e.prototype.invokeStream=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(this.validateCall(e),!this.registry)throw new Error("Registry has not been defined");return(r=this.registry).invokeStream.apply(r,[this.getRoutingLabel(),e].concat(t));var r},e.prototype.toJSON=function(){return{label:this.getRoutingLabel()}},e.prototype.validateCall=function(e){if("function"!=typeof this["interface"]()[e])throw new Error("Invoked method is not part of the interface")},e}();n.BaseModule=o},{"../../lib/Promise":138}],165:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(){this.modules={}}return e.prototype.register=function(e){var t=e.getRoutingLabel();if(t in this.modules)throw new Error("Cannot register two modules with the same routing label: "+t);this.modules[e.getRoutingLabel()]=e,e.setRegistry(this)},e.prototype.registerAll=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];this.register(r)}},e.prototype.getModuleByClass=function(e){for(var t in this.modules){var n=this.getModuleByLabel(t);if(n instanceof e)return n}},e.prototype.getModuleByLabel=function(e){return this.modules[e]},e.prototype.toJSON=function(){return{modules:this.modules}},e}();n.ModuleRegistry=r},{}],166:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"cookie"},t.prototype["interface"]=function(){return{getCookie:this.getCookie,getCookies:this.getCookies,setCookie:this.setCookie,deleteCookie:this.deleteCookie}},t}(o.BaseModule);n.CookieBase=i},{"../BaseModule":164}],167:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getCookie=function(e){return this.invokeMethod("getCookie",e)},t.prototype.getCookies=function(e){return this.invokeMethod("getCookies",e)},t.prototype.setCookie=function(e){return this.invokeMethod("setCookie",e)},t.prototype.deleteCookie=function(e,t){return this.invokeMethod("deleteCookie",e,t)},t}(o.CookieBase);n.CookieClient=i},{"./Base":166}],168:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"dom"},t.prototype["interface"]=function(){return{draw:this.draw,style:this.style,modifyAttribute:this.modifyAttribute,listen:this.listen,createValueScraper:this.createValueScraper,startScraping:this.startScraping,stopScraping:this.stopScraping,getInputValue:this.getInputValue,getReferrer:this.getReferrer,getBoundingClientRect:this.getBoundingClientRect}},t}(o.BaseModule);n.DOMBase=i},{"../BaseModule":164}],169:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=e("../../../app/model/page/scraper/RemoteValueScraper"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.draw=function(e,t){return this.invokeMethod("draw",e,t.trim())},t.prototype.style=function(e,t,n){return this.invokeMethod("style",e,t,n)},t.prototype.modifyAttribute=function(e,t,n){return this.invokeMethod("modifyAttribute",e,t,n)},t.prototype.listen=function(e,t,n){return this.invokeStream("listen",e,t,n)},t.prototype.createValueScraper=function(e,t){var n=this;return this.invokeMethod("createValueScraper",e,t).then(function(r){return new i.RemoteValueScraper(r,n,e,t)})},t.prototype.startScraping=function(e){return this.invokeStream("startScraping",e)},t.prototype.stopScraping=function(e){return this.invokeMethod("stopScraping",e)},t.prototype.getInputValue=function(e){return this.invokeMethod("getInputValue",e)},t.prototype.getReferrer=function(){return this.invokeMethod("getReferrer")},t.prototype.getBoundingClientRect=function(e){return this.invokeMethod("getBoundingClientRect",e)},t}(o.DOMBase);n.DOMClient=s},{"../../../app/model/page/scraper/RemoteValueScraper":57,"./Base":168}],170:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule");n.CREATE_IFRAME_METHOD="createIFrame",n.START_PROXYING_METHOD="startProxying",n.SEND_METHOD="send",n.RECEIVE_METHOD="receive";var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"iframe"},t}(o.BaseModule);n.IFrameBase=i},{"../BaseModule":164}],171:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/Promise"),i=e("../../../lib/Logger"),s=e("../BaseModule"),a=e("./Base"),u=e("./ProxiedConnection"),c=function(e){function t(){var t=e.call(this)||this;return t.connections={},t}return r(t,e),t.prototype.createIFrame=function(e){var t=this;return this.invokeMethod(a.CREATE_IFRAME_METHOD,e).then(function(e){var n=new u.ProxiedConnection(e,t);return t.connections[e]=n,t.invokeMethod(a.START_PROXYING_METHOD,e),n})},t.prototype.send=function(e,t){return this.invokeMethod(a.SEND_METHOD,e,t)},t.prototype.receive=function(e,t){var n=this.connections[e];return n?(n.receiveProxiedMessage(t),o["default"].resolve()):(i.logger.error({connectionId:e,data:t},"Received data for connection with unknown id"),o["default"].reject(new Error("Non-existent proxy connection id")))},t.prototype["interface"]=function(){var e=this;return t={},t[a.RECEIVE_METHOD]=function(t,n){return e.receive(t,n)},t[a.SEND_METHOD]=s.BaseModule.methodNotImplemented(a.SEND_METHOD),t[a.CREATE_IFRAME_METHOD]=s.BaseModule.methodNotImplemented(a.CREATE_IFRAME_METHOD),t[a.START_PROXYING_METHOD]=s.BaseModule.methodNotImplemented(a.START_PROXYING_METHOD),t;var t},t}(a.IFrameBase);n.IFrameClient=c},{"../../../lib/Logger":136,"../../../lib/Promise":138,"../BaseModule":164,"./Base":170,"./ProxiedConnection":172}],172:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../remote-windows/connection/Connection"),i=function(e){function t(t,n){var r=e.call(this)||this;return r.id=t,r.iframeClient=n,r}return r(t,e),t.prototype.send=function(e){this.iframeClient.send(this.id,e)},t.prototype.receiveProxiedMessage=function(e){this.receivedMessage(e)},t}(o.Connection);n.ProxiedConnection=i},{"../../remote-windows/connection/Connection":183}],173:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"localStorage"},t.prototype["interface"]=function(){return{getItem:this.getItem,setItem:this.setItem,removeItem:this.removeItem}},t}(o.BaseModule);n.LocalStorageBase=i},{"../BaseModule":164}],174:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getItem=function(e){return this.invokeMethod("getItem",e)},t.prototype.setItem=function(e,t){return this.invokeMethod("setItem",e,t)},t.prototype.removeItem=function(e){return this.invokeMethod("removeItem",e)},t}(o.LocalStorageBase);n.LocalStorageClient=i},{"./Base":173}],175:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Client"),i=e("../../../lib/Promise"),s=function(e){function t(t){var n=e.call(this)||this;return n.store=t,n}return r(t,e),t.prototype["interface"]=function(){var e=this;return{dispatch:function(t){return e.receiveAction(t)}}},t.prototype.receiveAction=function(e){return this.store.dispatch(e),i["default"].resolve()},t}(o.ReduxStoreClient);n.ReduxStoreAgent=s},{"../../../lib/Promise":138,"./Client":176}],176:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.dispatch=function(e){return this.invokeMethod("dispatch",e)},t.prototype.getRoutingLabel=function(){return"redux-store"},t.prototype["interface"]=function(){return{dispatch:this.dispatch}},t}(o.BaseModule);n.ReduxStoreClient=i},{"../BaseModule":164}],177:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../BaseModule"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.getRoutingLabel=function(){return"window"},t.prototype["interface"]=function(){return{listen:this.listen,observeLocation:this.observeLocation,getInnerDimensions:this.getInnerDimensions,observeInnerDimensions:this.observeInnerDimensions,redirect:this.redirect}},t}(o.BaseModule);n.WindowBase=i},{"../BaseModule":164}],178:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Base"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.listen=function(e){return this.invokeStream("listen",e)},t.prototype.observeLocation=function(){return this.invokeStream("observeLocation")},t.prototype.getInnerDimensions=function(){return this.invokeMethod("getInnerDimensions")},t.prototype.observeInnerDimensions=function(){return this.invokeStream("observeInnerDimensions")},t.prototype.redirect=function(e){return this.invokeMethod("redirect",e)},t}(o.WindowBase);n.WindowClient=i},{"./Base":177}],179:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("./HandshakeMessage"),o=e("./connection/CrossOriginConnection"),i=function(){function e(e){this.source=e}return e.prototype.connect=function(e){var t=new o.CrossOriginConnection(this.source,e),n=t.awaitMessage(r.HandshakeMessage.READY);return e.postMessage(r.HandshakeMessage.CONNECT,o.ORIGIN_WILDCARD),n},e}();n.CrossOriginClient=i},{"./HandshakeMessage":180,"./connection/CrossOriginConnection":184}],180:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.HandshakeMessage={CONNECT:"CONNECT",READY:"READY"}},{}],181:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../lib/Promise"),i=e("../../lib/Observable"),s=e("../../lib/Logger"),a=e("./RemoteWindowMessage"),u=e("./connection/JSONConnection"),c=e("../modules/ModuleRegistry"),l=function(e){function t(t){var n=e.call(this)||this;return n.responseCallbacks={},n.connection=t,n.messageId=0,n.config=void 0,n.startReceived=!1,n}return r(t,e),t.connect=function(e,n){return void 0===n&&(n={}),function(r){var o=new u.JSONConnection(e,r),i=new t(o);return n.provide&&i.registerAll(n.provide),i.start(n.initConfig)}},t.prototype.start=function(e){var t=this;return new o["default"](function(n,r){t.connection.receive(function(e){if(t.startReceived)t.handler(e);else try{t.parseStartMessage(e),n(t)}catch(o){r(o)}}),t.connection.send({id:0,type:a.MessageType.START,target:"-",method:"-",data:e})})},t.prototype.getConfig=function(){return this.config},t.prototype.invokeMethod=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=new o["default"];return this.invoke.apply(this,[i,e,t].concat(n)),i},t.prototype.invokeStream=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=new i.Observable;return this.invoke.apply(this,[o,e,t].concat(n)),o},t.prototype.toJSON=function(){return{config:this.config}},t.prototype.invoke=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var i=this.nextMessageId();this.connection.send({id:i,type:a.MessageType.CALL,target:t,method:n,data:r}),this.responseCallbacks[i]=e},t.prototype.parseStartMessage=function(e){if(e.type!==a.MessageType.START)throw new Error("Received a non-START message while waiting for START");this.startReceived=!0,this.config=e.data},t.prototype.respond=function(e,t){this.connection.send({id:e.id,type:a.MessageType.RESPONSE,target:e.target,method:e.method,data:t})},t.prototype.respondError=function(e,t){this.connection.send({id:e.id,type:a.MessageType.ERROR,target:e.target,method:e.method,data:t.message})},t.prototype.handleCall=function(e){var t=this;this.validateCall(e);var n=this.getModuleByLabel(e.target),r=n["interface"]()[e.method].apply(n,e.data),a=function(n){t.respond(e,n)},u=function(n){s.logger.debug({error:n},"Call resulted in an error"),t.respondError(e,n)};if(r instanceof o["default"]){var c=r;c.then(a,u)}else if(r instanceof i.Observable){var l=r;l.subscribe(a)}},t.prototype.handleResponse=function(e){this.validateResponse(e);var t=this.responseCallbacks[e.id];if(t instanceof o["default"]){var n=t;delete this.responseCallbacks[e.id],n.resolve(e.data)}else if(t instanceof i.Observable){var r=t;r.publish(e.data)}},t.prototype.handleError=function(e){this.validateResponse(e);var t=this.responseCallbacks[e.id];t instanceof o["default"]?(t.reject(new Error(e.data)),delete this.responseCallbacks[e.id]):s.logger.error({message:e},"Cant pass error message to observable")},t.prototype.handler=function(e){if(e.type===a.MessageType.CALL)this.handleCall(e);else if(e.type===a.MessageType.RESPONSE)this.handleResponse(e);else{if(e.type!==a.MessageType.ERROR)throw new Error("Invalid message type");this.handleError(e)}},t.prototype.nextMessageId=function(){return this.messageId+=1},t.prototype.validateCall=function(e){if(!e.id||isNaN(e.id))throw new Error("message does not contain a valid id");if(!e.target)throw new Error("message does not contain a valid target");if(!this.getModuleByLabel(e.target))throw new Error("message does not contain a valid target of: "+e.target);if("function"!=typeof this.getModuleByLabel(e.target)["interface"]()[e.method])throw new Error("method should be a valid function: "+e.method)},t.prototype.validateResponse=function(e){if(!e.id||isNaN(e.id))throw new Error("message does not contain a valid id")},t}(c.ModuleRegistry);n.RemoteWindow=l},{"../../lib/Logger":136,"../../lib/Observable":137,"../../lib/Promise":138,"../modules/ModuleRegistry":165,"./RemoteWindowMessage":182,"./connection/JSONConnection":185}],182:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r;!function(e){e[e.START=0]="START",e[e.CALL=1]="CALL",e[e.RESPONSE=2]="RESPONSE",e[e.ERROR=3]="ERROR"}(r=n.MessageType||(n.MessageType={}))},{}],183:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=e("../../../lib/Promise"),o=e("../../../lib/BufferingObservable"),i=e("../../../lib/DeepEqual"),s=function(){function e(){this.messages=new o.BufferingObservable}return e.prototype.receive=function(e){return this.messages.subscribe(e)},e.prototype.awaitMessage=function(e){var t=this;return new r["default"](function(n,r){var o=t.receive(function(s){i.DeepEqual.deepEqual(e,s)?(n(t),o.dispose()):r(new Error("Unexpected message received: "+s))})})},e.prototype.receivedMessage=function(e){this.messages.publish(e)},e}();n.Connection=s},{"../../../lib/BufferingObservable":131,"../../../lib/DeepEqual":134,"../../../lib/Promise":138}],184:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/events/EventTargetUtil"),i=e("./Connection"),s=e("../../../lib/Logger");n.ORIGIN_WILDCARD="*",n.MSG_PREFIX="/* yieldify */ ";var a=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.target=n,o.EventTargetUtil.addEventListener(t,"message",function(e){r.messageHandler(e)},!1),r}return r(t,e),t.prototype.send=function(e){var t=n.MSG_PREFIX+e;this.target.postMessage(t,n.ORIGIN_WILDCARD)},t.prototype.messageHandler=function(e){var t,r=e.origin,o=e.data;if(e.source===this.target)if("string"!=typeof o)s.logger.warn({origin:r},"CrossOriginConnection received a message with non-string data"),s.logger.debug({message:o},"Message with non-string data");else{var i=o.slice(0,n.MSG_PREFIX.length);i!==n.MSG_PREFIX?(s.logger.warn({origin:r},"CrossOriginConnection received a message without a prefix"),s.logger.debug({message:o},"Message without a prefix")):(t=o.slice(n.MSG_PREFIX.length),this.receivedMessage(t))}},t}(i.Connection);n.CrossOriginConnection=a},{"../../../lib/Logger":136,"../../../lib/events/EventTargetUtil":151,"./Connection":183}],185:[function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../../lib/Logger"),i=e("./Connection"),s=function(e){function t(t,n){var r=e.call(this)||this;return r.json=t,r.underlyingConnection=n,r.underlyingConnection.receive(function(e){r.stringMessageHandler(e)}),r}return r(t,e),t.prototype.send=function(e){this.underlyingConnection.send(this.json.stringify(e))},t.prototype.stringMessageHandler=function(e){var t;try{t=this.json.parse(e)}catch(n){return void o.logger.error({message:e},"Unable to parse received message as JSON")}this.receivedMessage(t)},t}(i.Connection);n.JSONConnection=s},{"../../../lib/Logger":136,"./Connection":183}],186:[function(e,t,n){"use strict";function r(e){var t=i.stableStringify(e);if(t)return o.murmur32(t,s)}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./murmurHash"),i=e("./stableStringify"),s=5297;n.deepHash=r},{"./murmurHash":188,"./stableStringify":189}],187:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t])}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./deepHash")),r(e("./murmurHash")),r(e("./stableStringify"))},{"./deepHash":186,"./murmurHash":188,"./stableStringify":189}],188:[function(e,t,n){"use strict";function r(e,t){if("undefined"==typeof e)throw new Error("key must be a valid string");if(t<1)throw new Error("seed must be a positive integer");if(e.split("").some(function(e){return e.charCodeAt(0)>127}))throw new Error("key must be an ascii string");for(var n,r,o=3&e.length,i=e.length-o,s=t,a=3432918353,u=461845907,c=0;c<i;)n=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,n=(65535&n)*a+(((n>>>16)*a&65535)<<16)&4294967295,n=n<<15|n>>>17,n=(65535&n)*u+(((n>>>16)*u&65535)<<16)&4294967295,s^=n,s=s<<13|s>>>19,r=5*(65535&s)+((5*(s>>>16)&65535)<<16)&4294967295,s=(65535&r)+27492+(((r>>>16)+58964&65535)<<16);switch(n=0,o){case 3:n^=(255&e.charCodeAt(c+2))<<16;case 2:n^=(255&e.charCodeAt(c+1))<<8;case 1:n^=255&e.charCodeAt(c),n=(65535&n)*a+(((n>>>16)*a&65535)<<16)&4294967295,n=n<<15|n>>>17,n=(65535&n)*u+(((n>>>16)*u&65535)<<16)&4294967295,s^=n}return s^=e.length,s^=s>>>16,s=2246822507*(65535&s)+((2246822507*(s>>>16)&65535)<<16)&4294967295,s^=s>>>13,s=3266489909*(65535&s)+((3266489909*(s>>>16)&65535)<<16)&4294967295,s^=s>>>16,s>>>0}Object.defineProperty(n,"__esModule",{value:!0}),n.MURMUR_32_MAX_VALUE=4294967295,n.murmur32=r},{}],189:[function(e,t,n){"use strict";function r(e,t){if(void 0===t&&(t=[]),e&&e.toJSON&&"function"==typeof e.toJSON&&(e=e.toJSON()),"undefined"!=typeof e){if(null===e)return"null";if("object"!=typeof e)return JSON.stringify(e);if(t.indexOf(e)!==-1)throw new TypeError("Converting circular structure to JSON");if(t.push(e),o(e)){var n=e.map(function(e){var n=r(e,t)||"null";return n});return"["+n.join(",")+"]"}for(var i=Object.keys(e).sort(),s=[],a=0;a<i.length;a++){var u=i[a],c=r(e[u],t);c&&s.push(JSON.stringify(u)+":"+c)}return t.splice(t.indexOf(e),1),"{"+s.join(",")+"}"}}function o(e){return Array.isArray(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.stableStringify=r},{}],190:[function(e,t,n){"use strict";function r(e){for(var t in e)n.hasOwnProperty(t)||(n[t]=e[t]);
}Object.defineProperty(n,"__esModule",{value:!0}),r(e("./validation-reg-exp"))},{"./validation-reg-exp":191}],191:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.EMAIL_REGEXP=/^[a-zA-Z0-9$!#%&'*+\/=?^_`{|}~-]+(?:\.[a-zA-Z0-9$!#%&'*+\/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$/},{}]},{},[32]);</script></body></html>